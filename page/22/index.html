
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <script type="text/javascript">
    (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
    (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
    e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
    })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');
    
    _st('install','yNiKTKaAnwd1uuxVMfiE','2.0.0');
  </script>
  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?5b99dfd487346155d274c0c49c3fb869";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
  </script>

  
    <title>Will&#39;s Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="Will Chen">
    

    
    <meta name="description" content="左右水色 右手天光">
<meta property="og:type" content="website">
<meta property="og:title" content="Will's Blog">
<meta property="og:url" content="https://runningdata.github.io/page/22/index.html">
<meta property="og:site_name" content="Will's Blog">
<meta property="og:description" content="左右水色 右手天光">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Will's Blog">
<meta name="twitter:description" content="左右水色 右手天光">

    
    <link rel="alternative" href="/atom.xml" title="Will&#39;s Blog" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="Will&#39;s Blog" title="Will&#39;s Blog"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Will&#39;s Blog">Will&#39;s Blog</a></h1>
				<h2 class="blog-motto">简易 变易 不易</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">首页</a></li>
					
						<li><a href="/archives">归档</a></li>
					
						<li><a href="/about">关于</a></li>
					
					<li>
 					
                                                <form class="search" action="/search/index.html" method="get" accept-charset="utf-8" target="_blank">
                                                        <label>搜索</label>
                                                <input name="s" type="hidden" value= null ><input type="text" name="q" size="30" placeholder="搜索"><br>
                                                </form>
					
					</li>
				</ul>
			</nav>			
</div>

    </header>
    <div id="container">
      <div id="main">

   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/12/10/spring-quartz集群配置全部资料/" title="spring + quartz集群配置全部资料" itemprop="url">spring + quartz集群配置全部资料</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Will Chen" target="_blank" itemprop="author">Will Chen</a>
		
  <p class="article-time">
    <time datetime="2015-12-10T07:25:25.000Z" itemprop="datePublished"> 发表于 2015-12-10</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>今天玩儿quartz正玩儿的起劲儿，下午就被否掉了，另一个同事已经被分配了相关的工作，那么我这边的工作就重复了。<br>暂时记下目前了解到的一些配置，方便以后使用。</p>
<h3 id="quartz-xml配置文件"><a href="#quartz-xml配置文件" class="headerlink" title="quartz.xml配置文件"></a>quartz.xml配置文件</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">beans</span></span></div><div class="line">        <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></div><div class="line">        <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></div><div class="line">        <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span> = <span class="string">"willtest"</span> <span class="attr">class</span>=<span class="string">"com.will.quartz.task.WillTask"</span>/&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"abnormalDitail"</span> <span class="attr">class</span>=<span class="string">"org.springframework.scheduling.quartz.JobDetailBean"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jobClass"</span> <span class="attr">value</span>=<span class="string">"com.will.quartz.task.WillSpringJob"</span> /&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jobDataAsMap"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">map</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"timeout"</span> <span class="attr">value</span>=<span class="string">"5"</span> /&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">map</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"anotherJob"</span> <span class="attr">class</span>=<span class="string">"org.springframework.scheduling.quartz.JobDetailBean"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jobClass"</span> <span class="attr">value</span>=<span class="string">"com.will.quartz.task.AnotherSJob"</span> /&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jobDataAsMap"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">map</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"timeout"</span> <span class="attr">value</span>=<span class="string">"5"</span> /&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">map</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="comment">&lt;!--  调度触发器 --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"abnormalTigger"</span> <span class="attr">class</span>=<span class="string">"org.springframework.scheduling.quartz.CronTriggerBean"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jobDetail"</span> <span class="attr">ref</span>=<span class="string">"abnormalDitail"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cronExpression"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>*/5 * * * * ?<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!--  调度触发器 --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"anotherJobTigger"</span> <span class="attr">class</span>=<span class="string">"org.springframework.scheduling.quartz.CronTriggerBean"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jobDetail"</span> <span class="attr">ref</span>=<span class="string">"anotherJob"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cronExpression"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>*/8 * * * * ?<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"com.mchange.v2.c3p0.ComboPooledDataSource"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClass"</span> <span class="attr">value</span>=<span class="string">"$&#123;database.driverClassName&#125;"</span> /&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jdbcUrl"</span> <span class="attr">value</span>=<span class="string">"$&#123;database.quartz.url&#125;"</span> /&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"user"</span> <span class="attr">value</span>=<span class="string">"$&#123;database.quartz.username&#125;"</span> /&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;database.quartz.password&#125;"</span> /&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"initialPoolSize"</span> <span class="attr">value</span>=<span class="string">"$&#123;pool.initialPoolSize&#125;"</span> /&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"minPoolSize"</span> <span class="attr">value</span>=<span class="string">"$&#123;pool.minPoolSize&#125;"</span> /&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxPoolSize"</span> <span class="attr">value</span>=<span class="string">"$&#123;pool.maxPoolSize&#125;"</span> /&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxIdleTime"</span> <span class="attr">value</span>=<span class="string">"$&#123;pool.maxIdleTime&#125;"</span> /&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"checkoutTimeout"</span> <span class="attr">value</span>=<span class="string">"12000"</span> /&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"acquireIncrement"</span> <span class="attr">value</span>=<span class="string">"$&#123;pool.acquireIncrement&#125;"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">bean</span>  <span class="attr">id</span>=<span class="string">"quartzExceptionSchedulerListener"</span>  <span class="attr">class</span>=<span class="string">"com.will.quartz.task.QuartzExceptionSchedulerListener"</span>/&gt;</span></div><div class="line"></div><div class="line"><span class="comment">&lt;!-- 调度工厂 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"quartzScheduler"</span></span></div><div class="line">      <span class="attr">class</span>=<span class="string">"org.springframework.scheduling.quartz.SchedulerFactoryBean"</span>&gt;</div><div class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span> /&gt;</span></div><div class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"quartzProperties"</span>&gt;</span></div><div class="line">              <span class="tag">&lt;<span class="name">props</span>&gt;</span></div><div class="line">                     <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"org.quartz.scheduler.instanceName"</span>&gt;</span>scheduler<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></div><div class="line">                  <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"org.quartz.scheduler.driverDelegateClass"</span>&gt;</span>org.quartz.impl.jdbcjobstore.StdJDBCDelegate<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></div><div class="line">                  <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"org.quartz.scheduler.instanceId"</span>&gt;</span>AUTO<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></div><div class="line">                     <span class="comment">&lt;!-- 线程池配置 --&gt;</span></div><div class="line">                     <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"org.quartz.threadPool.class"</span>&gt;</span>org.quartz.simpl.SimpleThreadPool<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></div><div class="line">                     <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"org.quartz.threadPool.threadCount"</span>&gt;</span>20<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></div><div class="line">                     <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"org.quartz.threadPool.threadPriority"</span>&gt;</span>5<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></div><div class="line">                     <span class="comment">&lt;!-- JobStore 配置 --&gt;</span></div><div class="line">                     <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"org.quartz.jobStore.class"</span>&gt;</span>org.quartz.impl.jdbcjobstore.JobStoreTX<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></div><div class="line"></div><div class="line">                     <span class="comment">&lt;!-- 集群配置 --&gt;</span></div><div class="line">                     <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"org.quartz.jobStore.isClustered"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></div><div class="line">                     <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"org.quartz.jobStore.clusterCheckinInterval"</span>&gt;</span>15000<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></div><div class="line">                     <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"org.quartz.jobStore.maxMisfiresToHandleAtATime"</span>&gt;</span>1<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></div><div class="line"></div><div class="line">                     <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"org.quartz.jobStore.misfireThreshold"</span>&gt;</span>120000<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></div><div class="line"></div><div class="line">                     <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"org.quartz.jobStore.tablePrefix"</span>&gt;</span>QRTZ_<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></div><div class="line">              <span class="tag">&lt;/<span class="name">props</span>&gt;</span></div><div class="line"></div><div class="line">       <span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"></div><div class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"schedulerName"</span> <span class="attr">value</span>=<span class="string">"CRMscheduler"</span> /&gt;</span></div><div class="line"></div><div class="line">       <span class="comment">&lt;!--必须的，QuartzScheduler 延时启动，应用启动完后 QuartzScheduler 再启动 --&gt;</span></div><div class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"startupDelay"</span> <span class="attr">value</span>=<span class="string">"30"</span> /&gt;</span></div><div class="line"></div><div class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"applicationContextSchedulerContextKey"</span> <span class="attr">value</span>=<span class="string">"applicationContextKey"</span> /&gt;</span></div><div class="line"></div><div class="line">       <span class="comment">&lt;!--可选，QuartzScheduler 启动时更新己存在的Job，这样就不用每次修改targetObject后删除qrtz_job_details表对应记录了 --&gt;</span></div><div class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"overwriteExistingJobs"</span> <span class="attr">value</span>=<span class="string">"true"</span> /&gt;</span></div><div class="line"></div><div class="line">       <span class="comment">&lt;!-- 设置自动启动 --&gt;</span></div><div class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"autoStartup"</span> <span class="attr">value</span>=<span class="string">"true"</span> /&gt;</span></div><div class="line"></div><div class="line"></div><div class="line">       <span class="comment">&lt;!-- 注册触发器 --&gt;</span></div><div class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"triggers"</span>&gt;</span></div><div class="line">              <span class="tag">&lt;<span class="name">list</span>&gt;</span></div><div class="line">                     <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">"abnormalTigger"</span> /&gt;</span></div><div class="line">                     <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">"anotherJobTigger"</span> /&gt;</span></div><div class="line">              <span class="tag">&lt;/<span class="name">list</span>&gt;</span></div><div class="line">       <span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"></div><div class="line">       <span class="comment">&lt;!-- 注册jobDetail --&gt;</span></div><div class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jobDetails"</span>&gt;</span></div><div class="line">              <span class="tag">&lt;<span class="name">list</span>&gt;</span></div><div class="line">              <span class="tag">&lt;/<span class="name">list</span>&gt;</span></div><div class="line">       <span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"></div><div class="line"></div><div class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"schedulerListeners"</span>&gt;</span></div><div class="line">              <span class="tag">&lt;<span class="name">list</span>&gt;</span></div><div class="line">                     <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">"quartzExceptionSchedulerListener"</span> /&gt;</span></div><div class="line">              <span class="tag">&lt;/<span class="name">list</span>&gt;</span></div><div class="line">       <span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="数据库表准备"><a href="#数据库表准备" class="headerlink" title="数据库表准备"></a>数据库表准备</h3><p>就是准备好集群需要的那些表，昨天找了半天的那个，参见：spring-quartz集群环境搭建遇到的问题。</p>
<h3 id="config-properties"><a href="#config-properties" class="headerlink" title="config.properties"></a>config.properties</h3><p>就是xml里使用的那些变量<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">base.driverClassName=com.mysql.jdbc.Driver</div><div class="line">database.quartz.url=jdbc:mysql:<span class="comment">//192.168.22.235:3306/testdb?useUnicode=true&amp;characterEncoding=utf8</span></div><div class="line">database.quartz.username=root</div><div class="line">database.quartz.password=<span class="number">123</span></div><div class="line"></div><div class="line"></div><div class="line">pool.initialPoolSize=<span class="number">5</span></div><div class="line">pool.minPoolSize=<span class="number">5</span></div><div class="line">pool.maxPoolSize=<span class="number">100</span></div><div class="line">pool.maxIdleTime=<span class="number">3600</span></div><div class="line">pool.acquireIncrement=<span class="number">1</span></div><div class="line">pool.idleConnectionTestPeriod=<span class="number">60</span></div><div class="line">pool.preferredTestQuery=SELECT <span class="number">1</span></div><div class="line">pool.checkoutTimeout=<span class="number">60000</span></div></pre></td></tr></table></figure></p>
<h3 id="JobDetail"><a href="#JobDetail" class="headerlink" title="JobDetail"></a>JobDetail</h3><p>也就是我们需要定时执行的任务。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WillSpringJob</span> <span class="keyword">extends</span> <span class="title">QuartzJobBean</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">executeInternal</span><span class="params">(JobExecutionContext context)</span> <span class="keyword">throws</span> JobExecutionException </span>&#123;</div><div class="line">        System.out.println(<span class="string">"sssssssssssssssss"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AnotherSJob</span> <span class="keyword">extends</span> <span class="title">QuartzJobBean</span> </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">executeInternal</span><span class="params">(JobExecutionContext context)</span> <span class="keyword">throws</span> JobExecutionException </span>&#123;</div><div class="line">        System.out.println(<span class="string">"fun.. I am a jerk."</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="SchedulerListener"><a href="#SchedulerListener" class="headerlink" title="SchedulerListener"></a>SchedulerListener</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QuartzExceptionSchedulerListener</span> <span class="keyword">extends</span> <span class="title">SchedulerListenerSupport</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> Logger logger = LoggerFactory.getLogger(QuartzExceptionSchedulerListener.class);</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">schedulerError</span><span class="params">(String message, SchedulerException e)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.schedulerError(message, e);</div><div class="line">        logger.error(message, e.getUnderlyingException());</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><p>其实主要的配置都在SchedulerFactoryBean这儿，我们可以看一下这个类里到底有哪些element，也就是xml里在它下面配置的property。其实主要是他的父类SchedulerAccessor，展示一下源码截图：</p>
<p><img src="/imgs/quartz/SchedulerAccessor.png" alt=""></p>
<h3 id="几个小问题"><a href="#几个小问题" class="headerlink" title="几个小问题"></a>几个小问题</h3><ul>
<li><ol>
<li>quartz虽然启动的时候会delay，但是delay的时候会囤积task，到时间会一股脑地将前面delay那段时间的Task全给执行咯；<br>结果是：是的。不可避免</li>
</ol>
</li>
<li><ol>
<li>目前一个trigger里只能写一个job，看了一下cronTrigger里就只有一个JobDetail属性，而不是一个list。对于同一个调度频率的任务一定需要弄多个trigger吗？<br>结果是：很少有这种需求，可以写成一个Job</li>
</ol>
</li>
<li><ol>
<li>SchedulerFactoryBean里的jobDetails如果不配置，只设置trigger的话,JobDetail其实也是会被写入mysql对应的表里的。trigger里的JobDetail和SchedulerFactoryBean里的有什么区别和联系。<br>结果是： ScheduelrAccessor里的注释是Register a list of JobDetail objects with the Scheduler that this FactoryBean creates, to be referenced by Triggers.<br>This is not necessary when a Trigger determines the JobDetail itself: In this case, the JobDetail will be implicitly registered in combination with the Trigger.</li>
</ol>
</li>
</ul>
<p>Done!! </p>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li><a href="http://tech.meituan.com/mt-crm-quartz.html" target="_blank" rel="external">http://tech.meituan.com/mt-crm-quartz.html</a></li>
<li><a href="https://www.ibm.com/developerworks/cn/opensource/os-cn-quartz/" target="_blank" rel="external">https://www.ibm.com/developerworks/cn/opensource/os-cn-quartz/</a></li>
<li><a href="http://www.quartz-scheduler.org/generated/2.2.2/html/qtz-all/" target="_blank" rel="external">http://www.quartz-scheduler.org/generated/2.2.2/html/qtz-all/</a></li>
<li><a href="https://github.com/xishuixixia/quartz-monitor" target="_blank" rel="external">https://github.com/xishuixixia/quartz-monitor</a> 【quartz monitor】</li>
<li><a href="http://hot66hot.iteye.com/blog/1726143" target="_blank" rel="external">http://hot66hot.iteye.com/blog/1726143</a></li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    

    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/spring/">spring</a><a href="/tags/quartz/">quartz</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>





   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/12/09/spring-quartz集群环境搭建遇到的问题/" title="spring + quartz集群环境搭建遇到的问题" itemprop="url">spring + quartz集群环境搭建遇到的问题</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Will Chen" target="_blank" itemprop="author">Will Chen</a>
		
  <p class="article-time">
    <time datetime="2015-12-09T10:32:52.000Z" itemprop="datePublished"> 发表于 2015-12-09</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="问题1"><a href="#问题1" class="headerlink" title="问题1"></a>问题1</h2><p>总是数据库连接失败<br>解决：dataSource的checkoutTimeout由120修改为12000</p>
<h2 id="问题2"><a href="#问题2" class="headerlink" title="问题2"></a>问题2</h2><p> No row exists in table QRTZ_LOCKS for lock named:  TRIGGER_ACCESS<br> 临时解决方案：<br> <figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> QRTZ_LOCKS <span class="keyword">values</span>(<span class="string">'my sched_name'</span>, <span class="string">'TRIGGER_ACCESS'</span>); </div><div class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> QRTZ_LOCKS <span class="keyword">values</span>(<span class="string">'my sched_name'</span>,<span class="string">'JOB_ACCESS'</span>); </div><div class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> QRTZ_LOCKS <span class="keyword">values</span>(<span class="string">'my sched_name'</span>,<span class="string">'CALENDAR_ACCESS'</span>); </div><div class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> QRTZ_LOCKS <span class="keyword">values</span>(<span class="string">'my sched_name'</span>,<span class="string">'STATE_ACCESS'</span>); </div><div class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> QRTZ_LOCKS <span class="keyword">values</span>(<span class="string">'my sched_name'</span>,<span class="string">'MISFIRE_ACCESS'</span>);</div></pre></td></tr></table></figure></p>
<p>实际的表结构是<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`QRTZ_LOCKS`</span> (</div><div class="line">  <span class="string">`SCHED_NAME`</span> <span class="built_in">varchar</span>(<span class="number">120</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</div><div class="line">    <span class="string">`LOCK_NAME`</span> <span class="built_in">varchar</span>(<span class="number">40</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</div><div class="line">      PRIMARY <span class="keyword">KEY</span> (<span class="string">`SCHED_NAME`</span>,<span class="string">`LOCK_NAME`</span>)</div><div class="line"></div><div class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8</div></pre></td></tr></table></figure></p>
<p><em>后面我们其实会发现，这个表是因为我copy的2.x版本的sql，所以导致表不兼容,也就是版本对应的话其实不会有这个问题的</em></p>
<p>因为SCHED_NAME其实我们目前并不知道，但是追到代码里有查询这个锁的代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">StdRowLockSemaphore.executeSQL的注释：Execute the SQL select for update that will lock the proper database row.</div></pre></td></tr></table></figure></p>
<h2 id="问题3"><a href="#问题3" class="headerlink" title="问题3"></a>问题3</h2><blockquote>
<p>Uable to serialize JobDataMap for insertion into database because the value of property ‘methodInvoker’ is not serializable: org.springframework.scheduling.quartz.MethodInvokingJobDetailFactoryBean</p>
</blockquote>
<p>原因就是是用的org.springframework.scheduling.quartz.MethodInvokingJobDetailFactoryBean的个别属性不能序列化，所以不能把Job写到mysql的表里去。那就换个方式<br>改用org.springframework.scheduling.quartz.JobDetailBean<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WillSpringJob</span> <span class="keyword">extends</span> <span class="title">QuartzJobBean</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> Scheduler scheduler;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">executeInternal</span><span class="params">(JobExecutionContext context)</span> <span class="keyword">throws</span> JobExecutionException </span>&#123;</div><div class="line">                System.out.println(<span class="string">"sssssssssssssssss"</span>);</div><div class="line">                    </div><div class="line">        &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>相关任务修改<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"abnormalDitail"</span> <span class="attr">class</span>=<span class="string">"org.springframework.scheduling.quartz.JobDetailBean"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jobClass"</span> <span class="attr">value</span>=<span class="string">"com.task.WillSpringJob"</span> /&gt;</span></div><div class="line">     <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jobDataAsMap"</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">map</span>&gt;</span></div><div class="line">       <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"timeout"</span> <span class="attr">value</span>=<span class="string">"5"</span> /&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">map</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h2 id="问题4"><a href="#问题4" class="headerlink" title="问题4"></a>问题4</h2><blockquote>
<p>Error creating bean with name ‘quartzScheduler’ defined in file [/Users/will/work/dolphin/target/classes/task/TestTask.xml]: Invocation of init method failed; nested exception is org.quartz.JobPersistenceException: Couldn’t store job: Unknown column ‘IS_VOLATILE’ in ‘field list’ [See nested exception: com.mysql.jdbc.exceptions.jdbc4.MySQLSyntaxErrorException: Unknown column ‘IS_VOLATILE’ in ‘field list’]:<br>com.mysql.jdbc.exceptions.jdbc4.MySQLSyntaxErrorException: Unknown column ‘IS_VOLATILE’ in ‘field list’</p>
</blockquote>
<p>稍微想一下，验证过没有锁之后，启动spring之后，应该是读取job配置文件，然后就将这些job插入到mysql的表QRTZ_JOB_DETAILS中去，以便于集群共同承担任务调度。所以这个不在field list里的字段就是QRTZ_JOB_DETAILS表里的。看来我找的sql版本与目前用到的quartz版本不一致。。。</p>
<p>为了让自己当前稍微爽一下，先在mysql里直接修改表，添加这个字段。后续又出现了IS_STATEFUL。<br>然后又报错：Field ‘SCHED_NAME’ doesn’t have a default value。<br>fun，找版本，不玩儿了。最终定的版本是1.8.6。</p>
<h2 id="建表语句"><a href="#建表语句" class="headerlink" title="建表语句"></a>建表语句</h2><p>用quartz管理任务计划很方便，但是当使用数据库作为存储介质的时候，必须要先创建表，不然就会报错。1.x和2.x的建表语句不同，以下是两个版本使用MySQL时的建表语句。<br>1.x建表语句为：<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div></pre></td><td class="code"><pre><div class="line">#</div><div class="line"># In your Quartz properties file, you'll need to set </div><div class="line"># org.quartz.jobStore.driverDelegateClass = org.quartz.impl.jdbcjobstore.StdJDBCDelegate</div><div class="line">#</div><div class="line">#</div><div class="line"># By: Ron Cordell - roncordell</div><div class="line">#  I didn't see this anywhere, so I thought I'd post it here. This is the script from Quartz to create the tables in a MySQL database, modified to use INNODB instead of MYISAM.</div><div class="line"></div><div class="line">DROP TABLE IF EXISTS QRTZ_JOB_LISTENERS;</div><div class="line">DROP TABLE IF EXISTS QRTZ_TRIGGER_LISTENERS;</div><div class="line">DROP TABLE IF EXISTS QRTZ_FIRED_TRIGGERS;</div><div class="line">DROP TABLE IF EXISTS QRTZ_PAUSED_TRIGGER_GRPS;</div><div class="line">DROP TABLE IF EXISTS QRTZ_SCHEDULER_STATE;</div><div class="line">DROP TABLE IF EXISTS QRTZ_LOCKS;</div><div class="line">DROP TABLE IF EXISTS QRTZ_SIMPLE_TRIGGERS;</div><div class="line">DROP TABLE IF EXISTS QRTZ_CRON_TRIGGERS;</div><div class="line">DROP TABLE IF EXISTS QRTZ_BLOB_TRIGGERS;</div><div class="line">DROP TABLE IF EXISTS QRTZ_TRIGGERS;</div><div class="line">DROP TABLE IF EXISTS QRTZ_JOB_DETAILS;</div><div class="line">DROP TABLE IF EXISTS QRTZ_CALENDARS;</div><div class="line">CREATE TABLE QRTZ_JOB_DETAILS(</div><div class="line">JOB_NAME VARCHAR(200) NOT NULL,</div><div class="line">JOB_GROUP VARCHAR(200) NOT NULL,</div><div class="line">DESCRIPTION VARCHAR(250) NULL,</div><div class="line">JOB_CLASS_NAME VARCHAR(250) NOT NULL,</div><div class="line">IS_DURABLE VARCHAR(1) NOT NULL,</div><div class="line">IS_VOLATILE VARCHAR(1) NOT NULL,</div><div class="line">IS_STATEFUL VARCHAR(1) NOT NULL,</div><div class="line">REQUESTS_RECOVERY VARCHAR(1) NOT NULL,</div><div class="line">JOB_DATA BLOB NULL,</div><div class="line">PRIMARY KEY (JOB_NAME,JOB_GROUP)</div><div class="line">)</div><div class="line">ENGINE=InnoDB;</div><div class="line"></div><div class="line">CREATE TABLE QRTZ_JOB_LISTENERS (</div><div class="line">JOB_NAME VARCHAR(200) NOT NULL,</div><div class="line">JOB_GROUP VARCHAR(200) NOT NULL,</div><div class="line">JOB_LISTENER VARCHAR(200) NOT NULL,</div><div class="line">PRIMARY KEY (JOB_NAME,JOB_GROUP,JOB_LISTENER),</div><div class="line">INDEX (JOB_NAME, JOB_GROUP),</div><div class="line">FOREIGN KEY (JOB_NAME,JOB_GROUP)</div><div class="line">REFERENCES QRTZ_JOB_DETAILS(JOB_NAME,JOB_GROUP)</div><div class="line">)</div><div class="line">ENGINE=InnoDB;</div><div class="line"></div><div class="line">CREATE TABLE QRTZ_TRIGGERS (</div><div class="line">TRIGGER_NAME VARCHAR(200) NOT NULL,</div><div class="line">TRIGGER_GROUP VARCHAR(200) NOT NULL,</div><div class="line">JOB_NAME VARCHAR(200) NOT NULL,</div><div class="line">JOB_GROUP VARCHAR(200) NOT NULL,</div><div class="line">IS_VOLATILE VARCHAR(1) NOT NULL,</div><div class="line">DESCRIPTION VARCHAR(250) NULL,</div><div class="line">NEXT_FIRE_TIME BIGINT(13) NULL,</div><div class="line">PREV_FIRE_TIME BIGINT(13) NULL,</div><div class="line">PRIORITY INTEGER NULL,</div><div class="line">TRIGGER_STATE VARCHAR(16) NOT NULL,</div><div class="line">TRIGGER_TYPE VARCHAR(8) NOT NULL,</div><div class="line">START_TIME BIGINT(13) NOT NULL,</div><div class="line">END_TIME BIGINT(13) NULL,</div><div class="line">CALENDAR_NAME VARCHAR(200) NULL,</div><div class="line">MISFIRE_INSTR SMALLINT(2) NULL,</div><div class="line">JOB_DATA BLOB NULL,</div><div class="line">PRIMARY KEY (TRIGGER_NAME,TRIGGER_GROUP),</div><div class="line">INDEX (JOB_NAME, JOB_GROUP),</div><div class="line">FOREIGN KEY (JOB_NAME,JOB_GROUP)</div><div class="line">REFERENCES QRTZ_JOB_DETAILS(JOB_NAME,JOB_GROUP)</div><div class="line">)</div><div class="line">ENGINE=InnoDB;</div><div class="line"></div><div class="line">CREATE TABLE QRTZ_SIMPLE_TRIGGERS (</div><div class="line">TRIGGER_NAME VARCHAR(200) NOT NULL,</div><div class="line">TRIGGER_GROUP VARCHAR(200) NOT NULL,</div><div class="line">REPEAT_COUNT BIGINT(7) NOT NULL,</div><div class="line">REPEAT_INTERVAL BIGINT(12) NOT NULL,</div><div class="line">TIMES_TRIGGERED BIGINT(10) NOT NULL,</div><div class="line">PRIMARY KEY (TRIGGER_NAME,TRIGGER_GROUP),</div><div class="line">INDEX (TRIGGER_NAME, TRIGGER_GROUP),</div><div class="line">FOREIGN KEY (TRIGGER_NAME,TRIGGER_GROUP)</div><div class="line">REFERENCES QRTZ_TRIGGERS(TRIGGER_NAME,TRIGGER_GROUP)</div><div class="line">)</div><div class="line">ENGINE=InnoDB;</div><div class="line"></div><div class="line">CREATE TABLE QRTZ_CRON_TRIGGERS (</div><div class="line">TRIGGER_NAME VARCHAR(200) NOT NULL,</div><div class="line">TRIGGER_GROUP VARCHAR(200) NOT NULL,</div><div class="line">CRON_EXPRESSION VARCHAR(120) NOT NULL,</div><div class="line">TIME_ZONE_ID VARCHAR(80),</div><div class="line">PRIMARY KEY (TRIGGER_NAME,TRIGGER_GROUP),</div><div class="line">INDEX (TRIGGER_NAME, TRIGGER_GROUP),</div><div class="line">FOREIGN KEY (TRIGGER_NAME,TRIGGER_GROUP)</div><div class="line">REFERENCES QRTZ_TRIGGERS(TRIGGER_NAME,TRIGGER_GROUP)</div><div class="line">)</div><div class="line">ENGINE=InnoDB;</div><div class="line"></div><div class="line">CREATE TABLE QRTZ_BLOB_TRIGGERS (</div><div class="line">TRIGGER_NAME VARCHAR(200) NOT NULL,</div><div class="line">TRIGGER_GROUP VARCHAR(200) NOT NULL,</div><div class="line">BLOB_DATA BLOB NULL,</div><div class="line">PRIMARY KEY (TRIGGER_NAME,TRIGGER_GROUP),</div><div class="line">INDEX (TRIGGER_NAME, TRIGGER_GROUP),</div><div class="line">FOREIGN KEY (TRIGGER_NAME,TRIGGER_GROUP)</div><div class="line">REFERENCES QRTZ_TRIGGERS(TRIGGER_NAME,TRIGGER_GROUP)</div><div class="line">)</div><div class="line">ENGINE=InnoDB;</div><div class="line"></div><div class="line">CREATE TABLE QRTZ_TRIGGER_LISTENERS (</div><div class="line">TRIGGER_NAME VARCHAR(200) NOT NULL,</div><div class="line">TRIGGER_GROUP VARCHAR(200) NOT NULL,</div><div class="line">TRIGGER_LISTENER VARCHAR(200) NOT NULL,</div><div class="line">PRIMARY KEY (TRIGGER_NAME,TRIGGER_GROUP,TRIGGER_LISTENER),</div><div class="line">INDEX (TRIGGER_NAME, TRIGGER_GROUP),</div><div class="line">FOREIGN KEY (TRIGGER_NAME,TRIGGER_GROUP)</div><div class="line">REFERENCES QRTZ_TRIGGERS(TRIGGER_NAME,TRIGGER_GROUP)</div><div class="line">)</div><div class="line">ENGINE=InnoDB;</div><div class="line"></div><div class="line">CREATE TABLE QRTZ_CALENDARS (</div><div class="line">CALENDAR_NAME VARCHAR(200) NOT NULL,</div><div class="line">CALENDAR BLOB NOT NULL,</div><div class="line">PRIMARY KEY (CALENDAR_NAME)</div><div class="line">)</div><div class="line">ENGINE=InnoDB;</div><div class="line"></div><div class="line">CREATE TABLE QRTZ_PAUSED_TRIGGER_GRPS (</div><div class="line">TRIGGER_GROUP VARCHAR(200) NOT NULL,</div><div class="line">PRIMARY KEY (TRIGGER_GROUP)</div><div class="line">)</div><div class="line">ENGINE=InnoDB;</div><div class="line"></div><div class="line">CREATE TABLE QRTZ_FIRED_TRIGGERS (</div><div class="line">ENTRY_ID VARCHAR(95) NOT NULL,</div><div class="line">TRIGGER_NAME VARCHAR(200) NOT NULL,</div><div class="line">TRIGGER_GROUP VARCHAR(200) NOT NULL,</div><div class="line">IS_VOLATILE VARCHAR(1) NOT NULL,</div><div class="line">INSTANCE_NAME VARCHAR(200) NOT NULL,</div><div class="line">FIRED_TIME BIGINT(13) NOT NULL,</div><div class="line">PRIORITY INTEGER NOT NULL,</div><div class="line">STATE VARCHAR(16) NOT NULL,</div><div class="line">JOB_NAME VARCHAR(200) NULL,</div><div class="line">JOB_GROUP VARCHAR(200) NULL,</div><div class="line">IS_STATEFUL VARCHAR(1) NULL,</div><div class="line">REQUESTS_RECOVERY VARCHAR(1) NULL,</div><div class="line">PRIMARY KEY (ENTRY_ID)</div><div class="line">)</div><div class="line">ENGINE=InnoDB;</div><div class="line"></div><div class="line">CREATE TABLE QRTZ_SCHEDULER_STATE (</div><div class="line">INSTANCE_NAME VARCHAR(200) NOT NULL,</div><div class="line">LAST_CHECKIN_TIME BIGINT(13) NOT NULL,</div><div class="line">CHECKIN_INTERVAL BIGINT(13) NOT NULL,</div><div class="line">PRIMARY KEY (INSTANCE_NAME)</div><div class="line">)</div><div class="line">ENGINE=InnoDB;</div><div class="line"></div><div class="line">CREATE TABLE QRTZ_LOCKS (</div><div class="line">LOCK_NAME VARCHAR(40) NOT NULL,</div><div class="line">PRIMARY KEY (LOCK_NAME)</div><div class="line">)</div><div class="line">ENGINE=InnoDB;</div><div class="line"></div><div class="line">INSERT INTO QRTZ_LOCKS values('TRIGGER_ACCESS');</div><div class="line">INSERT INTO QRTZ_LOCKS values('JOB_ACCESS');</div><div class="line">INSERT INTO QRTZ_LOCKS values('CALENDAR_ACCESS');</div><div class="line">INSERT INTO QRTZ_LOCKS values('STATE_ACCESS');</div><div class="line">INSERT INTO QRTZ_LOCKS values('MISFIRE_ACCESS');</div><div class="line">commit;</div></pre></td></tr></table></figure></p>
<p>2.x版本的建表语句为：<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div></pre></td><td class="code"><pre><div class="line">#</div><div class="line"># In your Quartz properties file, you'll need to set </div><div class="line"># org.quartz.jobStore.driverDelegateClass = org.quartz.impl.jdbcjobstore.StdJDBCDelegate</div><div class="line">#</div><div class="line">#</div><div class="line"># By: Ron Cordell - roncordell</div><div class="line">#  I didn't see this anywhere, so I thought I'd post it here. This is the script from Quartz to create the tables in a MySQL database, modified to use INNODB instead of MYISAM.</div><div class="line"></div><div class="line">DROP TABLE IF EXISTS QRTZ_FIRED_TRIGGERS;</div><div class="line">DROP TABLE IF EXISTS QRTZ_PAUSED_TRIGGER_GRPS;</div><div class="line">DROP TABLE IF EXISTS QRTZ_SCHEDULER_STATE;</div><div class="line">DROP TABLE IF EXISTS QRTZ_LOCKS;</div><div class="line">DROP TABLE IF EXISTS QRTZ_SIMPLE_TRIGGERS;</div><div class="line">DROP TABLE IF EXISTS QRTZ_SIMPROP_TRIGGERS;</div><div class="line">DROP TABLE IF EXISTS QRTZ_CRON_TRIGGERS;</div><div class="line">DROP TABLE IF EXISTS QRTZ_BLOB_TRIGGERS;</div><div class="line">DROP TABLE IF EXISTS QRTZ_TRIGGERS;</div><div class="line">DROP TABLE IF EXISTS QRTZ_JOB_DETAILS;</div><div class="line">DROP TABLE IF EXISTS QRTZ_CALENDARS;</div><div class="line"></div><div class="line">CREATE TABLE QRTZ_JOB_DETAILS(</div><div class="line">SCHED_NAME VARCHAR(120) NOT NULL,</div><div class="line">JOB_NAME VARCHAR(200) NOT NULL,</div><div class="line">JOB_GROUP VARCHAR(200) NOT NULL,</div><div class="line">DESCRIPTION VARCHAR(250) NULL,</div><div class="line">JOB_CLASS_NAME VARCHAR(250) NOT NULL,</div><div class="line">IS_DURABLE VARCHAR(1) NOT NULL,</div><div class="line">IS_NONCONCURRENT VARCHAR(1) NOT NULL,</div><div class="line">IS_UPDATE_DATA VARCHAR(1) NOT NULL,</div><div class="line">REQUESTS_RECOVERY VARCHAR(1) NOT NULL,</div><div class="line">JOB_DATA BLOB NULL,</div><div class="line">PRIMARY KEY (SCHED_NAME,JOB_NAME,JOB_GROUP)</div><div class="line">)</div><div class="line">ENGINE=InnoDB;</div><div class="line"></div><div class="line">CREATE TABLE QRTZ_TRIGGERS (</div><div class="line">SCHED_NAME VARCHAR(120) NOT NULL,</div><div class="line">TRIGGER_NAME VARCHAR(200) NOT NULL,</div><div class="line">TRIGGER_GROUP VARCHAR(200) NOT NULL,</div><div class="line">JOB_NAME VARCHAR(200) NOT NULL,</div><div class="line">JOB_GROUP VARCHAR(200) NOT NULL,</div><div class="line">DESCRIPTION VARCHAR(250) NULL,</div><div class="line">NEXT_FIRE_TIME BIGINT(13) NULL,</div><div class="line">PREV_FIRE_TIME BIGINT(13) NULL,</div><div class="line">PRIORITY INTEGER NULL,</div><div class="line">TRIGGER_STATE VARCHAR(16) NOT NULL,</div><div class="line">TRIGGER_TYPE VARCHAR(8) NOT NULL,</div><div class="line">START_TIME BIGINT(13) NOT NULL,</div><div class="line">END_TIME BIGINT(13) NULL,</div><div class="line">CALENDAR_NAME VARCHAR(200) NULL,</div><div class="line">MISFIRE_INSTR SMALLINT(2) NULL,</div><div class="line">JOB_DATA BLOB NULL,</div><div class="line">PRIMARY KEY (SCHED_NAME,TRIGGER_NAME,TRIGGER_GROUP),</div><div class="line">FOREIGN KEY (SCHED_NAME,JOB_NAME,JOB_GROUP)</div><div class="line">REFERENCES QRTZ_JOB_DETAILS(SCHED_NAME,JOB_NAME,JOB_GROUP)</div><div class="line">)</div><div class="line">ENGINE=InnoDB;</div><div class="line"></div><div class="line">CREATE TABLE QRTZ_SIMPLE_TRIGGERS (</div><div class="line">SCHED_NAME VARCHAR(120) NOT NULL,</div><div class="line">TRIGGER_NAME VARCHAR(200) NOT NULL,</div><div class="line">TRIGGER_GROUP VARCHAR(200) NOT NULL,</div><div class="line">REPEAT_COUNT BIGINT(7) NOT NULL,</div><div class="line">REPEAT_INTERVAL BIGINT(12) NOT NULL,</div><div class="line">TIMES_TRIGGERED BIGINT(10) NOT NULL,</div><div class="line">PRIMARY KEY (SCHED_NAME,TRIGGER_NAME,TRIGGER_GROUP),</div><div class="line">FOREIGN KEY (SCHED_NAME,TRIGGER_NAME,TRIGGER_GROUP)</div><div class="line">REFERENCES QRTZ_TRIGGERS(SCHED_NAME,TRIGGER_NAME,TRIGGER_GROUP)</div><div class="line">)</div><div class="line">ENGINE=InnoDB;</div><div class="line"></div><div class="line">CREATE TABLE QRTZ_CRON_TRIGGERS (</div><div class="line">SCHED_NAME VARCHAR(120) NOT NULL,</div><div class="line">TRIGGER_NAME VARCHAR(200) NOT NULL,</div><div class="line">TRIGGER_GROUP VARCHAR(200) NOT NULL,</div><div class="line">CRON_EXPRESSION VARCHAR(120) NOT NULL,</div><div class="line">TIME_ZONE_ID VARCHAR(80),</div><div class="line">PRIMARY KEY (SCHED_NAME,TRIGGER_NAME,TRIGGER_GROUP),</div><div class="line">FOREIGN KEY (SCHED_NAME,TRIGGER_NAME,TRIGGER_GROUP)</div><div class="line">REFERENCES QRTZ_TRIGGERS(SCHED_NAME,TRIGGER_NAME,TRIGGER_GROUP)</div><div class="line">)</div><div class="line">ENGINE=InnoDB;</div><div class="line"></div><div class="line">CREATE TABLE QRTZ_SIMPROP_TRIGGERS</div><div class="line"> (          </div><div class="line">SCHED_NAME VARCHAR(120) NOT NULL,</div><div class="line">TRIGGER_NAME VARCHAR(200) NOT NULL,</div><div class="line">TRIGGER_GROUP VARCHAR(200) NOT NULL,</div><div class="line">STR_PROP_1 VARCHAR(512) NULL,</div><div class="line">STR_PROP_2 VARCHAR(512) NULL,</div><div class="line">STR_PROP_3 VARCHAR(512) NULL,</div><div class="line">INT_PROP_1 INT NULL,</div><div class="line">INT_PROP_2 INT NULL,</div><div class="line">LONG_PROP_1 BIGINT NULL,</div><div class="line">LONG_PROP_2 BIGINT NULL,</div><div class="line">DEC_PROP_1 NUMERIC(13,4) NULL,</div><div class="line">EC_PROP_2 NUMERIC(13,4) NULL,</div><div class="line">BOOL_PROP_1 VARCHAR(1) NULL,</div><div class="line">OOL_PROP_2 VARCHAR(1) NULL,</div><div class="line">RIMARY KEY (SCHED_NAME,TRIGGER_NAME,TRIGGER_GROUP),</div><div class="line">OREIGN KEY (SCHED_NAME,TRIGGER_NAME,TRIGGER_GROUP) </div><div class="line">REFERENCES QRTZ_TRIGGERS(SCHED_NAME,TRIGGER_NAME,TRIGGER_GROUP))</div><div class="line">ENGINE=InnoDB;</div><div class="line"></div><div class="line">CREATE TABLE QRTZ_BLOB_TRIGGERS (</div><div class="line">SCHED_NAME VARCHAR(120) NOT NULL,</div><div class="line">TRIGGER_NAME VARCHAR(200) NOT NULL,</div><div class="line">TRIGGER_GROUP VARCHAR(200) NOT NULL,</div><div class="line">BLOB_DATA BLOB NULL,</div><div class="line">PRIMARY KEY (SCHED_NAME,TRIGGER_NAME,TRIGGER_GROUP),</div><div class="line">INDEX (SCHED_NAME,TRIGGER_NAME, TRIGGER_GROUP),</div><div class="line">FOREIGN KEY (SCHED_NAME,TRIGGER_NAME,TRIGGER_GROUP)</div><div class="line">REFERENCES QRTZ_TRIGGERS(SCHED_NAME,TRIGGER_NAME,TRIGGER_GROUP)</div><div class="line">)</div><div class="line">ENGINE=InnoDB;</div><div class="line"></div><div class="line">CREATE TABLE QRTZ_CALENDARS (</div><div class="line">SCHED_NAME VARCHAR(120) NOT NULL,</div><div class="line">CALENDAR_NAME VARCHAR(200) NOT NULL,</div><div class="line">CALENDAR BLOB NOT NULL,</div><div class="line">PRIMARY KEY (SCHED_NAME,CALENDAR_NAME)</div><div class="line">)</div><div class="line">ENGINE=InnoDB;</div><div class="line"></div><div class="line">CREATE TABLE QRTZ_PAUSED_TRIGGER_GRPS (</div><div class="line">SCHED_NAME VARCHAR(120) NOT NULL,</div><div class="line">TRIGGER_GROUP VARCHAR(200) NOT NULL,</div><div class="line">PRIMARY KEY (SCHED_NAME,TRIGGER_GROUP)</div><div class="line">)</div><div class="line">ENGINE=InnoDB;</div><div class="line"></div><div class="line">CREATE TABLE QRTZ_FIRED_TRIGGERS (</div><div class="line">SCHED_NAME VARCHAR(120) NOT NULL,</div><div class="line">ENTRY_ID VARCHAR(95) NOT NULL,</div><div class="line">TRIGGER_NAME VARCHAR(200) NOT NULL,</div><div class="line">TRIGGER_GROUP VARCHAR(200) NOT NULL,</div><div class="line">INSTANCE_NAME VARCHAR(200) NOT NULL,</div><div class="line">FIRED_TIME BIGINT(13) NOT NULL,</div><div class="line">SCHED_TIME BIGINT(13) NOT NULL,</div><div class="line">PRIORITY INTEGER NOT NULL,</div><div class="line">STATE VARCHAR(16) NOT NULL,</div><div class="line">JOB_NAME VARCHAR(200) NULL,</div><div class="line">JOB_GROUP VARCHAR(200) NULL,</div><div class="line">IS_NONCONCURRENT VARCHAR(1) NULL,</div><div class="line">REQUESTS_RECOVERY VARCHAR(1) NULL,</div><div class="line">PRIMARY KEY (SCHED_NAME,ENTRY_ID)</div><div class="line">)</div><div class="line">ENGINE=InnoDB;</div><div class="line"></div><div class="line">CREATE TABLE QRTZ_SCHEDULER_STATE (</div><div class="line">SCHED_NAME VARCHAR(120) NOT NULL,</div><div class="line">INSTANCE_NAME VARCHAR(200) NOT NULL,</div><div class="line">LAST_CHECKIN_TIME BIGINT(13) NOT NULL,</div><div class="line">CHECKIN_INTERVAL BIGINT(13) NOT NULL,</div><div class="line">PRIMARY KEY (SCHED_NAME,INSTANCE_NAME)</div><div class="line">)</div><div class="line">ENGINE=InnoDB;</div><div class="line"></div><div class="line">CREATE TABLE QRTZ_LOCKS (</div><div class="line">SCHED_NAME VARCHAR(120) NOT NULL,</div><div class="line">LOCK_NAME VARCHAR(40) NOT NULL,</div><div class="line">PRIMARY KEY (SCHED_NAME,LOCK_NAME)</div><div class="line">)</div><div class="line">ENGINE=InnoDB;</div><div class="line">CREATE INDEX IDX_QRTZ_J_REQ_RECOVERY ON QRTZ_JOB_DETAILS(SCHED_NAME,REQUESTS_RECOVERY);</div><div class="line">CREATE INDEX IDX_QRTZ_J_GRP ON QRTZ_JOB_DETAILS(SCHED_NAME,JOB_GROUP);</div><div class="line"></div><div class="line">CREATE INDEX IDX_QRTZ_T_J ON QRTZ_TRIGGERS(SCHED_NAME,JOB_NAME,JOB_GROUP);</div><div class="line">CREATE INDEX IDX_QRTZ_T_JG ON QRTZ_TRIGGERS(SCHED_NAME,JOB_GROUP);</div><div class="line">CREATE INDEX IDX_QRTZ_T_C ON QRTZ_TRIGGERS(SCHED_NAME,CALENDAR_NAME);</div><div class="line">CREATE INDEX IDX_QRTZ_T_G ON QRTZ_TRIGGERS(SCHED_NAME,TRIGGER_GROUP);</div><div class="line">CREATE INDEX IDX_QRTZ_T_STATE ON QRTZ_TRIGGERS(SCHED_NAME,TRIGGER_STATE);</div><div class="line">CREATE INDEX IDX_QRTZ_T_N_STATE ON QRTZ_TRIGGERS(SCHED_NAME,TRIGGER_NAME,TRIGGER_GROUP,TRIGGER_STATE);</div><div class="line">CREATE INDEX IDX_QRTZ_T_N_G_STATE ON QRTZ_TRIGGERS(SCHED_NAME,TRIGGER_GROUP,TRIGGER_STATE);</div><div class="line">CREATE INDEX IDX_QRTZ_T_NEXT_FIRE_TIME ON QRTZ_TRIGGERS(SCHED_NAME,NEXT_FIRE_TIME);</div><div class="line">CREATE INDEX IDX_QRTZ_T_NFT_ST ON QRTZ_TRIGGERS(SCHED_NAME,TRIGGER_STATE,NEXT_FIRE_TIME);</div><div class="line">CREATE INDEX IDX_QRTZ_T_NFT_MISFIRE ON QRTZ_TRIGGERS(SCHED_NAME,MISFIRE_INSTR,NEXT_FIRE_TIME);</div><div class="line">CREATE INDEX IDX_QRTZ_T_NFT_ST_MISFIRE ON QRTZ_TRIGGERS(SCHED_NAME,MISFIRE_INSTR,NEXT_FIRE_TIME,TRIGGER_STATE);</div><div class="line">CREATE INDEX IDX_QRTZ_T_NFT_ST_MISFIRE_GRP ON QRTZ_TRIGGERS(SCHED_NAME,MISFIRE_INSTR,NEXT_FIRE_TIME,TRIGGER_GROUP,TRIGGER_STATE);</div><div class="line"></div><div class="line">CREATE INDEX IDX_QRTZ_FT_TRIG_INST_NAME ON QRTZ_FIRED_TRIGGERS(SCHED_NAME,INSTANCE_NAME);</div><div class="line">CREATE INDEX IDX_QRTZ_FT_INST_JOB_REQ_RCVRY ON QRTZ_FIRED_TRIGGERS(SCHED_NAME,INSTANCE_NAME,REQUESTS_RECOVERY);</div><div class="line">CREATE INDEX IDX_QRTZ_FT_J_G ON QRTZ_FIRED_TRIGGERS(SCHED_NAME,JOB_NAME,JOB_GROUP);</div><div class="line">CREATE INDEX IDX_QRTZ_FT_JG ON QRTZ_FIRED_TRIGGERS(SCHED_NAME,JOB_GROUP);</div><div class="line">CREATE INDEX IDX_QRTZ_FT_T_G ON QRTZ_FIRED_TRIGGERS(SCHED_NAME,TRIGGER_NAME,TRIGGER_GROUP);</div><div class="line">CREATE INDEX IDX_QRTZ_FT_TG ON QRTZ_FIRED_TRIGGERS(SCHED_NAME,TRIGGER_GROUP);</div><div class="line"></div><div class="line">commit;</div></pre></td></tr></table></figure></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    

    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/spring/">spring</a><a href="/tags/quartz/">quartz</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>





   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/12/09/springboot坑记1/" title="springboot坑记1" itemprop="url">springboot坑记1</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Will Chen" target="_blank" itemprop="author">Will Chen</a>
		
  <p class="article-time">
    <time datetime="2015-12-09T02:18:08.000Z" itemprop="datePublished"> 发表于 2015-12-09</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>业务上需要做一些定时任务的调度，最好还能对这些调度的状态进行记录与监控，可以通过一个友好的界面看到调度的执行情况是最好的。<br>考虑的范围：spring + quartz、dropwizard、spring boot，因为当前公司的项目是使用spring mvc写的，也就是说公司的人力资源方面偏向于spring序列。<br>放弃quartz的原因：</p>
<pre><code>- 只是负责调度，没有看到有对调度进度或者状态有监控的地方
- 对于调度堆叠的处理不是很清楚
</code></pre><p>最终定位到spring boot：</p>
<pre><code>- 计划是使用spring的web来进行调度监控方面的工作
- ApplicationRunner来启动自己写的调度器。
</code></pre>
        
        
        <p class="article-more-link">
          
       </p>
    </div>
    

    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/spring/">spring</a><a href="/tags/spring-boot/">spring boot</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>





   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/12/08/mysql新技能-update-join/" title="mysql新技能-update join" itemprop="url">mysql新技能-update join</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Will Chen" target="_blank" itemprop="author">Will Chen</a>
		
  <p class="article-time">
    <time datetime="2015-12-08T02:56:30.000Z" itemprop="datePublished"> 发表于 2015-12-08</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>上面说到了insert overwrite或者insert update的思想。这里说另一种场景，就是我们需要使用a表的直接或者间接数据来更新b表里的数据内容。比如a是所有订单，而b是所有商家订单总金额统计，业务就自然是定时计算a里所有订单的金额汇总，然后udpate到b表里面去。<br><em>这里其实也有insert update的需要，比如判断某商家是否存在，但是我们这里只关注update</em></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">update</span></div><div class="line">    b </div><div class="line"><span class="keyword">join</span></div><div class="line">(</div><div class="line">	<span class="keyword">select</span> </div><div class="line">		poi_id,</div><div class="line">		<span class="keyword">sum</span>(fee) total_act_cost,</div><div class="line">		<span class="keyword">sum</span>(fee - poi_charge_fee) act_cost</div><div class="line">	<span class="keyword">from</span></div><div class="line">		a</div><div class="line">	<span class="keyword">where</span> </div><div class="line">		ctime <span class="keyword">between</span> #&#123;start_time&#125; <span class="keyword">and</span> #&#123;end_time&#125;</div><div class="line">		<span class="keyword">and</span> valid=<span class="number">1</span></div><div class="line">		<span class="keyword">and</span> <span class="keyword">status</span>=<span class="number">9</span></div><div class="line">	<span class="keyword">group</span> <span class="keyword">by</span> </div><div class="line">		poi_id</div><div class="line">) temp </div><div class="line"><span class="keyword">on</span> </div><div class="line">	a.poi_id = b.poi_id</div><div class="line"><span class="keyword">set</span> </div><div class="line">	b.total_act_cost = temp.total_act_cost,</div><div class="line">	b.act_cost = temp.act_cost,</div><div class="line">	b.act_flag=<span class="number">1</span></div><div class="line"><span class="keyword">where</span> </div><div class="line">	b.order_time <span class="keyword">between</span> #&#123;start_time&#125; <span class="keyword">and</span> #&#123;end_time&#125;</div></pre></td></tr></table></figure>
<p>计算a里的指标结果，然后update到b的对应记录里面。</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    

    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/mysql/">mysql</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>





   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/12/08/mysql新技能-ON-DUPLICATE-KEY-UPDATE/" title="mysql新技能-ON DUPLICATE KEY UPDATE" itemprop="url">mysql新技能-ON DUPLICATE KEY UPDATE</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Will Chen" target="_blank" itemprop="author">Will Chen</a>
		
  <p class="article-time">
    <time datetime="2015-12-08T02:30:42.000Z" itemprop="datePublished"> 发表于 2015-12-08</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>向数据库插入数据的时候，我们会遇到一种情形：如果数据库中没有此条记录，就直接插入；如果已经存在此条记录，就更新其部分的字段值。这里定位“此条记录”是指在数据库中是唯一的，确定某个标识可以在数据库中唯一定位某一条记录。<br>玩儿hive的同学请注意意思，虽R是insert overwrite的大概思想，但是不会覆盖整个分区数据，而仅仅针对“此条记录”。</p>
<p>ON DUPLICATE KEY不会指定具体的唯一key是哪个,因为并没有必要，这个语句要求table里有unique key,或者primary key, 它会自动比较这个key是不是有重复，如果有重复就update，没有的话就直接insert。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">table</span> (a,b,c) <span class="keyword">VALUES</span> (<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)</div><div class="line">  <span class="keyword">ON</span> <span class="keyword">DUPLICATE</span> <span class="keyword">KEY</span> <span class="keyword">UPDATE</span> c=c+<span class="number">1</span>;</div><div class="line"></div><div class="line"><span class="keyword">UPDATE</span> <span class="keyword">table</span> <span class="keyword">SET</span> c=c+<span class="number">1</span> <span class="keyword">WHERE</span> a=<span class="number">1</span>;</div></pre></td></tr></table></figure>
<p>如果a=1这条记录存在，而且a是unique key的话，那么这两个句子是等同的。<br>这个句子还支持一下方式，就是可以同时更新多个字段的值，而且可以相互引用：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">table</span> (a,b,c) <span class="keyword">VALUES</span> (<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>),(<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>)</div><div class="line">  <span class="keyword">ON</span> <span class="keyword">DUPLICATE</span> <span class="keyword">KEY</span> <span class="keyword">UPDATE</span> c=<span class="keyword">VALUES</span>(a)+<span class="keyword">VALUES</span>(b), b=<span class="number">2</span>;</div></pre></td></tr></table></figure></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    

    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/mysql/">mysql</a><a href="/tags/sql/">sql</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>





   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/12/07/vim-vundle/" title="vim-vundle" itemprop="url">vim-vundle</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Will Chen" target="_blank" itemprop="author">Will Chen</a>
		
  <p class="article-time">
    <time datetime="2015-12-07T06:55:44.000Z" itemprop="datePublished"> 发表于 2015-12-07</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>传说中的vim，今儿哥们儿要强迫自己继续装个B，吼吼~~ 为哥的勇气鼓掌！！</p>
<h3 id="0-安装vundle"><a href="#0-安装vundle" class="headerlink" title="0.安装vundle"></a>0.安装vundle</h3><p>vundle是一个vim的插件管理器，涉猎了一段时间，发现很多人在用，为了更好更快地入门，就先玩儿个最活跃的，预料体验也不会特别差。</p>
<blockquote>
<p>git clone <a href="https://github.com/VundleVim/Vundle.vim.git" target="_blank" rel="external">https://github.com/VundleVim/Vundle.vim.git</a> ~/.vim/bundle/Vundle.vim</p>
</blockquote>
<h3 id="1-配置vundle"><a href="#1-配置vundle" class="headerlink" title="1.配置vundle"></a>1.配置vundle</h3><p>就是下载自己需<br>要的一些插件，其实现在我毛线都不知道，就是网上随便搜了几个比较综合了一下。<br>建议参考：<a href="https://github.com/VundleVim/Vundle.vim，了解最新的配置说明。" target="_blank" rel="external">https://github.com/VundleVim/Vundle.vim，了解最新的配置说明。</a><br>BTW, 牛人参考: <a href="https://github.com/VundleVim/Vundle.vim/wiki/Examples" target="_blank" rel="external">https://github.com/VundleVim/Vundle.vim/wiki/Examples</a></p>
<p>下面是我的~/.vimrc文件内容<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div></pre></td><td class="code"><pre><div class="line">et nocompatible                <span class="comment">" be iMproved</span></div><div class="line"><span class="keyword">filetype</span> off                    <span class="comment">" required!</span></div><div class="line"></div><div class="line"><span class="comment">" set the runtime path to include Vundle and initialize</span></div><div class="line"><span class="keyword">set</span> rtp+=~/.<span class="keyword">vim</span>/bundle/vundle/</div><div class="line"><span class="keyword">call</span> vundle#rc()</div><div class="line"></div><div class="line"><span class="comment">" let Vundle manage Vundle</span></div><div class="line"><span class="comment">" 使用vundle来管理</span></div><div class="line">Bundle <span class="string">'gmarik/vundle'</span></div><div class="line"></div><div class="line"><span class="comment">"my Bundle here:</span></div><div class="line"><span class="comment">"</span></div><div class="line"><span class="comment">" original repos on github</span></div><div class="line"><span class="comment">" 相较于Command-T等查找文件的插件，ctrlp.vim最大的好处在于没有依赖，干净利落</span></div><div class="line">Bundle <span class="string">'kien/ctrlp.vim'</span></div><div class="line"></div><div class="line"><span class="string">" 在输入()，"</span><span class="comment">"等需要配对的符号时，自动帮你补全剩余半个</span></div><div class="line">Bundle <span class="string">'AutoClose'</span></div><div class="line"></div><div class="line"><span class="string">" 在()、"</span><span class="comment">"、甚至HTML标签之间快速跳转；</span></div><div class="line">Bundle <span class="string">'matchit.zip'</span></div><div class="line"></div><div class="line"><span class="comment">" 显示行末的空格</span></div><div class="line">Bundle <span class="string">'ShowTrailingWhitespace'</span></div><div class="line"></div><div class="line"><span class="comment">" 用全新的方式在文档中高效的移动光标，革命性的突破</span></div><div class="line">Bundle <span class="string">'EasyMotion'</span></div><div class="line"></div><div class="line"><span class="comment">" 自动识别文件编码；</span></div><div class="line">Bundle <span class="string">'FencView.vim'</span></div><div class="line"><span class="comment">" 必不可少，在VIM的编辑窗口树状显示文件目录</span></div><div class="line">Bundle <span class="string">'The-NERD-tree'</span></div><div class="line"></div><div class="line"><span class="comment">" 解放生产力的神器，简单配置，就可以按照自己的风格快速输入大段代码。</span></div><div class="line">Bundle <span class="string">'UltiSnips'</span></div><div class="line">Bundle <span class="string">'sukima/xmledit'</span></div><div class="line">Bundle <span class="string">'sjl/gundo.vim'</span></div><div class="line">Bundle <span class="string">'jiangmiao/auto-pairs'</span></div><div class="line">Bundle <span class="string">'klen/python-mode'</span></div><div class="line">Bundle <span class="string">'Valloric/ListToggle'</span></div><div class="line"><span class="comment">"Bundle 'SirVer/ultisnips'</span></div><div class="line"></div><div class="line"><span class="comment">" 迄今位置最好的自动VIM自动补全插件了吧</span></div><div class="line">Bundle <span class="string">'Valloric/YouCompleteMe'</span></div><div class="line"></div><div class="line">Bundle <span class="string">'scrooloose/syntastic'</span></div><div class="line">Bundle <span class="string">'t9md/vim-quickhl'</span></div><div class="line"><span class="comment">" Bundle 'Lokaltog/vim-powerline'</span></div><div class="line">Bundle <span class="string">'scrooloose/nerdcommenter'</span></div><div class="line"></div><div class="line">Plugin <span class="string">'godlygeek/tabular'</span></div><div class="line">Plugin <span class="string">'plasticboy/vim-markdown'</span></div><div class="line"></div><div class="line"><span class="comment">"..................................</span></div><div class="line"><span class="comment">" vim-scripts repos</span></div><div class="line">Bundle <span class="string">'YankRing.vim'</span></div><div class="line">Bundle <span class="string">'vcscommand.vim'</span></div><div class="line">Bundle <span class="string">'ShowPairs'</span></div><div class="line">Bundle <span class="string">'SudoEdit.vim'</span></div><div class="line">Bundle <span class="string">'EasyGrep'</span></div><div class="line">Bundle <span class="string">'VOoM'</span></div><div class="line">Bundle <span class="string">'VimIM'</span></div><div class="line"><span class="comment">"..................................</span></div><div class="line"><span class="comment">" non github repos</span></div><div class="line"><span class="comment">" Bundle 'git://git.wincent.com/command-t.git'</span></div><div class="line"><span class="comment">"......................................</span></div><div class="line"><span class="keyword">filetype</span> plugin <span class="built_in">indent</span> <span class="keyword">on</span>	<span class="comment">"这一行就是结束了</span></div><div class="line"></div><div class="line"><span class="comment">" 粘贴错位问题</span></div><div class="line"><span class="keyword">nnoremap</span> <span class="symbol">&lt;F3&gt;</span> :<span class="keyword">set</span> invpaste paste?<span class="symbol">&lt;CR&gt;</span></div><div class="line"><span class="keyword">imap</span> <span class="symbol">&lt;F3&gt;</span> <span class="symbol">&lt;C-O&gt;</span>:<span class="keyword">set</span> invpaste paste?<span class="symbol">&lt;CR&gt;</span></div><div class="line"><span class="keyword">set</span> pastetoggle=<span class="symbol">&lt;F3&gt;</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">" nerdTree设置</span></div><div class="line"><span class="comment">" 在 vim 启动的时候默认开启 NERDTree（autocmd 可以缩写为 au）</span></div><div class="line"><span class="keyword">autocmd</span> VimEnter * NERDTree</div><div class="line"><span class="comment">" 按下 F2 调出/隐藏 NERDTree</span></div><div class="line"><span class="comment">" map  :silent! NERDTreeToggle</span></div><div class="line">silent! <span class="keyword">map</span> <span class="symbol">&lt;F2&gt;</span> :NERDTreeToggle<span class="symbol">&lt;CR&gt;</span></div><div class="line"><span class="keyword">let</span> <span class="variable">g:NERDTreeMapActivateNode</span>=<span class="string">"&lt;F2&gt;"</span></div><div class="line"><span class="comment">" 将 NERDTree 的窗口设置在 vim 窗口的右侧（默认为左侧）</span></div><div class="line"><span class="string">" let NERDTreeWinPos="</span><span class="keyword">right</span><span class="comment">"</span></div><div class="line"><span class="comment">" 当打开 NERDTree 窗口时，自动显示 Bookmarks</span></div><div class="line"><span class="keyword">let</span> NERDTreeShowBookmarks=<span class="number">1</span></div></pre></td></tr></table></figure></p>
<h3 id="2-简单使用"><a href="#2-简单使用" class="headerlink" title="2.简单使用"></a>2.简单使用</h3><p>本人的一贯原则，首先找官方的文档或者手册怎样查找: 在vim中使用:h vundle定位<br><img src="/imgs/vim/help_vundle.png" alt=""></p>
<table>
<thead>
<tr>
<th><em>命令</em></th>
<th style="text-align:left"><em>描述</em></th>
</tr>
</thead>
<tbody>
<tr>
<td>:PluginUpdate</td>
<td style="text-align:left">更新指定的plugin</td>
</tr>
<tr>
<td>:PluginList</td>
<td style="text-align:left">显示已经安装的plugin</td>
</tr>
<tr>
<td>:PluginClean</td>
<td style="text-align:left">清除配置里没有的plugin，针对bundle目录</td>
</tr>
<tr>
<td>:PluginSearch xxx</td>
<td style="text-align:left">搜索是否包含某个plugin</td>
</tr>
</tbody>
</table>
<h3 id="3-do-it-yourself"><a href="#3-do-it-yourself" class="headerlink" title="3. do it yourself"></a>3. do it yourself</h3><p>既然配置好了插件，也学习了vundle的最基础命令，最后就只剩下我们去实际体验了。<br><img src="/imgs/vim/install_vundle_plugin.png" alt="执行:PluginInstall之后的界面"><br>上面的过程其实就是在安装所有.vimrc里声明给vundle要去安装的插件，安装后的目录结构如下图：<br><img src="/imgs/vim/vim_plugins_dir.png" alt=""><br><em>友情提示</em>：安装完这些组件后，发现vundle的命令是可以通过tab进行自动补全的。</p>
<h3 id="4-安装markdown插件"><a href="#4-安装markdown插件" class="headerlink" title="4.安装markdown插件"></a>4.安装markdown插件</h3><p>由于刚刚立志要强迫自己玩儿转vim，所以先安装个markdown插件试试咯。</p>
<ul>
<li>vimrc里添加 <blockquote>
<p>Plugin ‘godlygeek/tabular’<br>Plugin ‘plasticboy/vim-markdown’</p>
</blockquote>
</li>
<li>之后自己写这个*.md文件，发现vim已经识别了这个文件是markdown，表现是能够识别符号，比如-xxx之后换行会自动-等</li>
<li>遗憾是没有发现preview的方法，目前的方式是先启动hexo，然后一边编写另一边进行实际的view</li>
</ul>
<h3 id="5-资源"><a href="#5-资源" class="headerlink" title="5.资源"></a>5.资源</h3><blockquote>
<p><a href="http://vim-scripts.org/vim/scripts.html" target="_blank" rel="external">http://vim-scripts.org/vim/scripts.html</a><br><a href="https://github.com/vim-scripts" target="_blank" rel="external">https://github.com/vim-scripts</a></p>
</blockquote>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    

    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/vim/">vim</a><a href="/tags/vundle/">vundle</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>





   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/12/04/mac使用杂记/" title="mac使用杂记" itemprop="url">mac使用杂记</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Will Chen" target="_blank" itemprop="author">Will Chen</a>
		
  <p class="article-time">
    <time datetime="2015-12-04T04:00:09.000Z" itemprop="datePublished"> 发表于 2015-12-04</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h3 id="1-查看磁盘空间"><a href="#1-查看磁盘空间" class="headerlink" title="1.查看磁盘空间"></a>1.查看磁盘空间</h3><p>开始 -&gt; 关于本机 -&gt; 存储<br><img src="/imgs/mac/磁盘空间" alt=""></p>
<h3 id="2-快捷键"><a href="#2-快捷键" class="headerlink" title="2.快捷键"></a>2.快捷键</h3><table>
<thead>
<tr>
<th><em>键</em></th>
<th style="text-align:left"><em>描述</em></th>
</tr>
</thead>
<tbody>
<tr>
<td>空格</td>
<td style="text-align:left">可以查看各种媒体文件</td>
</tr>
<tr>
<td>command + option + esc</td>
<td style="text-align:left">强杀进程</td>
</tr>
<tr>
<td>F11</td>
<td style="text-align:left">一键显示桌面</td>
</tr>
</tbody>
</table>
<h3 id="3-多jdk环境"><a href="#3-多jdk环境" class="headerlink" title="3. 多jdk环境"></a>3. 多jdk环境</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">➜  ~  cat ~/.bashrc</div><div class="line">export NVM_DIR=~/.nvm</div><div class="line">source $(brew --prefix nvm)/nvm.sh</div><div class="line"></div><div class="line">export JAVA_6_HOME=/Library/Java/JavaVirtualMachines/1.6.0.jdk/Contents/Home</div><div class="line">export JAVA_7_1_HOME=/Library/Java/JavaVirtualMachines/jdk1.7.0_07.jdk/Contents/Home</div><div class="line">export JAVA_7_HOME=/Library/Java/JavaVirtualMachines/jdk1.7.0_80.jdk/Contents/Home</div><div class="line">export JAVA_HOME=$JAVA_7_HOME</div><div class="line"></div><div class="line"># 下面的命令用来切换当前jdk环境</div><div class="line">alias jdk6=&apos;export JAVA_HOME=$JAVA_6_HOME &amp;&amp; export PATH=$JAVA_HOME/bin:$PATH&apos;</div><div class="line">alias jdk71=&apos;export JAVA_HOME=$JAVA_7_1_HOME &amp;&amp; export PATH=$JAVA_HOME/bin:$PATH&apos;</div><div class="line">alias jdk72=&apos;export JAVA_HOME=$JAVA_7_2_HOME &amp;&amp; export PATH=$JAVA_HOME/bin:$PATH&apos;</div><div class="line"></div><div class="line">➜  ~  java -version</div><div class="line">java version &quot;1.7.0_80&quot;</div><div class="line">Java(TM) SE Runtime Environment (build 1.7.0_80-b15)</div><div class="line">Java HotSpot(TM) 64-Bit Server VM (build 24.80-b11, mixed mode)</div><div class="line">➜  ~  jdk6</div><div class="line">➜  ~  java -version</div><div class="line">java version &quot;1.6.0_65&quot;</div><div class="line">Java(TM) SE Runtime Environment (build 1.6.0_65-b14-468-11M4833)</div><div class="line">Java HotSpot(TM) 64-Bit Server VM (build 20.65-b04-468, mixed mode)</div></pre></td></tr></table></figure>
<p>参考自：<a href="http://ningandjiao.iteye.com/blog/2045955" target="_blank" rel="external">http://ningandjiao.iteye.com/blog/2045955</a></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    

    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/mac/">mac</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>





   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/12/03/强奸R语言-1/" title="强奸R语言 1" itemprop="url">强奸R语言 1</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Will Chen" target="_blank" itemprop="author">Will Chen</a>
		
  <p class="article-time">
    <time datetime="2015-12-03T11:09:11.000Z" itemprop="datePublished"> 发表于 2015-12-03</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>就是为了学习一些机器学习的知识，需要用到R语言，但是感觉专门再去研究一门语言有些太繁琐。所以索性直接上手，也就是抄写各种机器学习的R程序。</p>
<p>首先弄的是文本挖掘的小程序：<a href="http://mp.weixin.qq.com/s?__biz=MzA3MDg0MjgxNQ==&amp;mid=400900310&amp;idx=1&amp;sn=4002ae3fc938a46060558480f0583fb2&amp;3rd=MzA3MDU4NTYzMw==&amp;scene=6#rd" target="_blank" rel="external">http://mp.weixin.qq.com/s?__biz=MzA3MDg0MjgxNQ==&amp;mid=400900310&amp;idx=1&amp;sn=4002ae3fc938a46060558480f0583fb2&amp;3rd=MzA3MDU4NTYzMw==&amp;scene=6#rd</a></p>
<p>好，文章里面提示要安装package。<br>搜一下R安装package的方法：<a href="http://www.r-bloggers.com/installing-r-packages/" target="_blank" rel="external">http://www.r-bloggers.com/installing-r-packages/</a></p>
<p>先尝试图形界面，简单。<br>使用R的图形界面找不到Snowball这个分词程序<br><img src="/imgs/r/图形界面找不到Snowball.png" alt=""></p>
<p>再使用命令行：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">install.packages(<span class="string">"Snowball"</span>)</div><div class="line">Warning message:</div><div class="line">package ‘Snowball’ is not available (<span class="keyword">for</span> R version <span class="number">3.2</span><span class="number">.2</span>)</div></pre></td></tr></table></figure></p>
<p>到Google搜索 r snowball，定位到 <a href="https://cran.r-project.org/src/contrib/Archive/Snowball/" target="_blank" rel="external">https://cran.r-project.org/src/contrib/Archive/Snowball/</a></p>
<blockquote>
<p>wget <a href="https://cran.r-project.org/src/contrib/Archive/Snowball/Snowball_0.0-11.tar.gz" target="_blank" rel="external">https://cran.r-project.org/src/contrib/Archive/Snowball/Snowball_0.0-11.tar.gz</a></p>
</blockquote>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&gt; getwd()   // 获取当前工作目录</div><div class="line">[<span class="number">1</span>] <span class="string">"/Users/will"</span></div><div class="line">&gt; setwd(<span class="string">'/Users/will/softs/clean'</span>)      //设置工作目录到刚才下载的包那里</div><div class="line">&gt; getwd()</div><div class="line">[<span class="number">1</span>] <span class="string">"/Users/will/softs/clean"</span></div><div class="line">&gt; install.packages(<span class="string">"Snowball_0.0-11.tar.gz"</span>)    // 再次安装</div><div class="line">inferring <span class="string">'repos = NULL'</span> from <span class="string">'pkgs'</span></div><div class="line">ERROR: dependencies ‘RWeka’, ‘rJava’ are not available <span class="keyword">for</span> package ‘Snowball’</div><div class="line">* removing ‘/Library/Frameworks/R.framework/Versions/<span class="number">3.2</span>/Resources/<span class="keyword">library</span>/Snowball’</div><div class="line">Warning message:</div><div class="line">In install.packages(<span class="string">"Snowball_0.0-11.tar.gz"</span>) :</div><div class="line">  安装程序包‘Snowball_0.0-<span class="number">11.</span>tar.gz’时退出狀態的值不是<span class="number">0</span></div></pre></td></tr></table></figure>
<p>可以看到上面报出两个package找不到:RWeka和rJava</p>
<p>尝试一下有么有像maven一样自动下载依赖的方法：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&gt; install.packages(<span class="string">"Snowball_0.0-11.tar.gz"</span>, dependencies=<span class="literal">TRUE</span>)</div><div class="line">inferring <span class="string">'repos = NULL'</span> from <span class="string">'pkgs'</span></div><div class="line">* installing *<span class="keyword">source</span>* package ‘Snowball’ <span class="keyword">...</span></div><div class="line">** 成功将‘Snowball’程序包解包并MD5和检查</div><div class="line">** R</div><div class="line">** inst</div><div class="line">** preparing package <span class="keyword">for</span> lazy loading</div><div class="line">Warning message:</div><div class="line">In install.packages(<span class="string">"Snowball_0.0-11.tar.gz"</span>, dependencies = <span class="literal">TRUE</span>) :</div><div class="line">  安装程序包‘Snowball_0.0-<span class="number">11.</span>tar.gz’时退出狀態的值不是<span class="number">0</span></div><div class="line">No Java runtime present, requesting install.</div></pre></td></tr></table></figure></p>
<p>马达, mac提示让安装1.6版本的jdk才行，日了。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">java version &quot;1.7.0_80&quot;</div><div class="line">Java(TM) SE Runtime Environment (build 1.7.0_80-b15)</div><div class="line">Java HotSpot(TM) 64-Bit Server VM (build 24.80-b11, mixed mode)</div></pre></td></tr></table></figure></p>
<p>自己手动来<br><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">&gt; install.packages(<span class="string">'RWeka'</span>)</div><div class="line">also installing the dependencies ‘RWekajars’, ‘rJava’</div><div class="line"></div><div class="line">试开URL’https://dirichlet.mat.puc.cl/bin/macosx/mavericks/contrib/<span class="number">3.2</span>/RWekajars_3.7.12-<span class="number">1.</span>tgz<span class="string">'</span></div><div class="line">Content type 'application/x-gzip<span class="string">' length 6473509 bytes (6.2 MB)</span></div><div class="line">==================================================</div><div class="line">downloaded 6.2 MB</div><div class="line"></div><div class="line">试开URL’https://dirichlet.mat.puc.cl/bin/macosx/mavericks/contrib/3.2/rJava_0.9-7.tgz'</div><div class="line">Content type <span class="string">'application/x-gzip'</span> length <span class="number">604271</span> bytes (<span class="number">590</span> KB)</div><div class="line">==================================================</div><div class="line">downloaded <span class="number">590</span> KB</div><div class="line"></div><div class="line">试开URL’https://dirichlet.mat.puc.cl/bin/macosx/mavericks/contrib/<span class="number">3.2</span>/RWeka_0.4-<span class="number">24.</span>tgz<span class="string">'</span></div><div class="line">Content type 'application/x-gzip<span class="string">' length 536260 bytes (523 KB)</span></div><div class="line">==================================================</div><div class="line">downloaded 523 KB</div></pre></td></tr></table></figure></p>
<p>同样的方式，安装其他包(<em>安装的时候需要注意当前目录getwd一下，是不是源package所在的位置</em>)</p>
<blockquote>
<p>wget <a href="http://download.r-forge.r-project.org/src/contrib/Rwordseg_0.2-1.tar.gz" target="_blank" rel="external">http://download.r-forge.r-project.org/src/contrib/Rwordseg_0.2-1.tar.gz</a></p>
</blockquote>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">&gt; install.packages(<span class="string">"Rwordseg_0.2-1.tar.gz"</span>, dependencies=<span class="literal">TRUE</span>)</div><div class="line">inferring <span class="string">'repos = NULL'</span> from <span class="string">'pkgs'</span></div><div class="line">* installing *<span class="keyword">source</span>* package ‘Rwordseg’ <span class="keyword">...</span></div><div class="line">** R</div><div class="line">** demo</div><div class="line">** inst</div><div class="line">** preparing package <span class="keyword">for</span> lazy loading</div><div class="line">** help</div><div class="line">*** installing help indices</div><div class="line">** building package indices</div><div class="line">** testing <span class="keyword">if</span> installed package can be loaded</div><div class="line">* DONE (Rwordseg)</div><div class="line"></div><div class="line">&gt; install.packages(<span class="string">"tm"</span>)</div><div class="line">also installing the dependencies ‘NLP’, ‘slam’</div><div class="line"></div><div class="line">试开URL’https://dirichlet.mat.puc.cl/bin/macosx/mavericks/contrib/<span class="number">3.2</span>/NLP_0.1-<span class="number">8.</span>tgz<span class="string">'</span></div><div class="line">Content type 'application/x-gzip<span class="string">' length 275184 bytes (268 KB)</span></div><div class="line">==================================================</div><div class="line">downloaded 268 KB</div><div class="line"></div><div class="line">试开URL’https://dirichlet.mat.puc.cl/bin/macosx/mavericks/contrib/3.2/slam_0.1-32.tgz'</div><div class="line">Content type <span class="string">'application/x-gzip'</span> length <span class="number">101732</span> bytes (<span class="number">99</span> KB)</div><div class="line">==================================================</div><div class="line">downloaded <span class="number">99</span> KB</div><div class="line"></div><div class="line">试开URL’https://dirichlet.mat.puc.cl/bin/macosx/mavericks/contrib/<span class="number">3.2</span>/tm_0.6-<span class="number">2.</span>tgz<span class="string">'</span></div><div class="line">Content type 'application/x-gzip<span class="string">' length 660405 bytes (644 KB)</span></div><div class="line">==================================================</div><div class="line">downloaded 644 KB</div><div class="line"></div><div class="line"></div><div class="line">下载的二进制程序包在</div><div class="line">    /var/folders/j_/gk6hxy7x705419zqy5sm167w0000gn/T//RtmpXdkdjK/downloaded_packages里</div></pre></td></tr></table></figure>
<h2 id="杂记"><a href="#杂记" class="headerlink" title="杂记"></a>杂记</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">&gt; <span class="keyword">library</span>(<span class="string">"arulesViz"</span>)</div><div class="line">&gt; data(<span class="string">"Groceries"</span>) <span class="comment">#加载指定的数据集</span></div><div class="line">&gt; summary(Groceries)    <span class="comment"># 查看</span></div><div class="line">transactions as itemMatrix <span class="keyword">in</span> sparse format with</div><div class="line"> <span class="number">9835</span> rows (elements/itemsets/transactions) and</div><div class="line"> <span class="number">169</span> columns (items) and a density of <span class="number">0.02609146</span> </div><div class="line"></div><div class="line">most frequent items:</div><div class="line">      whole milk other vegetables       rolls/buns             soda </div><div class="line">            <span class="number">2513</span>             <span class="number">1903</span>             <span class="number">1809</span>             <span class="number">1715</span> </div><div class="line">          yogurt          (Other) </div><div class="line">            <span class="number">1372</span>            <span class="number">34055</span> </div><div class="line"></div><div class="line">element (itemset/transaction) length distribution:</div><div class="line">sizes</div><div class="line">   <span class="number">1</span>    <span class="number">2</span>    <span class="number">3</span>    <span class="number">4</span>    <span class="number">5</span>    <span class="number">6</span>    <span class="number">7</span>    <span class="number">8</span>    <span class="number">9</span>   <span class="number">10</span>   <span class="number">11</span>   <span class="number">12</span>   <span class="number">13</span>   <span class="number">14</span>   <span class="number">15</span> </div><div class="line"><span class="number">2159</span> <span class="number">1643</span> <span class="number">1299</span> <span class="number">1005</span>  <span class="number">855</span>  <span class="number">645</span>  <span class="number">545</span>  <span class="number">438</span>  <span class="number">350</span>  <span class="number">246</span>  <span class="number">182</span>  <span class="number">117</span>   <span class="number">78</span>   <span class="number">77</span>   <span class="number">55</span> </div><div class="line">  <span class="number">16</span>   <span class="number">17</span>   <span class="number">18</span>   <span class="number">19</span>   <span class="number">20</span>   <span class="number">21</span>   <span class="number">22</span>   <span class="number">23</span>   <span class="number">24</span>   <span class="number">26</span>   <span class="number">27</span>   <span class="number">28</span>   <span class="number">29</span>   <span class="number">32</span> </div><div class="line">  <span class="number">46</span>   <span class="number">29</span>   <span class="number">14</span>   <span class="number">14</span>    <span class="number">9</span>   <span class="number">11</span>    <span class="number">4</span>    <span class="number">6</span>    <span class="number">1</span>    <span class="number">1</span>    <span class="number">1</span>    <span class="number">1</span>    <span class="number">3</span>    <span class="number">1</span> </div><div class="line"></div><div class="line">   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </div><div class="line">  <span class="number">1.000</span>   <span class="number">2.000</span>   <span class="number">3.000</span>   <span class="number">4.409</span>   <span class="number">6.000</span>  <span class="number">32.000</span> </div><div class="line"></div><div class="line">includes extended item information - examples:</div><div class="line">       labels  level2           level1</div><div class="line"><span class="number">1</span> frankfurter sausage meet and sausage</div><div class="line"><span class="number">2</span>     sausage sausage meet and sausage</div><div class="line"><span class="number">3</span>  liver loaf sausage meet and sausage</div></pre></td></tr></table></figure>
<p>min: 最小值<br>1st Qu: 一分位数<br>Median: 中位数<br>Mean: 平均值<br>3rd Qu: 三分位数<br>Max： 最大值<br>most frequent items： 最频繁出现的item</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line">&gt; rules &lt;- apriori(Groceries, parameter = list(support = 0.001, confidence = 0.5))</div><div class="line">Apriori</div><div class="line"></div><div class="line">Parameter specification:</div><div class="line"> confidence minval smax arem  aval originalSupport support minlen maxlen</div><div class="line">        0.5    0.1    1 none FALSE            TRUE   0.001      1     10</div><div class="line"> target   ext</div><div class="line">  rules FALSE</div><div class="line"></div><div class="line">Algorithmic control:</div><div class="line"> filter tree heap memopt load sort verbose</div><div class="line">    0.1 TRUE TRUE  FALSE TRUE    2    TRUE</div><div class="line"></div><div class="line">Absolute minimum support count: 9 </div><div class="line"></div><div class="line">set item appearances ...[0 item(s)] done [0.00s].</div><div class="line">set transactions ...[169 item(s), 9835 transaction(s)] done [0.00s].</div><div class="line">sorting and recoding items ... [157 item(s)] done [0.00s].</div><div class="line">creating transaction tree ... done [0.00s].</div><div class="line">checking subsets of size 1 2 3 4 5 6 done [0.01s].</div><div class="line">writing ... [5668 rule(s)] done [0.00s].</div><div class="line">creating S4 object  ... done [0.00s].</div><div class="line">&gt; rules</div><div class="line">set of 5668 rules </div><div class="line">&gt; inspect(head(sort(rules, by = &quot;lift&quot;), 3))</div><div class="line">    lhs                             rhs              support     confidence</div><div class="line">53  &#123;Instant food products,soda&#125; =&gt; &#123;hamburger meat&#125; 0.001220132 0.6315789 </div><div class="line">37  &#123;soda,popcorn&#125;               =&gt; &#123;salty snack&#125;    0.001220132 0.6315789 </div><div class="line">444 &#123;flour,baking powder&#125;        =&gt; &#123;sugar&#125;          0.001016777 0.5555556 </div><div class="line">    lift    </div><div class="line">53  18.99565</div><div class="line">37  16.69779</div><div class="line">444 16.40807</div><div class="line">&gt; inspect(head(sort(rules, by = &quot;lift&quot;), 3))</div><div class="line">    lhs                             rhs              support     confidence lift    </div><div class="line">53  &#123;Instant food products,soda&#125; =&gt; &#123;hamburger meat&#125; 0.001220132 0.6315789  18.99565</div><div class="line">37  &#123;soda,popcorn&#125;               =&gt; &#123;salty snack&#125;    0.001220132 0.6315789  16.69779</div><div class="line">444 &#123;flour,baking powder&#125;        =&gt; &#123;sugar&#125;          0.001016777 0.5555556  16.40807</div><div class="line">&gt; plot(rules)</div><div class="line">&gt; plot(rules)</div><div class="line">&gt;  plot(rules, measure = c(&quot;support&quot;, &quot;lift&quot;), shading = &quot;confidence&quot;)</div></pre></td></tr></table></figure>
        
        
        <p class="article-more-link">
          
       </p>
    </div>
    

    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/R/">R</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>





   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/12/03/ElasticSearch-kibana-Dashboard-定义与使用/" title="ElasticSearch kibana Dashboard 定义与使用" itemprop="url">ElasticSearch kibana Dashboard 定义与使用</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Will Chen" target="_blank" itemprop="author">Will Chen</a>
		
  <p class="article-time">
    <time datetime="2015-12-03T07:31:45.000Z" itemprop="datePublished"> 发表于 2015-12-03</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>以前在骡迹物流的时候只是玩儿了一下kibana简单的功能，并没有投入使用，当时也基本上玩儿遍了各种可视化，就是么有弄dashboard。<br>在美团这边前两天被拉进elasticsearch的群里，然后收到一个kibana的地址，今儿下午尝试性地玩儿了一下，还蛮爽的，有些惊异。</p>
<p>dashboard是一个画布，然后这个画布上需要放置很多的visualize，也就是说在弄dashboard之前是需要先准备好visualize的，它由visualize和search组成。</p>
<h3 id="1-准备源材料"><a href="#1-准备源材料" class="headerlink" title="1. 准备源材料"></a>1. 准备源材料</h3><p>创建并保存visualization和search</p>
<p><img src="/imgs/es/准备源材料.png" alt=""></p>
<h3 id="2-新建dashboard"><a href="#2-新建dashboard" class="headerlink" title="2. 新建dashboard"></a>2. 新建dashboard</h3><p><img src="/imgs/es/新建dashboard.png" alt=""></p>
<h3 id="3-为dashboard添加元素"><a href="#3-为dashboard添加元素" class="headerlink" title="3. 为dashboard添加元素"></a>3. 为dashboard添加元素</h3><p><img src="/imgs/es/创建dashboard.png" alt=""></p>
<h3 id="4-调整后保存"><a href="#4-调整后保存" class="headerlink" title="4. 调整后保存"></a>4. 调整后保存</h3><p><img src="/imgs/es/保存.png" alt=""></p>
<p>好了，这已经非常好看了，完全可以直接看了。以后再有运营提数据需求，我就直接创建search或者visualization后，生成dashboard。可是问题又来了，咋给他看呢？总不能让所有的运营人员都登陆kibana页面来瞅吧，那样的话还得加权限神马的，比如对个别页面有只读权限，其他页面或者操作没有任何权限才对。静静地思考，kibana和elasticsearch已然有了思路，是不可能倒在权限这个小问题上的，肯定有一种合理的方式去分享给需求端看。fun，找找看~</p>
<h3 id="5-dashboard组件化"><a href="#5-dashboard组件化" class="headerlink" title="5. dashboard组件化"></a>5. dashboard组件化</h3><p>叫我脑残，功能就放在眼前<br><img src="/imgs/es/share.png" alt=""></p>
<p>获取到iframe后，自然就会想到，这个东西是可以嵌入到我们自己的网页中的。如此一来的话，就可以直接将数据存储在elasticsearch中，之后在elasticsearch和kibana之上建立自己的search，visualization，dashboard。然后将最终的dashboard嵌入到应用页面。</p>
<p>还是有些问题，直接在浏览器访问这个dashboard的url的话会发现其实就是kibana那个页面，但是放进iframe之后就成了不可编辑的状态，而且只有组件，上面不会有kibana的head，这个状态比较理想。可是右击查看源代码的话，还是可以看到kibana的页面接口URL，如果直接访问还是可以直接进行编辑。</p>
<p>查了一下权限相关</p>
<ul>
<li><a href="https://github.com/floragunncom/search-guard" target="_blank" rel="external">https://github.com/floragunncom/search-guard</a></li>
<li><a href="http://drops.wooyun.org/tips/8129" target="_blank" rel="external">http://drops.wooyun.org/tips/8129</a></li>
<li><a href="http://3gods.com/2015/09/10/Shield%20Control.html" target="_blank" rel="external">http://3gods.com/2015/09/10/Shield%20Control.html</a></li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    

    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/ElasticSearch/">ElasticSearch</a><a href="/tags/kibana/">kibana</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>





   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/11/19/guava整理/" title="guava整理 - Basic utilities" itemprop="url">guava整理 - Basic utilities</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Will Chen" target="_blank" itemprop="author">Will Chen</a>
		
  <p class="article-time">
    <time datetime="2015-11-19T07:04:51.000Z" itemprop="datePublished"> 发表于 2015-11-19</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>总是看到guava的身影，今天来大概浏览一下这个Google项目。</p>
<h3 id="1-对于null的思考"><a href="#1-对于null的思考" class="headerlink" title="1. 对于null的思考"></a>1. 对于null的思考</h3><p>null值的特点：</p>
<ul>
<li>不能清晰表达任何业务模型<br> 就是说在很多情况下，我们看到null的时候通常要分析一下context才能知道这里是什么情况</li>
<li>容易被人忽视<br> 很多时候coder会专注于自己正在思考的核心业务场景，编写代码逻辑。容易忘记处理null对象的情况，所以一些nullPointerException通常是由于不可避免的粗心遗漏造成的。</li>
</ul>
<p>Optional<t><br>    当获取某个值的时候，尽量使用Optional<t>, T能够帮助我们理解当前的业务模型，而Optional.get()这一个不是很方便的调用则会时刻提醒我们充分考虑当前场景下，如果主对象为null应当采取的措施。<br>    有异曲同工之妙的还有scala中的Option<t></t></t></t></p>
<p>API概览：<br>    <a href="http://docs.guava-libraries.googlecode.com/git/javadoc/com/google/common/base/Optional.html" target="_blank" rel="external">http://docs.guava-libraries.googlecode.com/git/javadoc/com/google/common/base/Optional.html</a></p>
<h3 id="2-前置条件"><a href="#2-前置条件" class="headerlink" title="2. 前置条件"></a>2. 前置条件</h3><p>就是一些常用的、通用的、简单的条件判断，<br>API:<a href="http://docs.guava-libraries.googlecode.com/git-history/release/javadoc/com/google/common/base/Preconditions.html" target="_blank" rel="external">http://docs.guava-libraries.googlecode.com/git-history/release/javadoc/com/google/common/base/Preconditions.html</a></p>
<p>java7其实也添加了一些方法：<br><a href="http://docs.oracle.com/javase/7/docs/api/java/util/Objects.html#requireNonNull(java.lang.Object,java.lang.String" target="_blank" rel="external">http://docs.oracle.com/javase/7/docs/api/java/util/Objects.html#requireNonNull(java.lang.Object,java.lang.String</a>)</p>
<p>如果不满足这些条件，就会抛出Exception</p>
<h3 id="3-通用对象方法"><a href="#3-通用对象方法" class="headerlink" title="3. 通用对象方法"></a>3. 通用对象方法</h3><p>对于Object默认的toString hashCode等方法提供简单实现<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">Objects.equal(&quot;a&quot;, &quot;a&quot;); // returns true</div><div class="line">Objects.equal(null, &quot;a&quot;); // returns false</div><div class="line">Objects.equal(&quot;a&quot;, null); // returns false</div><div class="line">Objects.equal(null, null); // returns true</div></pre></td></tr></table></figure></p>
<p>equals方法给处理了null值情况。</p>
<p>java7也是用了类似guava的<a href="http://google.github.io/guava/releases/snapshot/api/docs/com/google/common/base/Objects.html#hashCode(java.lang.Object...)的" target="_blank" rel="external">http://google.github.io/guava/releases/snapshot/api/docs/com/google/common/base/Objects.html#hashCode(java.lang.Object...)的</a><br><a href="http://docs.oracle.com/javase/7/docs/api/java/util/Objects.html#hash(java.lang.Object" target="_blank" rel="external">http://docs.oracle.com/javase/7/docs/api/java/util/Objects.html#hash(java.lang.Object</a>…)</p>
<p>可读的toString<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">// Returns &quot;ClassName&#123;x=1&#125;&quot;</div><div class="line">   MoreObjects.toStringHelper(this)</div><div class="line">       .add(&quot;x&quot;, 1)</div><div class="line">       .toString();</div><div class="line"></div><div class="line">   // Returns &quot;MyObject&#123;x=1&#125;&quot;</div><div class="line">   MoreObjects.toStringHelper(&quot;MyObject&quot;)</div><div class="line">       .add(&quot;x&quot;, 1)</div><div class="line">       .toString();</div></pre></td></tr></table></figure></p>
<p><a href="http://docs.guava-libraries.googlecode.com/git-history/release/javadoc/com/google/common/base/Objects.html#equal(java.lang.Object" target="_blank" rel="external">http://docs.guava-libraries.googlecode.com/git-history/release/javadoc/com/google/common/base/Objects.html#equal(java.lang.Object</a>, java.lang.Object)</p>
<h3 id="4-ComparisonChain"><a href="#4-ComparisonChain" class="headerlink" title="4. ComparisonChain"></a>4. ComparisonChain</h3><p>任何一个条件返回非0值，就比较结束。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">public int compareTo(Foo that) &#123;</div><div class="line">     return ComparisonChain.start()</div><div class="line">         .compare(this.aString, that.aString)</div><div class="line">         .compare(this.anInt, that.anInt)</div><div class="line">         .compare(this.anEnum, that.anEnum, Ordering.natural().nullsLast())</div><div class="line">         .result();</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<h3 id="5-异常传播"><a href="#5-异常传播" class="headerlink" title="5. 异常传播"></a>5. 异常传播</h3><p>简化Throwable的处理<br>有时候我们catch住一个Exception，但是并不想在这个catch块里处理，就会throw出去给下个块。最常见的例子是RuntimeException和Error，本来我们并不想catch它们，但是通常它们又会被catch住。</p>
<p>具体使用没看太明白</p>
<p>集合类使用</p>
<h3 id="1-不可变集合"><a href="#1-不可变集合" class="headerlink" title="1. 不可变集合"></a>1. 不可变集合</h3><ul>
<li>安全</li>
<li>不存在并发问题</li>
<li>空间可预测</li>
</ul>
<p>注：目前guava的不可变集合都不许有null元素，如果要使用带有null的不可变集合，那么选用JDK自带的Collections.unmodifiableXXX</p>
<p>使用不可变集合</p>
<ul>
<li>copyOf：如ImmutableSet.copyOf(set);</li>
<li>of：如ImmutableSet.of(“a”, “b”, “c”)或 ImmutableMap.of(“a”, 1, “b”, 2);</li>
<li>builder：public static final ImmutableSet<color\> GOOGLE_COLORS =<pre><code>ImmutableSet.&lt;Color\&gt;builder()
    .addAll(WEBSAFE_COLORS)
    .add(new Color(0, 191, 255))
    .build();
</code></pre>asList视图</color\></li>
</ul>
<p>所有不可变集合都有一个asList()方法提供ImmutableList视图，来帮助你用列表形式方便地读取集合元素。例如，你可以使用sortedSet.asList().get(k)从ImmutableSortedSet中读取第k个最小元素。</p>
<p>asList()返回的ImmutableList通常是——并不总是——开销稳定的视图实现，而不是简单地把元素拷贝进List。也就是说，asList返回的列表视图通常比一般的列表平均性能更好，比如，在底层集合支持的情况下，它总是使用高效的contains方法。</p>
<h3 id="2-新的集合类型"><a href="#2-新的集合类型" class="headerlink" title="2. 新的集合类型"></a>2. 新的集合类型</h3><p>JDK没有，但是又被非常广泛使用的集合类型。</p>
<ul>
<li><p>MultiSet</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">private void outMuiltSet() &#123;</div><div class="line">   System.out.println(&quot;-------------------&quot;);</div><div class="line">   System.out.println(strs.size());</div><div class="line">   System.out.println(strs.count(new Object())); //count(Object element): 返回给定参数元素的个数</div><div class="line">   System.out.println(strs.count(&quot;sdfsd&quot;)); //count(Object element): 返回给定参数元素的个数</div><div class="line">   System.out.println(strs);</div><div class="line"> &#125;</div><div class="line"></div><div class="line"> public void test3() throws Throwable &#123;</div><div class="line">   strs = TreeMultiset.create();</div><div class="line">   strs.add(&quot;sdfsd&quot;, 2); //add(E element,int occurrences): 向其中添加指定个数的元素</div><div class="line">   strs.add(&quot;sdfsd&quot;);  // add(E element): 向其中添加单个元素</div><div class="line">   strs.add(&quot;dlkjlkj&quot;);</div><div class="line">   System.out.println(strs.elementSet());  // elementSet(): 将不同的元素放入一个Set中</div><div class="line">   Set&lt;Multiset.Entry&lt;Comparable&gt;&gt; entries = strs.entrySet();  //类似与Map.entrySet 返回Set。包含的Entry支持使用getElement()和getCount()</div><div class="line">   for (Multiset.Entry entry: entries) &#123;</div><div class="line">     System.out.println(entry.getElement());</div><div class="line">     System.out.println(entry.getCount());</div><div class="line">   &#125;</div><div class="line">   outMuiltSet();</div><div class="line">   strs.remove(&quot;sdfsd&quot;); // remove(E element): 移除一个元素，其count值 会响应减少</div><div class="line">   outMuiltSet();</div><div class="line">   strs.setCount(&quot;sdfsd&quot;, 10); // 设定某一个元素的重复次数</div><div class="line">   outMuiltSet();</div><div class="line">   strs.remove(&quot;sdfsd&quot;, 2); //remove(E element,int occurrences): 移除相应个数的元素</div><div class="line">   outMuiltSet();</div><div class="line">   strs.setCount(&quot;sdfsd&quot;, 8, 20); //setCount(E element,int oldCount,int newCount): 将符合原有重复个数的元素修改为新的重复次数</div><div class="line">   strs.setCount(&quot;sdfsd&quot;, 8, 20);</div><div class="line">   strs.setCount(&quot;dlkjlkj&quot;, 8, 20);</div><div class="line">   outMuiltSet();</div><div class="line"> &#125;</div></pre></td></tr></table></figure>
</li>
<li><p>SortedMultiset</p>
</li>
</ul>
<p>SortedMultiset是Multiset 接口的变种，它支持高效地获取指定范围的子集。比方说，你可以用 latencies.subMultiset(0,BoundType.CLOSED, 100, BoundType.OPEN).size()来统计你的站点中延迟在100毫秒以内的访问，然后把这个值和latencies.size()相比，以获取这个延迟水平在总体访问中的比例。</p>
<p>TreeMultiset实现SortedMultiset接口。</p>
<ul>
<li>Multimap<br>可以用两种方式思考Multimap的概念:</li>
</ul>
<p>“键-单个值映射”的集合: a-&gt;1, a-&gt;2, a-&gt;4, b-&gt;3, c-&gt;5<br>“键-值集合映射”的映射: a-&gt;[1,2,4], b-&gt;3, c-&gt;5<br>一般情况下都会使用ListMultimap或SetMultimap接口，它们分别把键映射到List或Set。<br>Multimap.get(key)以集合形式返回键所对应的值视图, 即使没有任何对应的值，也会返回空集合。<br>对值视图集合进行的修改最终都会反映到底层的Multimap。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">public void testMap() &#123;</div><div class="line">    ImmutableListMultimap&lt;String, Integer&gt; of = ImmutableListMultimap.of(&quot;a&quot;, 1, &quot;a&quot;, 2, &quot;b&quot;, 1);</div><div class="line">    System.out.println(of.asMap());</div><div class="line">    ListMultimap map = ArrayListMultimap.create(of);</div><div class="line">    map.put(&quot;a&quot;, 234);</div><div class="line">    map.putAll(&quot;c&quot;, ImmutableSet.of(123,3243));</div><div class="line">    System.out.println(map);</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<ul>
<li>BiMap<br>实现键值对的双向映射,并保持它们间的同步。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">BiMap&lt;String, Integer&gt; map = HashBiMap.create();</div><div class="line">   map.put(&quot;foo&quot;, 1);</div><div class="line">   map.put(&quot;bar&quot;, 2);</div><div class="line">   map.put(&quot;quux&quot;, 3);</div><div class="line"></div><div class="line">   map.inverse().forcePut(1, &quot;quux&quot;);  // 会导致foo被替换成quux，而quux的value也成了1，就是&#123;bar=2, quux=1&#125;</div><div class="line">   System.out.println(map);</div></pre></td></tr></table></figure>
<ul>
<li>Table</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">String v1 = &quot;a&quot;;</div><div class="line">    String v2 = &quot;b&quot;;</div><div class="line">    String v3 = &quot;c&quot;;</div><div class="line">    Table&lt;String, String, Integer&gt; weightedGraph = HashBasedTable.create();</div><div class="line">    weightedGraph.put(v1, v2, 4);</div><div class="line">    weightedGraph.put(v1, v3, 20);</div><div class="line">    weightedGraph.put(v2, v3, 5);</div><div class="line">    System.out.println(weightedGraph);</div><div class="line"></div><div class="line">    System.out.println(weightedGraph.row(v1) + &quot;........sdfsd&quot;); // 按照rowKey查询</div><div class="line">    System.out.println(weightedGraph.column(v3)); // 按照Columnkey查询</div></pre></td></tr></table></figure>
<ul>
<li>ClassToInstanceMap</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ClassToInstanceMap&lt;Number&gt; numberDefaults=MutableClassToInstanceMap.create();</div><div class="line">    numberDefaults.putInstance(Integer.class, Integer.valueOf(0));</div><div class="line">    numberDefaults.putInstance(Integer.class, Float.valueOf(0)); // 编译报错</div></pre></td></tr></table></figure>
<ul>
<li><p>RangeSet<br>RangeSet描述了一组不相连的、非空的区间。当把一个区间添加到可变的RangeSet时，所有相连的区间会被合并，空区间会被忽略。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">RangeSet&lt;Integer&gt; rangeSet = TreeRangeSet.create();</div><div class="line">    System.out.println(rangeSet);</div><div class="line">    rangeSet.add(Range.closed(1, 10)); // &#123;[1,10]&#125;</div><div class="line">    System.out.println(rangeSet);</div><div class="line">    rangeSet.add(Range.closedOpen(11, 15));//不相连区间:&#123;[1,10], [11,15)&#125;</div><div class="line">    System.out.println(rangeSet);</div><div class="line">    rangeSet.add(Range.closedOpen(15, 20)); //相连区间; &#123;[1,10], [11,20)&#125;</div><div class="line">    System.out.println(rangeSet);</div><div class="line">    rangeSet.add(Range.openClosed(0, 0)); //空区间; &#123;[1,10], [11,20)&#125;</div><div class="line">    System.out.println(rangeSet);</div><div class="line">    rangeSet.remove(Range.open(5, 10)); //分割[1, 10]; &#123;[1,5], [10,10], [11,20)&#125;</div><div class="line">    System.out.println(rangeSet);</div></pre></td></tr></table></figure>
</li>
<li><p>RangeMap<br>RangeMap描述了”不相交的、非空的区间”到特定值的映射。和RangeSet不同，RangeMap不会合并相邻的映射，即便相邻的区间映射到相同的值。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">RangeMap&lt;Integer, String&gt; rangeMap = TreeRangeMap.create();</div><div class="line">    rangeMap.put(Range.closed(1, 10), &quot;foo&quot;); //&#123;[1,10] =&gt; &quot;foo&quot;&#125;</div><div class="line">    System.out.println(rangeMap);</div><div class="line">    rangeMap.put(Range.open(3, 6), &quot;bar&quot;); //&#123;[1,3] =&gt; &quot;foo&quot;, (3,6) =&gt; &quot;bar&quot;, [6,10] =&gt; &quot;foo&quot;&#125;</div><div class="line">    System.out.println(rangeMap);</div><div class="line">    rangeMap.put(Range.open(10, 20), &quot;foo&quot;); //&#123;[1,3] =&gt; &quot;foo&quot;, (3,6) =&gt; &quot;bar&quot;, [6,10] =&gt; &quot;foo&quot;, (10,20) =&gt; &quot;foo&quot;&#125;</div><div class="line">    System.out.println(rangeMap);</div><div class="line">    rangeMap.remove(Range.closed(5, 11)); //&#123;[1,3] =&gt; &quot;foo&quot;, (3,5) =&gt; &quot;bar&quot;, (11,20) =&gt; &quot;foo&quot;&#125;</div><div class="line">    System.out.println(rangeMap);</div></pre></td></tr></table></figure>
</li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    

    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/guava/">guava</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






  <nav id="page-nav" class="clearfix">
    <a class="extend prev" rel="prev" href="/page/21/"><span></span>Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/20/">20</a><a class="page-number" href="/page/21/">21</a><span class="page-number current">22</span><a class="page-number" href="/page/23/">23</a><a class="page-number" href="/page/24/">24</a><a class="extend next" rel="next" href="/page/23/">Next<span></span></a>
  </nav>

</div>
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  


  

  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/youdaonote/" title="youdaonote">youdaonote<sup>187</sup></a></li>
			
		
			
				<li><a href="/tags/源码/" title="源码">源码<sup>10</sup></a></li>
			
		
			
				<li><a href="/tags/akka/" title="akka">akka<sup>9</sup></a></li>
			
		
			
				<li><a href="/tags/flume/" title="flume">flume<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/ETL/" title="ETL">ETL<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/solr/" title="solr">solr<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/spring/" title="spring">spring<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/调度平台/" title="调度平台">调度平台<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/azkaban/" title="azkaban">azkaban<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/mysql/" title="mysql">mysql<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/scala/" title="scala">scala<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/ambari/" title="ambari">ambari<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/quartz/" title="quartz">quartz<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/nodejs/" title="nodejs">nodejs<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Solr/" title="Solr">Solr<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/guava/" title="guava">guava<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/heroku/" title="heroku">heroku<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/hdfs/" title="hdfs">hdfs<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/hue/" title="hue">hue<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/ElasticSearch/" title="ElasticSearch">ElasticSearch<sup>1</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
          <li>
            
            	<a href="https://github.com/willcup" target="_blank" title=" 我自己的github">github</a>
            
          </li>
        
          <li>
            
            	<a href="http://thisding.com" target="_blank" title="朋友的主页">Steven&#39;s Blog</a>
            
          </li>
        
    </ul>
</div>

  


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

  <div class="weiboshow">
  <p class="asidetitle">新浪微博</p>
    <iframe width="100%" height="119" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=119&fansRow=2&ptype=1&speed=0&skin=9&isTitle=1&noborder=1&isWeibo=0&isFans=0&uid=null&verifier=&dpc=1"></iframe>
</div>


</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello ,I&#39;m Will Chen in MeiTuan. <br/>
			元 亨 利 贞.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		
		
		
		
		
		
		
		
		
		<a href="mailto:chenxin15@meituan.com" target="_blank" class="icon-email" title="Email Me"></a>
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2017 
		
		<a href="/about" target="_blank" title="Will Chen">Will Chen</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
        
    }
  });
});
</script>










<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3Fe6d1f421bbc9962127a50488f9ed37d1' type='text/javascript'%3E%3C/script%3E"));
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
 </html>
