
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?5b99dfd487346155d274c0c49c3fb869";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
  </script>

  
    <title>Will&#39;s Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="Will Chen">
    

    
    <meta name="description" content="左右水色 右手天光">
<meta property="og:type" content="website">
<meta property="og:title" content="Will's Blog">
<meta property="og:url" content="http://willcup.com/page/14/index.html">
<meta property="og:site_name" content="Will's Blog">
<meta property="og:description" content="左右水色 右手天光">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Will's Blog">
<meta name="twitter:description" content="左右水色 右手天光">

    
    <link rel="alternative" href="/atom.xml" title="Will&#39;s Blog" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="Will&#39;s Blog" title="Will&#39;s Blog"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Will&#39;s Blog">Will&#39;s Blog</a></h1>
				<h2 class="blog-motto">简易 变易 不易</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">首页</a></li>
					
						<li><a href="/archives">归档</a></li>
					
						<li><a href="/about">关于</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:willcup.com">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main">

   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2017/04/16/mysql-binlog相关/" title="mysql-binlog相关" itemprop="url">mysql-binlog相关</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Will Chen" target="_blank" itemprop="author">Will Chen</a>
		
  <p class="article-time">
    <time datetime="2017-04-16T08:29:19.000Z" itemprop="datePublished"> 发表于 2017-04-16</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>binlog的记录格式有三种：</p>
<ul>
<li>基于sql语句(statement-based replication,SBR)</li>
<li>基于行(row-based replication,RBR)</li>
<li>混合模式(mixed-based replication,MBR)</li>
</ul>
<p>查看所有的binlog文件列表<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">show binary logs;</div><div class="line">You are not using binary logging</div></pre></td></tr></table></figure></p>
<p>代表并没有开启，需要编辑一下mysql的配置文件并重启。</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    

    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/youdaonote/">youdaonote</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>





   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2017/04/05/ambari给hbase添加component/" title="ambari给hbase添加component" itemprop="url">ambari给hbase添加component</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Will Chen" target="_blank" itemprop="author">Will Chen</a>
		
  <p class="article-time">
    <time datetime="2017-04-05T06:53:26.000Z" itemprop="datePublished"> 发表于 2017-04-05</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>因为原生的ambari并没有原生支持habse的thriftserver在UI端操作。而且业务部门需要使用这个，我们运维的过程中，总是需要去到指定机器启动才行，不太方便，总会遗漏。所以添加到ambari的hbase service里。</p>
<p>ps:<br>按照参考的位置<code>/var/lib/ambari-server/resources/stacks/HDP/2.4/services/HBASE/metainfo.xml</code>里面空空如也。</p>
<h2 id="添加component"><a href="#添加component" class="headerlink" title="添加component"></a>添加component</h2><p>编辑/var/lib/ambari-server/resources/common-services/HBASE/0.96.0.2.0/metainfo.xml文件，添加对应component<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">  <span class="tag">&lt;<span class="name">component</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>HBASE_THRIFT_SERVER<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">displayName</span>&gt;</span>ThriftServer<span class="tag">&lt;/<span class="name">displayName</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">category</span>&gt;</span>MASTER<span class="tag">&lt;/<span class="name">category</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">cardinality</span>&gt;</span>1+<span class="tag">&lt;/<span class="name">cardinality</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">versionAdvertised</span>&gt;</span>true<span class="tag">&lt;/<span class="name">versionAdvertised</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">timelineAppid</span>&gt;</span>HBASE<span class="tag">&lt;/<span class="name">timelineAppid</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">commandScript</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined">scripts/hbase_thrift_server.py</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">scriptType</span>&gt;</span>PYTHON<span class="tag">&lt;/<span class="name">scriptType</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">commandScript</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">component</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h2 id="添加对应脚本"><a href="#添加对应脚本" class="headerlink" title="添加对应脚本"></a>添加对应脚本</h2><p><code>/var/lib/ambari-server/resources/common-services/HBASE/0.96.0.2.0/package/scripts/hbase_thrift_server.py</code>:<br><figure class="highlight py"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> sys</div><div class="line"><span class="keyword">from</span> resource_management <span class="keyword">import</span> *</div><div class="line"><span class="keyword">from</span> resource_management.libraries.functions.security_commons <span class="keyword">import</span> build_expectations, \</div><div class="line">  cached_kinit_executor, get_params_from_filesystem, validate_security_config_properties, \</div><div class="line">  FILE_TYPE_XML</div><div class="line"><span class="keyword">from</span> hbase <span class="keyword">import</span> hbase</div><div class="line"><span class="keyword">from</span> hbase_service <span class="keyword">import</span> hbase_service</div><div class="line"><span class="keyword">import</span> upgrade</div><div class="line"><span class="keyword">from</span> ambari_commons <span class="keyword">import</span> OSCheck, OSConst</div><div class="line"><span class="keyword">from</span> ambari_commons.os_family_impl <span class="keyword">import</span> OsFamilyImpl</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">HbaseThriftServer</span><span class="params">(Script)</span>:</span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">install</span><span class="params">(self, env)</span>:</span></div><div class="line">   <span class="comment"># import params</span></div><div class="line">   <span class="comment"># self.install_packages(env, params.exclude_packages)</span></div><div class="line">    <span class="keyword">print</span> <span class="string">"Decommission not yet implemented!"</span></div><div class="line">   </div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">configure</span><span class="params">(self, env)</span>:</span></div><div class="line">   <span class="comment"># import params</span></div><div class="line">   <span class="comment"># env.set_params(params)</span></div><div class="line">   <span class="comment"># hbase(name='thrift')</span></div><div class="line">    <span class="keyword">print</span> <span class="string">"Decommission not yet implemented!"</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">decommission</span><span class="params">(self, env)</span>:</span></div><div class="line">    <span class="keyword">print</span> <span class="string">"Decommission not yet implemented!"</span></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="meta">@OsFamilyImpl(os_family=OsFamilyImpl.DEFAULT)</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">HbaseThriftServerDefault</span><span class="params">(HbaseThriftServer)</span>:</span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">get_stack_to_component</span><span class="params">(self)</span>:</span></div><div class="line">    <span class="keyword">return</span> &#123;<span class="string">"HDP"</span>: <span class="string">"hbase-thrift"</span>&#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">pre_upgrade_restart</span><span class="params">(self, env, upgrade_type=None)</span>:</span></div><div class="line">    <span class="keyword">import</span> params</div><div class="line">    env.set_params(params)</div><div class="line">    upgrade.prestart(env, <span class="string">"hbase-thrift"</span>)</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">post_upgrade_restart</span><span class="params">(self, env, upgrade_type=None)</span>:</span></div><div class="line">    <span class="keyword">import</span> params</div><div class="line">    env.set_params(params)</div><div class="line">    upgrade.post_thrift(env)</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">start</span><span class="params">(self, env, upgrade_type=None)</span>:</span></div><div class="line">    <span class="keyword">import</span> params</div><div class="line">    env.set_params(params)</div><div class="line">    self.configure(env) <span class="comment"># for security</span></div><div class="line">    hbase_service( <span class="string">'thrift'</span>,</div><div class="line">      action = <span class="string">'start'</span></div><div class="line">    )</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">stop</span><span class="params">(self, env, upgrade_type=None)</span>:</span></div><div class="line">    <span class="keyword">import</span> params</div><div class="line">    env.set_params(params)</div><div class="line"></div><div class="line">    hbase_service( <span class="string">'thrift'</span>,</div><div class="line">      action = <span class="string">'stop'</span></div><div class="line">    )</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">status</span><span class="params">(self, env)</span>:</span></div><div class="line">    <span class="keyword">import</span> status_params</div><div class="line">    env.set_params(status_params)</div><div class="line">    pid_file = format(<span class="string">"&#123;pid_dir&#125;/hbase-&#123;hbase_user&#125;-thrift.pid"</span>)</div><div class="line">    check_process_status(pid_file)</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">security_status</span><span class="params">(self, env)</span>:</span></div><div class="line">    <span class="keyword">import</span> status_params</div><div class="line"></div><div class="line">    env.set_params(status_params)</div><div class="line">    <span class="keyword">if</span> status_params.security_enabled:</div><div class="line">      props_value_check = &#123;<span class="string">"hbase.security.authentication"</span> : <span class="string">"kerberos"</span>,</div><div class="line">                           <span class="string">"hbase.security.authorization"</span>: <span class="string">"true"</span>&#125;</div><div class="line">      props_empty_check = [<span class="string">'hbase.thrift.keytab.file'</span>,</div><div class="line">                           <span class="string">'hbase.thrift.kerberos.principal'</span>]</div><div class="line">      props_read_check = [<span class="string">'hbase.thrift.keytab.file'</span>]</div><div class="line">      hbase_site_expectations = build_expectations(<span class="string">'hbase-site'</span>, props_value_check, props_empty_check,</div><div class="line">                                                   props_read_check)</div><div class="line"></div><div class="line">      hbase_expectations = &#123;&#125;</div><div class="line">      hbase_expectations.update(hbase_site_expectations)</div><div class="line"></div><div class="line">      security_params = get_params_from_filesystem(status_params.hbase_conf_dir,</div><div class="line">                                                   &#123;<span class="string">'hbase-site.xml'</span>: FILE_TYPE_XML&#125;)</div><div class="line">      result_issues = validate_security_config_properties(security_params, hbase_expectations)</div><div class="line">      <span class="keyword">if</span> <span class="keyword">not</span> result_issues:  <span class="comment"># If all validations passed successfully</span></div><div class="line">        <span class="keyword">try</span>:</div><div class="line">          <span class="comment"># Double check the dict before calling execute</span></div><div class="line">          <span class="keyword">if</span> ( <span class="string">'hbase-site'</span> <span class="keyword">not</span> <span class="keyword">in</span> security_params</div><div class="line">               <span class="keyword">or</span> <span class="string">'hbase.thrift.keytab.file'</span> <span class="keyword">not</span> <span class="keyword">in</span> security_params[<span class="string">'hbase-site'</span>]</div><div class="line">               <span class="keyword">or</span> <span class="string">'hbase.thrift.kerberos.principal'</span> <span class="keyword">not</span> <span class="keyword">in</span> security_params[<span class="string">'hbase-site'</span>]):</div><div class="line">            self.put_structured_out(&#123;<span class="string">"securityState"</span>: <span class="string">"UNSECURED"</span>&#125;)</div><div class="line">            self.put_structured_out(</div><div class="line">              &#123;<span class="string">"securityIssuesFound"</span>: <span class="string">"Keytab file or principal are not set property."</span>&#125;)</div><div class="line">            <span class="keyword">return</span></div><div class="line"></div><div class="line">          cached_kinit_executor(status_params.kinit_path_local,</div><div class="line">                                status_params.hbase_user,</div><div class="line">                                security_params[<span class="string">'hbase-site'</span>][<span class="string">'hbase.thrift.keytab.file'</span>],</div><div class="line">                                security_params[<span class="string">'hbase-site'</span>][<span class="string">'hbase.thrift.kerberos.principal'</span>],</div><div class="line">                                status_params.hostname,</div><div class="line">                                status_params.tmp_dir)</div><div class="line">          self.put_structured_out(&#123;<span class="string">"securityState"</span>: <span class="string">"SECURED_KERBEROS"</span>&#125;)</div><div class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</div><div class="line">          self.put_structured_out(&#123;<span class="string">"securityState"</span>: <span class="string">"ERROR"</span>&#125;)</div><div class="line">          self.put_structured_out(&#123;<span class="string">"securityStateErrorInfo"</span>: str(e)&#125;)</div><div class="line">      <span class="keyword">else</span>:</div><div class="line">        issues = []</div><div class="line">        <span class="keyword">for</span> cf <span class="keyword">in</span> result_issues:</div><div class="line">          issues.append(<span class="string">"Configuration file %s did not pass the validation. Reason: %s"</span> % (cf, result_issues[cf]))</div><div class="line">        self.put_structured_out(&#123;<span class="string">"securityIssuesFound"</span>: <span class="string">". "</span>.join(issues)&#125;)</div><div class="line">        self.put_structured_out(&#123;<span class="string">"securityState"</span>: <span class="string">"UNSECURED"</span>&#125;)</div><div class="line">    <span class="keyword">else</span>:</div><div class="line">      self.put_structured_out(&#123;<span class="string">"securityState"</span>: <span class="string">"UNSECURED"</span>&#125;)</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</div><div class="line">  HbaseThriftServer().execute()</div></pre></td></tr></table></figure></p>
<p>其实是copy的regionserver的脚本，因为install什么的都不用，所以就全设置为print了。</p>
<h2 id="重启ambari-server"><a href="#重启ambari-server" class="headerlink" title="重启ambari-server"></a>重启ambari-server</h2><h2 id="添加hbase服务"><a href="#添加hbase服务" class="headerlink" title="添加hbase服务"></a>添加hbase服务</h2><h2 id="插曲"><a href="#插曲" class="headerlink" title="插曲"></a>插曲</h2><p>install的时候出现错误，启动的时候也会这样。。。看来是应该先注册一下自己的名字：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div></pre></td><td class="code"><pre><div class="line">2017-04-05 09:32:30,375 - Could not determine HDP version for component hbase-thrift by calling &apos;/usr/bin/hdp-select status hbase-thrift &gt; /tmp/tmpa6nhtU&apos;. Return Code: 1, Output: ERROR: Invalid package - hbase-thrift</div><div class="line"></div><div class="line">Packages:</div><div class="line">  accumulo-client</div><div class="line">  accumulo-gc</div><div class="line">  accumulo-master</div><div class="line">  accumulo-monitor</div><div class="line">  accumulo-tablet</div><div class="line">  accumulo-tracer</div><div class="line">  atlas-server</div><div class="line">  falcon-client</div><div class="line">  falcon-server</div><div class="line">  flume-server</div><div class="line">  hadoop-client</div><div class="line">  hadoop-hdfs-datanode</div><div class="line">  hadoop-hdfs-journalnode</div><div class="line">  hadoop-hdfs-namenode</div><div class="line">  hadoop-hdfs-nfs3</div><div class="line">  hadoop-hdfs-portmap</div><div class="line">  hadoop-hdfs-secondarynamenode</div><div class="line">  hadoop-httpfs</div><div class="line">  hadoop-mapreduce-historyserver</div><div class="line">  hadoop-yarn-nodemanager</div><div class="line">  hadoop-yarn-resourcemanager</div><div class="line">  hadoop-yarn-timelineserver</div><div class="line">  hbase-client</div><div class="line">  hbase-master</div><div class="line">  hbase-regionserver</div><div class="line">  hive-metastore</div><div class="line">  hive-server2</div><div class="line">  hive-webhcat</div><div class="line">  kafka-broker</div><div class="line">  knox-server</div><div class="line">  livy-server</div><div class="line">  mahout-client</div><div class="line">  oozie-client</div><div class="line">  oozie-server</div><div class="line">  phoenix-client</div><div class="line">  phoenix-server</div><div class="line">  ranger-admin</div><div class="line">  ranger-kms</div><div class="line">  ranger-usersync</div><div class="line">  slider-client</div><div class="line">  spark-client</div><div class="line">  spark-historyserver</div><div class="line">  spark-thriftserver</div><div class="line">  sqoop-client</div><div class="line">  sqoop-server</div><div class="line">  storm-client</div><div class="line">  storm-nimbus</div><div class="line">  storm-slider-client</div><div class="line">  storm-supervisor</div><div class="line">  zeppelin-server</div><div class="line">  zookeeper-client</div><div class="line">  zookeeper-server</div><div class="line">Aliases:</div><div class="line">  accumulo-server</div><div class="line">  all</div><div class="line">  client</div><div class="line">  hadoop-hdfs-server</div><div class="line">  hadoop-mapreduce-server</div><div class="line">  hadoop-yarn-server</div><div class="line">  hive-server</div><div class="line">.</div></pre></td></tr></table></figure></p>
<p>找了老半天，问题竟然在shell里，服了。<br>在/usr/bin/hdp-select里的leaves字典里添加<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&quot;hbase-thrift&quot;: &quot;hbase&quot;,</div></pre></td></tr></table></figure></p>
<p>然后还要创建一个目录才行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ln -s /usr/hdp/2.4.2.0-258/hbase-regionserver /usr/hdp/current/hbase-thrift</div></pre></td></tr></table></figure></p>
<p>参考：</p>
<ul>
<li><a href="https://cwiki.apache.org/confluence/display/AMBARI/Defining+a+Custom+Stack+and+Services" target="_blank" rel="external">https://cwiki.apache.org/confluence/display/AMBARI/Defining+a+Custom+Stack+and+Services</a></li>
<li></li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    

    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/youdaonote/">youdaonote</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>





   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2017/04/01/hdfs-ACL开启后出现问题/" title="hdfs-ACL开启后出现问题" itemprop="url">hdfs-ACL开启后出现问题</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Will Chen" target="_blank" itemprop="author">Will Chen</a>
		
  <p class="article-time">
    <time datetime="2017-04-01T08:21:15.000Z" itemprop="datePublished"> 发表于 2017-04-01</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>已经用测试环境重现了此问题。</p>
<ol>
<li>启用namenode的acl，在hdfs-site.xml中添加</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;property&gt;</div><div class="line">    &lt;name&gt;dfs.namenode.acls.enabled&lt;/name&gt;</div><div class="line">    &lt;value&gt;true&lt;/value&gt;</div><div class="line">&lt;/property&gt;</div></pre></td></tr></table></figure>
<ol>
<li><p>使用root用户创建初始文件夹, 并给以同生产环境的ACL设置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line">root@will-vm:/opt/hadoop-2.7.1# ./bin/hdfs dfs -mkdir -p /tmp/ods_tinyv_outer.db/channel=wb</div><div class="line">root@will-vm:/opt/hadoop-2.7.1# ./bin/hdfs dfs -getfacl /tmp/ods_tinyv_outer.db/channel=wb</div><div class="line"># file: /tmp/ods_tinyv_outer.db/channel=wb</div><div class="line"># owner: root</div><div class="line"># group: supergroup</div><div class="line">user::rwx</div><div class="line">group::r-x</div><div class="line">other::r-x</div><div class="line"></div><div class="line">root@will-vm:/opt/hadoop-2.7.1# ./bin/hdfs dfs -setfacl -R -m default:user::rwx /tmp/ods_tinyv_outer.db</div><div class="line">root@will-vm:/opt/hadoop-2.7.1# ./bin/hdfs dfs -setfacl -R -m default:group:wil:rwx /tmp/ods_tinyv_outer.db</div><div class="line"></div><div class="line">root@will-vm:/opt/hadoop-2.7.1# ./bin/hdfs dfs -getfacl /tmp/ods_tinyv_outer.db/channel=wb</div><div class="line"># file: /tmp/ods_tinyv_outer.db/channel=wb</div><div class="line"># owner: root</div><div class="line"># group: supergroup</div><div class="line">user::rwx</div><div class="line">group::r-x</div><div class="line">other::r-x</div><div class="line">default:user::rwx</div><div class="line">default:group::r-x</div><div class="line">default:group:wil:rwx</div><div class="line">default:mask::rwx</div><div class="line">default:other::r-x</div><div class="line">root@will-vm:/opt/hadoop-2.7.1# ./bin/hdfs dfs -chown -R wil:wil /tmp/ods_tinyv_outer.db/channel=wb</div><div class="line">root@will-vm:/opt/hadoop-2.7.1# ./bin/hdfs dfs -getfacl /tmp/ods_tinyv_outer.db/channel=wb</div><div class="line"># file: /tmp/ods_tinyv_outer.db/channel=wb</div><div class="line"># owner: wil</div><div class="line"># group: wil</div><div class="line">user::rwx</div><div class="line">group::r-x</div><div class="line">other::r-x</div><div class="line">default:user::rwx</div><div class="line">default:group::r-x</div><div class="line">default:group:wil:rwx</div><div class="line">default:mask::rwx</div><div class="line">default:other::r-x</div><div class="line">root@will-vm:/opt/hadoop-2.7.1# ./bin/hdfs dfs -chmod 770 /tmp/ods_tinyv_outer.db/channel=wb</div><div class="line">root@will-vm:/opt/hadoop-2.7.1# ./bin/hdfs dfs -getfacl /tmp/ods_tinyv_outer.db/channel=wb</div><div class="line"># file: /tmp/ods_tinyv_outer.db/channel=wb</div><div class="line"># owner: wil</div><div class="line"># group: wil</div><div class="line">user::rwx</div><div class="line">group::rwx</div><div class="line">other::---</div><div class="line">default:user::rwx</div><div class="line">default:group::r-x</div><div class="line">default:group:wil:rwx</div><div class="line">default:mask::rwx</div><div class="line">default:other::r-x</div></pre></td></tr></table></figure>
</li>
<li><p>重现问题</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">wil@will-vm:/opt/hadoop-2.7.1$ ./bin/hdfs dfs -rmr /tmp/ods_tinyv_outer.db/channel=wb</div><div class="line">rmr: DEPRECATED: Please use &apos;rm -r&apos; instead.</div><div class="line">17/04/02 23:01:41 INFO fs.TrashPolicyDefault: Namenode trash configuration: Deletion interval = 0 minutes, Emptier interval = 0 minutes.</div><div class="line">rmr: Permission denied: user=wil, access=WRITE, inode=&quot;/tmp/ods_tinyv_outer.db/channel=wb&quot;:root:supergroup:drwxr-xr-x</div></pre></td></tr></table></figure>
</li>
</ol>
<p>这个文件明明是属于wil用户wil用户组的，并且从acl来看是有权限的。然而实际执行的时候，却提示没权，而且列出来的权限竟然是<code>:root:supergroup:drwxr-xr-x</code>，这个应该是刚刚创建时的权限。</p>
<ol>
<li>解决<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">root@will-vm:/opt/hadoop-2.7.1# ./bin/hdfs dfs -chown wil:wil /tmp/ods_tinyv_outer.db</div></pre></td></tr></table></figure>
</li>
</ol>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    

    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/youdaonote/">youdaonote</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>





   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2017/03/31/hue-metastore引出的HDFS权限问题/" title="hue metastore引出的HDFS权限问题" itemprop="url">hue metastore引出的HDFS权限问题</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Will Chen" target="_blank" itemprop="author">Will Chen</a>
		
  <p class="article-time">
    <time datetime="2017-03-31T08:32:29.000Z" itemprop="datePublished"> 发表于 2017-03-31</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h2><p>支持的某个事业部提出一个需求：<strong>在hue里开放修改表或者字段的权限</strong>。</p>
<p>在hue里就给她一个人开了相应的权限，账户名是wcq。因为不知道wcq的密码，所以使用的mm的测试账户登陆的，<strong>在hue里给了两个人相同的权限组：lv和metastoremanger</strong>。</p>
<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>然而奇怪的现象就发生了：<strong>wcq在hue的metastore管理界面修改表的字段之后，看网络请求是成功了的。然而，刷新页面以后就没有了。mm这个账户确都可以使用。</strong></p>
<h2 id="追查"><a href="#追查" class="headerlink" title="追查"></a>追查</h2><p>经查验，mm这个用户在HDFS中除了是lv组的用户，而且还是hdfs组的用户，而<strong>hdfs组是超级用户组，拥有任何权限</strong>。所以这两个用户所在的组并不是对等的，只是在hue里对等而已。</p>
<p>理论上如果hue直接操作hive元数据库的话是不会有此问题的。</p>
<h4 id="查一下网络请求有什么异常？"><a href="#查一下网络请求有什么异常？" class="headerlink" title="查一下网络请求有什么异常？"></a>查一下网络请求有什么异常？</h4><p>发送的request包摘要：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Request URL:http://10.1.5.83/metastore/table/dim_tinyv/data_dict/alter_column</div><div class="line">Request Method:POST</div><div class="line"></div><div class="line">column:id</div><div class="line">comment:ss</div></pre></td></tr></table></figure></p>
<p>返回的response内容：<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="attr">"status"</span>: <span class="number">0</span>,</div><div class="line">    <span class="attr">"message"</span>: <span class="string">""</span>,</div><div class="line">    <span class="attr">"data"</span>: &#123;</div><div class="line">        <span class="attr">"comment"</span>: <span class="string">""</span>,</div><div class="line">        <span class="attr">"type"</span>: <span class="string">"int"</span>,</div><div class="line">        <span class="attr">"name"</span>: <span class="string">"id"</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="hue源码确认逻辑"><a href="#hue源码确认逻辑" class="headerlink" title="hue源码确认逻辑"></a>hue源码确认逻辑</h4><p>以url为线索查看hue相关源码<code>apps/metastore/src/metastore/urls.py</code>中找到<code>alter_table</code>，在<code>apps/metastore/src/metastore/views.py</code>里：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">check_has_write_access_permission</div><div class="line"><span class="meta">@require_http_methods(["POST"])</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">alter_column</span><span class="params">(request, database, table)</span>:</span></div><div class="line">  db = dbms.get(request.user)</div><div class="line">  response = &#123;<span class="string">'status'</span>: <span class="number">-1</span>, <span class="string">'message'</span>: <span class="string">''</span>&#125;</div><div class="line">  <span class="keyword">try</span>:</div><div class="line">    column = request.POST.get(<span class="string">'column'</span>, <span class="keyword">None</span>)</div><div class="line"></div><div class="line">    <span class="keyword">if</span> column <span class="keyword">is</span> <span class="keyword">None</span>:</div><div class="line">      <span class="keyword">raise</span> PopupException(_(<span class="string">'alter_column requires a column parameter'</span>))</div><div class="line"></div><div class="line">    column_obj = db.get_column(database, table, column)</div><div class="line">    <span class="keyword">if</span> column_obj:</div><div class="line">      new_column_name = request.POST.get(<span class="string">'new_column_name'</span>, column_obj.name)</div><div class="line">      new_column_type = request.POST.get(<span class="string">'new_column_type'</span>, column_obj.type)</div><div class="line">      comment = request.POST.get(<span class="string">'comment'</span>, <span class="keyword">None</span>)</div><div class="line">      partition_spec = request.POST.get(<span class="string">'partition_spec'</span>, <span class="keyword">None</span>)</div><div class="line"></div><div class="line">      column_obj = db.alter_column(database, table, column, new_column_name, new_column_type, comment=comment, partition_spec=partition_spec)</div><div class="line"></div><div class="line">      response[<span class="string">'status'</span>] = <span class="number">0</span></div><div class="line">      response[<span class="string">'data'</span>] = &#123;</div><div class="line">        <span class="string">'name'</span>: column_obj.name,</div><div class="line">        <span class="string">'type'</span>: column_obj.type,</div><div class="line">        <span class="string">'comment'</span>: column_obj.comment</div><div class="line">      &#125;</div><div class="line">    <span class="keyword">else</span>:</div><div class="line">      <span class="keyword">raise</span> PopupException(_(<span class="string">'Column `%s`.`%s` `%s` not found'</span>) % (database, table, column))</div><div class="line">  <span class="keyword">except</span> Exception, ex:</div><div class="line">    response[<span class="string">'status'</span>] = <span class="number">1</span></div><div class="line">    response[<span class="string">'message'</span>] = _(<span class="string">"Failed to alter column `%s`.`%s` `%s`: %s"</span>) % (database, table, column, str(ex))</div><div class="line"></div><div class="line">  <span class="keyword">return</span> JsonResponse(response)</div></pre></td></tr></table></figure>
<p>看到是使用了dbms里返回的数据库执行的语句，找到<code>apps/beeswax/src/beeswax/server/dbms.py</code>，对应代码：<br><figure class="highlight py"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(user, query_server=None)</span>:</span></div><div class="line">  <span class="keyword">global</span> DBMS_CACHE</div><div class="line">  <span class="keyword">global</span> DBMS_CACHE_LOCK</div><div class="line"></div><div class="line">  <span class="keyword">if</span> query_server <span class="keyword">is</span> <span class="keyword">None</span>:</div><div class="line">    query_server = get_query_server_config()</div><div class="line"></div><div class="line">  DBMS_CACHE_LOCK.acquire()</div><div class="line">  <span class="keyword">try</span>:</div><div class="line">    DBMS_CACHE.setdefault(user.username, &#123;&#125;)</div><div class="line"></div><div class="line">    <span class="keyword">if</span> query_server[<span class="string">'server_name'</span>] <span class="keyword">not</span> <span class="keyword">in</span> DBMS_CACHE[user.username]:</div><div class="line">      <span class="comment"># Avoid circular dependency</span></div><div class="line">      <span class="keyword">from</span> beeswax.server.hive_server2_lib <span class="keyword">import</span> HiveServerClientCompatible</div><div class="line"></div><div class="line">      <span class="keyword">if</span> query_server[<span class="string">'server_name'</span>] == <span class="string">'impala'</span>:</div><div class="line">        <span class="keyword">from</span> impala.dbms <span class="keyword">import</span> ImpalaDbms</div><div class="line">        <span class="keyword">from</span> impala.server <span class="keyword">import</span> ImpalaServerClient</div><div class="line">        DBMS_CACHE[user.username][query_server[<span class="string">'server_name'</span>]] = ImpalaDbms(HiveServerClientCompatible(ImpalaServerClient(query_server, user)), QueryHistory.SERVER_TYPE[<span class="number">1</span>][<span class="number">0</span>])</div><div class="line">      <span class="keyword">else</span>:</div><div class="line">        <span class="keyword">from</span> beeswax.server.hive_server2_lib <span class="keyword">import</span> HiveServerClient</div><div class="line">        DBMS_CACHE[user.username][query_server[<span class="string">'server_name'</span>]] = HiveServer2Dbms(HiveServerClientCompatible(HiveServerClient(query_server, user)), QueryHistory.SERVER_TYPE[<span class="number">1</span>][<span class="number">0</span>])</div><div class="line"></div><div class="line">    <span class="keyword">return</span> DBMS_CACHE[user.username][query_server[<span class="string">'server_name'</span>]]</div><div class="line">  <span class="keyword">finally</span>:</div><div class="line">    DBMS_CACHE_LOCK.release()</div></pre></td></tr></table></figure></p>
<p>可以看到是使用hiveserver2建立连接，搞定的。并不是最开始猜测的直接操作hive的元数据库。</p>
<p>修改数据字段的方法也在这里：<br><figure class="highlight py"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">alter_column</span><span class="params">(self, database, table_name, column_name, new_column_name, column_type, comment=None,</span></span></div><div class="line">                   partition_spec=None, cascade=False):</div><div class="line">    hql = <span class="string">'ALTER TABLE `%s`.`%s`'</span> % (database, table_name)</div><div class="line"></div><div class="line">    <span class="keyword">if</span> partition_spec:</div><div class="line">      hql += <span class="string">' PARTITION (%s)'</span> % partition_spec</div><div class="line"></div><div class="line">    hql += <span class="string">' CHANGE COLUMN `%s` `%s` %s'</span> % (column_name, new_column_name, column_type.upper())</div><div class="line"></div><div class="line">    <span class="keyword">if</span> comment:</div><div class="line">      hql += <span class="string">" COMMENT '%s'"</span> % comment</div><div class="line"></div><div class="line">    <span class="keyword">if</span> cascade:</div><div class="line">      hql += <span class="string">' CASCADE'</span></div><div class="line"></div><div class="line">    timeout = SERVER_CONN_TIMEOUT.get()</div><div class="line">    query = hql_query(hql)</div><div class="line">    handle = self.execute_and_wait(query, timeout_sec=timeout)</div><div class="line"></div><div class="line">    <span class="keyword">if</span> handle:</div><div class="line">      self.close(handle)</div><div class="line">    <span class="keyword">else</span>:</div><div class="line">      msg = _(<span class="string">"Failed to execute alter column statement: %s"</span>) % hql</div><div class="line">      <span class="keyword">raise</span> QueryServerException(msg)</div><div class="line"></div><div class="line">    <span class="keyword">return</span> self.get_column(database, table_name, new_column_name)</div></pre></td></tr></table></figure></p>
<h4 id="执行相应逻辑"><a href="#执行相应逻辑" class="headerlink" title="执行相应逻辑"></a>执行相应逻辑</h4><p>这样的话，我们直接在命令行里，切换到wcq用户执行hive命令行，应该是一样的。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">hive&gt; alter table default.batting CHANGE COLUMN dtdontquery dtdontquery string COMMENT &apos;ss&apos;;</div><div class="line">FAILED: Execution Error, return code 1 from org.apache.hadoop.hive.ql.exec.DDLTask. Unable to alter table. java.security.AccessControlException: Permission denied: user=wcq, access=WRITE, inode=&quot;/apps/hive/warehouse/batting&quot;:root:jlc:drwxr-xr-x</div></pre></td></tr></table></figure></p>
<p>此阶段结论：<strong>hue通过hiveserver执行hql语句，而且hive本身修改表元数据的时候也会验证是否有对HDFS目录有写权限</strong>。</p>
<h2 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h2><p>那么应该怎样解决呢？</p>
<p>当前的目录权限都是给的：<code>drwxr-x---</code>，也就是只有owner有写权限, 指定组的用户有读权限，匿名用户没有任何权限。</p>
<p>这样授权的理由在于，以事业部为组，所有同一个事业部的人都可读，但是只能通过我们的数据平台用户来进行写操作【当前是root】。</p>
<p>既不想违背这个初衷，又要满足新的需求，再不进行任何自主研发的前提下，只能<strong>启用HDFS的ACL</strong>，才能添加额外的权限。</p>
<p>hue中也支持*ACL修改，而且执行遍历目录修改.</p>
<p>步骤如下：<br><img src="/imgs/hue_acl/hue_dfs_acl_1.png" alt=""><br><img src="/imgs/hue_acl/hue_dfs_acl_2.png" alt=""><br><img src="/imgs/hue_acl/hue_dfs_acl_3.png" alt=""><br><img src="/imgs/hue_acl/hue_dfs_acl_4.png" alt=""></p>
<h2 id="遗留"><a href="#遗留" class="headerlink" title="遗留"></a>遗留</h2><p>对官网说的mask不太理解。字面意思好像是用来过滤所有用户、组、匿名组的权限的。</p>
<p>以官网例子来看：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">user::rw-</div><div class="line"> user:bruce:rwx                  #effective:r--</div><div class="line"> group::r-x                      #effective:r--</div><div class="line"> group:sales:rwx                 #effective:r--</div><div class="line"> mask::r--</div><div class="line"> other::r--</div></pre></td></tr></table></figure></p>
<p>因为上面指定的mask是只读，所以即便其他指定了额外的权限也是白费的，生效的只有只读。所以这样理解，mask就是这个文件可以有的所有权限的总和。如果不单独设置mask的话，其默认值也是这样算出来的。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="https://hadoop.apache.org/docs/r2.7.2/hadoop-project-dist/hadoop-hdfs/HdfsPermissionsGuide.html#The_Super-User" target="_blank" rel="external">https://hadoop.apache.org/docs/r2.7.2/hadoop-project-dist/hadoop-hdfs/HdfsPermissionsGuide.html#The_Super-User</a></li>
<li><a href="https://hadoop.apache.org/docs/r2.7.2/hadoop-project-dist/hadoop-common/FileSystemShell.html#setfacl" target="_blank" rel="external">https://hadoop.apache.org/docs/r2.7.2/hadoop-project-dist/hadoop-common/FileSystemShell.html#setfacl</a></li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    

    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/hdfs/">hdfs</a><a href="/tags/hue/">hue</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>





   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2017/03/31/HDFS权限问题/" title="HDFS权限问题" itemprop="url">HDFS权限问题</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Will Chen" target="_blank" itemprop="author">Will Chen</a>
		
  <p class="article-time">
    <time datetime="2017-03-31T07:27:40.000Z" itemprop="datePublished"> 发表于 2017-03-31</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>支持的某个事业部提出一个需求：在hue里开放修改表或者字段的权限。</p>
<p>在hue里就给她一个人开了相应的权限，账户名是wcq。因为不知道wcq的密码，所以使用的mm的测试账户登陆的，<strong>在hue里给了两个人相同的权限组：lv和metastoremanger</strong>。</p>
<p>然而奇怪的现象就发生了：<strong>wcq在hue的metastore管理界面修改表的字段之后，看网络请求是成功了的。然而，刷新页面以后就没有了。mm这个账户确都可以使用。</strong></p>
<p>经查验，mm这个用户在HDFS中除了是lv组的用户，而且还是hdfs组的用户，而<strong>hdfs组是超级用户组，拥有任何权限</strong>。所以这两个用户所在的组并不是对等的，只是在hue里对等而已。</p>
<p>理论上如果hue直接操作hive元数据库的话是不会有此问题的。</p>
<p>查一下网络请求有什么异常？<br>发送的request包摘要：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Request URL:http://10.1.5.83/metastore/table/dim_tinyv/data_dict/alter_column</div><div class="line">Request Method:POST</div><div class="line"></div><div class="line">column:id</div><div class="line">comment:ss</div></pre></td></tr></table></figure></p>
<p>返回的response内容：<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="attr">"status"</span>: <span class="number">0</span>,</div><div class="line">    <span class="attr">"message"</span>: <span class="string">""</span>,</div><div class="line">    <span class="attr">"data"</span>: &#123;</div><div class="line">        <span class="attr">"comment"</span>: <span class="string">""</span>,</div><div class="line">        <span class="attr">"type"</span>: <span class="string">"int"</span>,</div><div class="line">        <span class="attr">"name"</span>: <span class="string">"id"</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>以url为线索查看hue相关源码<code>apps/metastore/src/metastore/urls.py</code>中找到<code>alter_table</code>，在<code>apps/metastore/src/metastore/views.py</code>里：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">check_has_write_access_permission</div><div class="line"><span class="meta">@require_http_methods(["POST"])</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">alter_column</span><span class="params">(request, database, table)</span>:</span></div><div class="line">  db = dbms.get(request.user)</div><div class="line">  response = &#123;<span class="string">'status'</span>: <span class="number">-1</span>, <span class="string">'message'</span>: <span class="string">''</span>&#125;</div><div class="line">  <span class="keyword">try</span>:</div><div class="line">    column = request.POST.get(<span class="string">'column'</span>, <span class="keyword">None</span>)</div><div class="line"></div><div class="line">    <span class="keyword">if</span> column <span class="keyword">is</span> <span class="keyword">None</span>:</div><div class="line">      <span class="keyword">raise</span> PopupException(_(<span class="string">'alter_column requires a column parameter'</span>))</div><div class="line"></div><div class="line">    column_obj = db.get_column(database, table, column)</div><div class="line">    <span class="keyword">if</span> column_obj:</div><div class="line">      new_column_name = request.POST.get(<span class="string">'new_column_name'</span>, column_obj.name)</div><div class="line">      new_column_type = request.POST.get(<span class="string">'new_column_type'</span>, column_obj.type)</div><div class="line">      comment = request.POST.get(<span class="string">'comment'</span>, <span class="keyword">None</span>)</div><div class="line">      partition_spec = request.POST.get(<span class="string">'partition_spec'</span>, <span class="keyword">None</span>)</div><div class="line"></div><div class="line">      column_obj = db.alter_column(database, table, column, new_column_name, new_column_type, comment=comment, partition_spec=partition_spec)</div><div class="line"></div><div class="line">      response[<span class="string">'status'</span>] = <span class="number">0</span></div><div class="line">      response[<span class="string">'data'</span>] = &#123;</div><div class="line">        <span class="string">'name'</span>: column_obj.name,</div><div class="line">        <span class="string">'type'</span>: column_obj.type,</div><div class="line">        <span class="string">'comment'</span>: column_obj.comment</div><div class="line">      &#125;</div><div class="line">    <span class="keyword">else</span>:</div><div class="line">      <span class="keyword">raise</span> PopupException(_(<span class="string">'Column `%s`.`%s` `%s` not found'</span>) % (database, table, column))</div><div class="line">  <span class="keyword">except</span> Exception, ex:</div><div class="line">    response[<span class="string">'status'</span>] = <span class="number">1</span></div><div class="line">    response[<span class="string">'message'</span>] = _(<span class="string">"Failed to alter column `%s`.`%s` `%s`: %s"</span>) % (database, table, column, str(ex))</div><div class="line"></div><div class="line">  <span class="keyword">return</span> JsonResponse(response)</div></pre></td></tr></table></figure>
<p>看到是使用了dbms里返回的数据库执行的语句，找到<code>apps/beeswax/src/beeswax/server/dbms.py</code>，对应代码：<br><figure class="highlight py"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(user, query_server=None)</span>:</span></div><div class="line">  <span class="keyword">global</span> DBMS_CACHE</div><div class="line">  <span class="keyword">global</span> DBMS_CACHE_LOCK</div><div class="line"></div><div class="line">  <span class="keyword">if</span> query_server <span class="keyword">is</span> <span class="keyword">None</span>:</div><div class="line">    query_server = get_query_server_config()</div><div class="line"></div><div class="line">  DBMS_CACHE_LOCK.acquire()</div><div class="line">  <span class="keyword">try</span>:</div><div class="line">    DBMS_CACHE.setdefault(user.username, &#123;&#125;)</div><div class="line"></div><div class="line">    <span class="keyword">if</span> query_server[<span class="string">'server_name'</span>] <span class="keyword">not</span> <span class="keyword">in</span> DBMS_CACHE[user.username]:</div><div class="line">      <span class="comment"># Avoid circular dependency</span></div><div class="line">      <span class="keyword">from</span> beeswax.server.hive_server2_lib <span class="keyword">import</span> HiveServerClientCompatible</div><div class="line"></div><div class="line">      <span class="keyword">if</span> query_server[<span class="string">'server_name'</span>] == <span class="string">'impala'</span>:</div><div class="line">        <span class="keyword">from</span> impala.dbms <span class="keyword">import</span> ImpalaDbms</div><div class="line">        <span class="keyword">from</span> impala.server <span class="keyword">import</span> ImpalaServerClient</div><div class="line">        DBMS_CACHE[user.username][query_server[<span class="string">'server_name'</span>]] = ImpalaDbms(HiveServerClientCompatible(ImpalaServerClient(query_server, user)), QueryHistory.SERVER_TYPE[<span class="number">1</span>][<span class="number">0</span>])</div><div class="line">      <span class="keyword">else</span>:</div><div class="line">        <span class="keyword">from</span> beeswax.server.hive_server2_lib <span class="keyword">import</span> HiveServerClient</div><div class="line">        DBMS_CACHE[user.username][query_server[<span class="string">'server_name'</span>]] = HiveServer2Dbms(HiveServerClientCompatible(HiveServerClient(query_server, user)), QueryHistory.SERVER_TYPE[<span class="number">1</span>][<span class="number">0</span>])</div><div class="line"></div><div class="line">    <span class="keyword">return</span> DBMS_CACHE[user.username][query_server[<span class="string">'server_name'</span>]]</div><div class="line">  <span class="keyword">finally</span>:</div><div class="line">    DBMS_CACHE_LOCK.release()</div></pre></td></tr></table></figure></p>
<p>可以看到是使用hiveserver2建立连接，搞定的。并不是最开始猜测的直接操作hive的元数据库。</p>
<p>修改数据字段的方法也在这里：<br><figure class="highlight py"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">alter_column</span><span class="params">(self, database, table_name, column_name, new_column_name, column_type, comment=None,</span></span></div><div class="line">                   partition_spec=None, cascade=False):</div><div class="line">    hql = <span class="string">'ALTER TABLE `%s`.`%s`'</span> % (database, table_name)</div><div class="line"></div><div class="line">    <span class="keyword">if</span> partition_spec:</div><div class="line">      hql += <span class="string">' PARTITION (%s)'</span> % partition_spec</div><div class="line"></div><div class="line">    hql += <span class="string">' CHANGE COLUMN `%s` `%s` %s'</span> % (column_name, new_column_name, column_type.upper())</div><div class="line"></div><div class="line">    <span class="keyword">if</span> comment:</div><div class="line">      hql += <span class="string">" COMMENT '%s'"</span> % comment</div><div class="line"></div><div class="line">    <span class="keyword">if</span> cascade:</div><div class="line">      hql += <span class="string">' CASCADE'</span></div><div class="line"></div><div class="line">    timeout = SERVER_CONN_TIMEOUT.get()</div><div class="line">    query = hql_query(hql)</div><div class="line">    handle = self.execute_and_wait(query, timeout_sec=timeout)</div><div class="line"></div><div class="line">    <span class="keyword">if</span> handle:</div><div class="line">      self.close(handle)</div><div class="line">    <span class="keyword">else</span>:</div><div class="line">      msg = _(<span class="string">"Failed to execute alter column statement: %s"</span>) % hql</div><div class="line">      <span class="keyword">raise</span> QueryServerException(msg)</div><div class="line"></div><div class="line">    <span class="keyword">return</span> self.get_column(database, table_name, new_column_name)</div></pre></td></tr></table></figure></p>
<p>这样的话，我们直接在命令行里，切换到wcq用户执行hive命令行，应该是一样的。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">hive&gt; alter table default.batting CHANGE COLUMN dtdontquery dtdontquery string COMMENT &apos;ss&apos;;</div><div class="line">FAILED: Execution Error, return code 1 from org.apache.hadoop.hive.ql.exec.DDLTask. Unable to alter table. java.security.AccessControlException: Permission denied: user=wcq, access=WRITE, inode=&quot;/apps/hive/warehouse/batting&quot;:root:jlc:drwxr-xr-x</div></pre></td></tr></table></figure></p>
<p>此阶段结论：hue通过hiveserver执行hql语句，而且hive本身修改表元数据的时候也会验证是否有对HDFS目录有写权限。</p>
<p>那么应该怎样解决呢？</p>
<p>当前的目录权限都是给的：<code>drwxr-x---</code>，也就是只有owner有写权限, 指定组的用户有读权限，匿名用户没有任何权限。</p>
<p>这样授权的理由在于，以事业部为组，所有同一个事业部的人都可读，但是只能通过我们的数据平台用户来进行写操作【当前是root】。</p>
<p>既不想违背这个初衷，又要满足新的需求，再不进行任何自主研发的前提下，只能<strong>启用HDFS的ACL</strong>，才能添加额外的权限。</p>
<p>hue中也支持*ACL修改，而且执行遍历目录修改.</p>
<p>问题<br>=<br>对官网说的mask不太理解。字面意思好像是用来过滤所有用户、组、匿名组的权限的。</p>
<p>以官网例子来看：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">user::rw-</div><div class="line"> user:bruce:rwx                  #effective:r--</div><div class="line"> group::r-x                      #effective:r--</div><div class="line"> group:sales:rwx                 #effective:r--</div><div class="line"> mask::r--</div><div class="line"> other::r--</div></pre></td></tr></table></figure></p>
<p>因为上面指定的mask是只读，所以即便其他指定了额外的权限也是白费的，生效的只有只读。所以这样理解，mask就是这个文件可以有的所有权限的总和。如果不单独设置mask的话，其默认值也是这样算出来的。</p>
<p>参考<br>=</p>
<ul>
<li><a href="https://hadoop.apache.org/docs/r2.7.2/hadoop-project-dist/hadoop-hdfs/HdfsPermissionsGuide.html#The_Super-User" target="_blank" rel="external">https://hadoop.apache.org/docs/r2.7.2/hadoop-project-dist/hadoop-hdfs/HdfsPermissionsGuide.html#The_Super-User</a></li>
<li><a href="https://hadoop.apache.org/docs/r2.7.2/hadoop-project-dist/hadoop-common/FileSystemShell.html#setfacl" target="_blank" rel="external">https://hadoop.apache.org/docs/r2.7.2/hadoop-project-dist/hadoop-common/FileSystemShell.html#setfacl</a></li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    

    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/youdaonote/">youdaonote</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>





   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2017/03/31/ambari脚本更新配置/" title="ambari脚本更新配置" itemprop="url">ambari脚本更新配置</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Will Chen" target="_blank" itemprop="author">Will Chen</a>
		
  <p class="article-time">
    <time datetime="2017-03-31T02:45:56.000Z" itemprop="datePublished"> 发表于 2017-03-31</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>类似于<code>hdfs_log_dir_prefix</code>这种配置项一旦在服务初始化完成之后，就不能在UI界面上进行修改了。具体ambari为什么要这样限制，个人表示无从知晓。</p>
<p>通过文件<code>/var/lib/ambari-agent/cache/cluster_configuration/configurations.json</code>，我们可以直接看到所有的环境相关配置。暂时猜测可能是为了统一一次性生成此文件，而所有UI的操作都是修改的各自的对应的xml配置文件。</p>
<p>官方提供了两种方式修改对于此json文件相关的配置。一个是API，另一个就是通过<code>/var/lib/ambari-server/resources/scripts/config.sh</code>脚本。</p>
<p>个人比较倾向于脚本，更不易出错。查看config.sh的使用方法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">/var/lib/ambari-server/resources/scripts/configs.py --help</div><div class="line">Usage: configs.py [options]</div><div class="line">Options:</div><div class="line">  -h, --help            show this help message and exit</div><div class="line">  -t PORT, --port=PORT  Optional port number for Ambari server. Default is</div><div class="line">                        &apos;8080&apos;. Provide empty string to not use port.</div><div class="line">  -s PROTOCOL, --protocol=PROTOCOL</div><div class="line">                        Optional support of SSL. Default protocol is &apos;http&apos;</div><div class="line">  -a ACTION, --action=ACTION</div><div class="line">                        Script action: &lt;get&gt;, &lt;set&gt;, &lt;delete&gt;</div><div class="line">  -l HOST, --host=HOST  Server external host name</div><div class="line">  -n CLUSTER, --cluster=CLUSTER</div><div class="line">                        Name given to cluster. Ex: &apos;c1&apos;</div><div class="line">  -c CONFIG_TYPE, --config-type=CONFIG_TYPE</div><div class="line">                        One of the various configuration types in Ambari. Ex:</div><div class="line">                        core-site, hdfs-site, mapred-queue-acls, etc.</div><div class="line">  To specify credentials please use &quot;-e&quot; OR &quot;-u&quot; and &quot;-p&apos;&quot;:</div><div class="line">    -u USER, --user=USER</div><div class="line">                        Optional user ID to use for authentication. Default is</div><div class="line">                        &apos;admin&apos;</div><div class="line">    -p PASSWORD, --password=PASSWORD</div><div class="line">                        Optional password to use for authentication. Default</div><div class="line">                        is &apos;admin&apos;</div><div class="line">    -e CREDENTIALS_FILE, --credentials-file=CREDENTIALS_FILE</div><div class="line">                        Optional file with user credentials separated by new</div><div class="line">                        line.</div><div class="line">  To specify property(s) please use &quot;-f&quot; OR &quot;-k&quot; and &quot;-v&apos;&quot;:</div><div class="line">    -f FILE, --file=FILE</div><div class="line">                        File where entire configurations are saved to, or read</div><div class="line">                        from. Supported extensions (.xml, .json&gt;)</div><div class="line">    -k KEY, --key=KEY   Key that has to be set or deleted. Not necessary for</div><div class="line">                        &apos;get&apos; action.</div><div class="line">    -v VALUE, --value=VALUE</div><div class="line">                        Optional value to be set. Not necessary for &apos;get&apos; or</div><div class="line">                        &apos;delete&apos; actions.</div></pre></td></tr></table></figure></p>
<p>首先，我们可以先用api查看一下配置项的分布：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div></pre></td><td class="code"><pre><div class="line">[hdfs@data-test01 scripts]$ curl -k -s -u admin:admin &quot;http://10.1.5.79:8080/api/v1/clusters/willcluster?fields=Clusters/desired_configs&quot;</div><div class="line">&#123;</div><div class="line">  &quot;href&quot; : &quot;http://10.1.5.79:8080/api/v1/clusters/willcluster?fields=Clusters/desired_configs&quot;,</div><div class="line">  &quot;Clusters&quot; : &#123;</div><div class="line">    &quot;cluster_name&quot; : &quot;willcluster&quot;,</div><div class="line">    &quot;version&quot; : &quot;HDP-2.4&quot;,</div><div class="line">    &quot;desired_configs&quot; : &#123;</div><div class="line">      &quot;capacity-scheduler&quot; : &#123;</div><div class="line">        &quot;tag&quot; : &quot;version1490254923891&quot;,</div><div class="line">        &quot;user&quot; : &quot;admin&quot;,</div><div class="line">        &quot;version&quot; : 2</div><div class="line">      &#125;,</div><div class="line">      &quot;cluster-env&quot; : &#123;</div><div class="line">        &quot;tag&quot; : &quot;version1490254925199&quot;,</div><div class="line">        &quot;user&quot; : &quot;admin&quot;,</div><div class="line">        &quot;version&quot; : 2</div><div class="line">      &#125;,</div><div class="line">      &quot;core-site&quot; : &#123;</div><div class="line">        &quot;tag&quot; : &quot;version1490345767824&quot;,</div><div class="line">        &quot;user&quot; : &quot;admin&quot;,</div><div class="line">        &quot;version&quot; : 5</div><div class="line">      &#125;,</div><div class="line">      &quot;hadoop-env&quot; : &#123;</div><div class="line">        &quot;tag&quot; : &quot;version1490254923436&quot;,</div><div class="line">        &quot;user&quot; : &quot;admin&quot;,</div><div class="line">        &quot;version&quot; : 2</div><div class="line">      &#125;,</div><div class="line">      &quot;hadoop-policy&quot; : &#123;</div><div class="line">        &quot;tag&quot; : &quot;version1&quot;,</div><div class="line">        &quot;user&quot; : &quot;admin&quot;,</div><div class="line">        &quot;version&quot; : 1</div><div class="line">      &#125;,</div><div class="line">      &quot;hdfs-log4j&quot; : &#123;</div><div class="line">        &quot;tag&quot; : &quot;version1&quot;,</div><div class="line">        &quot;user&quot; : &quot;admin&quot;,</div><div class="line">        &quot;version&quot; : 1</div><div class="line">      &#125;,</div><div class="line">      &quot;hdfs-site&quot; : &#123;</div><div class="line">        &quot;tag&quot; : &quot;version1490344980013&quot;,</div><div class="line">        &quot;user&quot; : &quot;admin&quot;,</div><div class="line">        &quot;version&quot; : 4</div><div class="line">      &#125;,</div><div class="line">      &quot;kerberos-env&quot; : &#123;</div><div class="line">        &quot;tag&quot; : &quot;version1490254524258&quot;,</div><div class="line">        &quot;user&quot; : &quot;admin&quot;,</div><div class="line">        &quot;version&quot; : 2</div><div class="line">      &#125;,</div><div class="line">      &quot;krb5-conf&quot; : &#123;</div><div class="line">        &quot;tag&quot; : &quot;version1490254524258&quot;,</div><div class="line">        &quot;user&quot; : &quot;admin&quot;,</div><div class="line">        &quot;version&quot; : 2</div><div class="line">      &#125;,</div><div class="line">      &quot;mapred-env&quot; : &#123;</div><div class="line">        &quot;tag&quot; : &quot;version1&quot;,</div><div class="line">        &quot;user&quot; : &quot;admin&quot;,</div><div class="line">        &quot;version&quot; : 1</div><div class="line">      &#125;,</div><div class="line">      &quot;mapred-site&quot; : &#123;</div><div class="line">        &quot;tag&quot; : &quot;version1490254925210&quot;,</div><div class="line">        &quot;user&quot; : &quot;admin&quot;,</div><div class="line">        &quot;version&quot; : 2</div><div class="line">      &#125;,</div><div class="line">      &quot;ranger-hdfs-audit&quot; : &#123;</div><div class="line">        &quot;tag&quot; : &quot;version1&quot;,</div><div class="line">        &quot;user&quot; : &quot;admin&quot;,</div><div class="line">        &quot;version&quot; : 1</div><div class="line">      &#125;,</div><div class="line">      &quot;ranger-hdfs-plugin-properties&quot; : &#123;</div><div class="line">        &quot;tag&quot; : &quot;version1&quot;,</div><div class="line">        &quot;user&quot; : &quot;admin&quot;,</div><div class="line">        &quot;version&quot; : 1</div><div class="line">      &#125;,</div><div class="line">      &quot;ranger-hdfs-policymgr-ssl&quot; : &#123;</div><div class="line">        &quot;tag&quot; : &quot;version1&quot;,</div><div class="line">        &quot;user&quot; : &quot;admin&quot;,</div><div class="line">        &quot;version&quot; : 1</div><div class="line">      &#125;,</div><div class="line">      &quot;ranger-hdfs-security&quot; : &#123;</div><div class="line">        &quot;tag&quot; : &quot;version1&quot;,</div><div class="line">        &quot;user&quot; : &quot;admin&quot;,</div><div class="line">        &quot;version&quot; : 1</div><div class="line">      &#125;,</div><div class="line">      &quot;ranger-yarn-audit&quot; : &#123;</div><div class="line">        &quot;tag&quot; : &quot;version1&quot;,</div><div class="line">        &quot;user&quot; : &quot;admin&quot;,</div><div class="line">        &quot;version&quot; : 1</div><div class="line">      &#125;,</div><div class="line">      &quot;ranger-yarn-plugin-properties&quot; : &#123;</div><div class="line">        &quot;tag&quot; : &quot;version1&quot;,</div><div class="line">        &quot;user&quot; : &quot;admin&quot;,</div><div class="line">        &quot;version&quot; : 1</div><div class="line">      &#125;,</div><div class="line">      &quot;ranger-yarn-policymgr-ssl&quot; : &#123;</div><div class="line">        &quot;tag&quot; : &quot;version1&quot;,</div><div class="line">        &quot;user&quot; : &quot;admin&quot;,</div><div class="line">        &quot;version&quot; : 1</div><div class="line">      &#125;,</div><div class="line">      &quot;ranger-yarn-security&quot; : &#123;</div><div class="line">        &quot;tag&quot; : &quot;version1&quot;,</div><div class="line">        &quot;user&quot; : &quot;admin&quot;,</div><div class="line">        &quot;version&quot; : 1</div><div class="line">      &#125;,</div><div class="line">      &quot;ssl-client&quot; : &#123;</div><div class="line">        &quot;tag&quot; : &quot;version1&quot;,</div><div class="line">        &quot;user&quot; : &quot;admin&quot;,</div><div class="line">        &quot;version&quot; : 1</div><div class="line">      &#125;,</div><div class="line">      &quot;ssl-server&quot; : &#123;</div><div class="line">        &quot;tag&quot; : &quot;version1&quot;,</div><div class="line">        &quot;user&quot; : &quot;admin&quot;,</div><div class="line">        &quot;version&quot; : 1</div><div class="line">      &#125;,</div><div class="line">      &quot;yarn-env&quot; : &#123;</div><div class="line">        &quot;tag&quot; : &quot;version1&quot;,</div><div class="line">        &quot;user&quot; : &quot;admin&quot;,</div><div class="line">        &quot;version&quot; : 1</div><div class="line">      &#125;,</div><div class="line">      &quot;yarn-log4j&quot; : &#123;</div><div class="line">        &quot;tag&quot; : &quot;version1&quot;,</div><div class="line">        &quot;user&quot; : &quot;admin&quot;,</div><div class="line">        &quot;version&quot; : 1</div><div class="line">      &#125;,</div><div class="line">      &quot;yarn-site&quot; : &#123;</div><div class="line">        &quot;tag&quot; : &quot;version1490254924330&quot;,</div><div class="line">        &quot;user&quot; : &quot;admin&quot;,</div><div class="line">        &quot;version&quot; : 6</div><div class="line">      &#125;,</div><div class="line">      &quot;zoo.cfg&quot; : &#123;</div><div class="line">        &quot;tag&quot; : &quot;version1&quot;,</div><div class="line">        &quot;user&quot; : &quot;admin&quot;,</div><div class="line">        &quot;version&quot; : 1</div><div class="line">      &#125;,</div><div class="line">      &quot;zookeeper-env&quot; : &#123;</div><div class="line">        &quot;tag&quot; : &quot;version1490254924765&quot;,</div><div class="line">        &quot;user&quot; : &quot;admin&quot;,</div><div class="line">        &quot;version&quot; : 2</div><div class="line">      &#125;,</div><div class="line">      &quot;zookeeper-log4j&quot; : &#123;</div><div class="line">        &quot;tag&quot; : &quot;version1&quot;,</div><div class="line">        &quot;user&quot; : &quot;admin&quot;,</div><div class="line">        &quot;version&quot; : 1</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>上面的key就对应于<code>config.sh</code> set的一些可选项,也就是CONFIG_TYPE。</p>
<p>下面列出一些常用的样例。按照amabri的惯例，每个log目录都应该是由对应的user创建并修改的。这里我们的所有机器都只有/server目录，下面并没有添加或配置log目录，试一下能不能像初始化环境的时候自动配置对应权限。一试成功了。真好，哈哈<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">./configs.sh  set 10.1.5.79 willcluster hadoop-env hdfs_log_dir_prefix &quot;/server/log/hadoop&quot;</div><div class="line">./configs.sh  set 10.1.5.79 willcluster mapred-env mapred_log_dir_prefix &quot;/server/log/hadoop-mapred&quot;</div><div class="line">./configs.sh  set 10.1.5.79 willcluster yarn-env yarn_log_dir_prefix &quot;/server/log/yarn&quot;</div><div class="line">./configs.sh  set 10.1.5.79 willcluster zookeeper-env zk_log_dir &quot;/server/log/zookeeper&quot;</div></pre></td></tr></table></figure></p>
<p>刷新amabri的UI的配置页就可以看到，对应配置已经修改成功，等待重启生效了。</p>
<p>然后tail一下各个服务对应的日志，都没有问题。</p>
<p>参考：</p>
<ul>
<li><a href="https://cwiki.apache.org/confluence/display/AMBARI/Modify+configurations" target="_blank" rel="external">https://cwiki.apache.org/confluence/display/AMBARI/Modify+configurations</a></li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    

    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/youdaonote/">youdaonote</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>





   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2017/03/30/centos7-安装k8s/" title="centos7-安装k8s" itemprop="url">centos7-安装k8s</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Will Chen" target="_blank" itemprop="author">Will Chen</a>
		
  <p class="article-time">
    <time datetime="2017-03-30T10:33:52.000Z" itemprop="datePublished"> 发表于 2017-03-30</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>代理设置<br>=<br>先弄一下代理，弄一下hosts文件，参考： <a href="https://github.com/racaljk/hosts" target="_blank" rel="external">https://github.com/racaljk/hosts</a></p>
<p>安装<br>=<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">cat &lt;&lt;EOF &gt; /etc/yum.repos.d/kubernetes.repo</div><div class="line">[kubernetes]</div><div class="line">name=Kubernetes</div><div class="line">baseurl=http://yum.kubernetes.io/repos/kubernetes-el7-x86_64</div><div class="line">enabled=1</div><div class="line">gpgcheck=1</div><div class="line">repo_gpgcheck=1</div><div class="line">gpgkey=https://packages.cloud.google.com/yum/doc/yum-key.gpg</div><div class="line">       https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg</div><div class="line">EOF</div><div class="line">setenforce 0</div><div class="line">yum install -y docker kubelet kubeadm kubectl kubernetes-cni</div><div class="line">systemctl enable docker &amp;&amp; systemctl start docker</div><div class="line">systemctl enable kubelet &amp;&amp; systemctl start kubelet</div></pre></td></tr></table></figure></p>
<p>要是安装过docker了，就不用再弄了，最好保持一致。</p>
<p>初始化<br>=<br>controller组件运行在master上，它包含etcd和API server。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">root@controller kubernetes]# kubeadm init</div><div class="line">[kubeadm] WARNING: kubeadm is in beta, please do not use it for production clusters.</div><div class="line">[init] Using Kubernetes version: v1.6.0</div><div class="line">[init] Using Authorization mode: RBAC</div><div class="line">[preflight] Running pre-flight checks</div><div class="line">[preflight] WARNING: docker version is greater than the most recently validated version. Docker version: 17.03.1-ce. Max validated version: 1.12</div><div class="line">[certificates] Generated CA certificate and key.</div><div class="line">[certificates] Generated API server certificate and key.</div><div class="line">[certificates] API Server serving cert is signed for DNS names [controller kubernetes kubernetes.default kubernetes.default.svc kubernetes.default.svc.cluster.local] and IPs [10.96.0.1 10.1.5.129]</div><div class="line">[certificates] Generated API server kubelet client certificate and key.</div><div class="line">[certificates] Generated service account token signing key and public key.</div><div class="line">[certificates] Generated front-proxy CA certificate and key.</div><div class="line">[certificates] Generated front-proxy client certificate and key.</div><div class="line">[certificates] Valid certificates and keys now exist in &quot;/etc/kubernetes/pki&quot;</div><div class="line">[kubeconfig] Wrote KubeConfig file to disk: &quot;/etc/kubernetes/kubelet.conf&quot;</div><div class="line">[kubeconfig] Wrote KubeConfig file to disk: &quot;/etc/kubernetes/controller-manager.conf&quot;</div><div class="line">[kubeconfig] Wrote KubeConfig file to disk: &quot;/etc/kubernetes/scheduler.conf&quot;</div><div class="line">[kubeconfig] Wrote KubeConfig file to disk: &quot;/etc/kubernetes/admin.conf&quot;</div><div class="line">[apiclient] Created API client, waiting for the control plane to become ready</div></pre></td></tr></table></figure>
<p>这个命令会自动探查网络接口，告诉默认的网关master所在的地址。要是想指定额外的master地址，使用参数–api-advertise-addresses <ip-address>。</ip-address></p>
<p>上面的命令也会自动下载所有的必须的镜像：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">gcr.io/google_containers/kube-proxy-amd64                v1.5.3         </div><div class="line">gcr.io/google_containers/kube-controller-manager-amd64   v1.5.3         </div><div class="line">gcr.io/google_containers/kube-scheduler-amd64            v1.5.3         </div><div class="line">gcr.io/google_containers/kube-apiserver-amd64            v1.5.3         </div><div class="line">gcr.io/google_containers/etcd-amd64                      3.0.14-kubeadm </div><div class="line">gcr.io/google_containers/kube-discovery-amd64            1.0            </div><div class="line">gcr.io/google_containers/pause-amd64                     3.0</div></pre></td></tr></table></figure></p>
<p>中间提示我/proc/sys/net/bridge/bridge-nf-call-iptables的内容不是1，看了一下是0，修改了之后可以了。</p>
<p>注意 kubeadm init 只能在你确定的master上执行一次。</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    

    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/youdaonote/">youdaonote</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>





   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2017/03/27/ambari---迁移某master-component/" title="ambari---迁移某master-component" itemprop="url">ambari---迁移某master-component</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Will Chen" target="_blank" itemprop="author">Will Chen</a>
		
  <p class="article-time">
    <time datetime="2017-03-27T06:12:55.000Z" itemprop="datePublished"> 发表于 2017-03-27</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>以AMBARI_METRICS服务的component：METRICS_COLLECTOR为例。</p>
<ol>
<li><p>停止对应service</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">curl -u admin:admin -H &quot;X-Requested-By: ambari&quot; -X PUT -d &apos;&#123;&quot;RequestInfo&quot;:&#123;&quot;context&quot;:&quot;Stop Service&quot;&#125;,&quot;Body&quot;:&#123;&quot;ServiceInfo&quot;:&#123;&quot;state&quot;:&quot;INSTALLED&quot;&#125;&#125;&#125;&apos; http://namenode01.will.com:8080/api/v1/clusters/datacenter/services/AMBARI_METRICS/</div><div class="line">`</div></pre></td></tr></table></figure>
</li>
<li><p>确认目前node上的component已经停止</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -u admin:admin -H &quot;X-Requested-By: ambari&quot; -X PUT -d &apos;&#123;&quot;RequestInfo&quot;:&#123;&quot;context&quot;:&quot;Stop Component&quot;&#125;,&quot;Body&quot;:&#123;&quot;HostRoles&quot;:&#123;&quot;state&quot;:&quot;INSTALLED&quot;&#125;&#125;&#125;&apos; http://namenode01.will.com:8080/api/v1/clusters/datacenter/hosts/datanode04.will.com/host_components/METRICS_COLLECTOR</div></pre></td></tr></table></figure>
</li>
<li><p>删除目前servcie里的component</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -i -H &quot;X-Requested-By:ambari&quot; -u admin:admin -X DELETE http://namenode01.will.com:8080/api/v1/clusters/datacenter/services/AMBARI_METRICS/components/METRICS_COLLECTOR</div></pre></td></tr></table></figure>
</li>
<li><p>在service的元数据里再加上这个component</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -i -H &quot;X-Requested-By:ambari&quot; -u admin:admin -X POST http://namenode01.will.com:8080/api/v1/clusters/datacenter/services/AMBARI_METRICS/components/METRICS_COLLECTOR</div></pre></td></tr></table></figure>
</li>
<li><p>安装component到指定node上</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -i -u admin:admin -H &quot;X-Requested-By:ambari&quot; -i -X POST -d &apos;&#123;&quot;host_components&quot; : [&#123;&quot;HostRoles&quot;:&#123;&quot;component_name&quot;:&quot;METRICS_COLLECTOR&quot;&#125;&#125;] &#125;&apos;  http://namenode01.will.com:8080/api/v1/clusters/datacenter/hosts?Hosts/host_name=datanode17.will.com</div></pre></td></tr></table></figure>
</li>
<li><p>web端，到新的node上的component点击re-install，之后重启整个service。完成</p>
</li>
</ol>
<p>ps:<br>如果没有删除干净的话，就到指定node上删除component<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -u admin:admin -H &quot;X-Requested-By: ambari&quot; -X DELETE http://namenode01.will.com:8080/api/v1/clusters/datacenter/hosts/datanode04.will.com/host_components/METRICS_COLLECTOR</div></pre></td></tr></table></figure></p>
<p>参考：</p>
<ul>
<li><a href="https://community.hortonworks.com/questions/82689/how-to-add-component-spark-jobhistoryserver-to-spa.html#answer-82695" target="_blank" rel="external">https://community.hortonworks.com/questions/82689/how-to-add-component-spark-jobhistoryserver-to-spa.html#answer-82695</a></li>
<li><a href="https://cwiki.apache.org/confluence/display/AMBARI/Using+APIs+to+delete+a+service+or+all+host+components+on+a+host" target="_blank" rel="external">https://cwiki.apache.org/confluence/display/AMBARI/Using+APIs+to+delete+a+service+or+all+host+components+on+a+host</a></li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    

    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/youdaonote/">youdaonote</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>





   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2017/03/24/iptables手记/" title="iptables手记" itemprop="url">iptables手记</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Will Chen" target="_blank" itemprop="author">Will Chen</a>
		
  <p class="article-time">
    <time datetime="2017-03-24T06:56:16.000Z" itemprop="datePublished"> 发表于 2017-03-24</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>先看一下网络流程图，以及所有的控制点<br><img src="/imgs/iptables/iptables_controls.png" alt="网络流程图"><br><img src="/imgs/iptables/iptables_control_detail.png" alt="网络流程细节图"><br><img src="/imgs/iptables/iptables_2.png" alt="控制点规则结构"><br><img src="/imgs/iptables/iptables_3_filter.png" alt="filter表相关流程与控制点图"><br><img src="/imgs/iptables/iptables_3_mangle.png" alt="mangle表相关流程与控制点"><br><img src="/imgs/iptables/iptables_3_nat.png" alt="nat表相关流程与控制点"><br><img src="/imgs/iptables/iptables_4_command.png" alt="语法结构"><br><img src="/imgs/iptables/iptables_4_command1.png" alt="语法结构"></p>
<p>查看filter表里的数据<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">[root@schedule ~]#iptables -t filter -L</div><div class="line">Chain INPUT (policy ACCEPT)</div><div class="line">target     prot opt source               destination</div><div class="line"></div><div class="line">Chain FORWARD (policy ACCEPT)</div><div class="line">target     prot opt source               destination</div><div class="line"></div><div class="line">Chain OUTPUT (policy ACCEPT)</div><div class="line">target     prot opt source               destination</div></pre></td></tr></table></figure></p>
<p>添加一条规则， 在OUTPUT上记录所有tcp的日志，默认是添加在syslog里的。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">[root@data-test03 hadoop-client]# iptables -t filter -A OUTPUT -p tcp -j LOG</div><div class="line">[root@data-test03 hadoop-client]# iptables -t filter -L</div><div class="line">Chain INPUT (policy ACCEPT)</div><div class="line">target     prot opt source               destination</div><div class="line"></div><div class="line">Chain FORWARD (policy ACCEPT)</div><div class="line">target     prot opt source               destination</div><div class="line"></div><div class="line">Chain OUTPUT (policy ACCEPT)</div><div class="line">target     prot opt source               destination</div><div class="line">LOG        tcp  --  anywhere             anywhere            LOG level warning</div></pre></td></tr></table></figure></p>
<p>找一下syslog里是否生效：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">[root@data-test03 hadoop-client]# tail -n 10 /var/log/messages</div><div class="line">Mar 23 18:30:35 data-test03 kernel: IN= OUT=eth0 SRC=10.1.5.81 DST=10.1.5.237 LEN=136 TOS=0x10 PREC=0x00 TTL=64 ID=32153 DF PROTO=TCP SPT=22 DPT=60206 WINDOW=2233 RES=0x00 ACK PSH URGP=0 </div><div class="line">Mar 23 18:30:36 data-test03 kernel: IN= OUT=eth0 SRC=10.1.5.81 DST=10.1.5.237 LEN=136 TOS=0x10 PREC=0x00 TTL=64 ID=32154 DF PROTO=TCP SPT=22 DPT=60206 WINDOW=2233 RES=0x00 ACK PSH URGP=0 </div><div class="line">Mar 23 18:30:36 data-test03 kernel: IN= OUT=eth0 SRC=10.1.5.81 DST=10.1.5.80 LEN=72 TOS=0x00 PREC=0x00 TTL=64 ID=39647 DF PROTO=TCP SPT=56998 DPT=2888 WINDOW=501 RES=0x00 ACK PSH URGP=0 </div><div class="line">Mar 23 18:30:36 data-test03 kernel: IN= OUT=lo SRC=10.1.5.81 DST=10.1.5.81 LEN=228 TOS=0x00 PREC=0x00 TTL=64 ID=42802 DF PROTO=TCP SPT=36920 DPT=8025 WINDOW=265 RES=0x00 ACK PSH URGP=0 </div><div class="line">Mar 23 18:30:36 data-test03 kernel: IN= OUT=lo SRC=10.1.5.81 DST=10.1.5.81 LEN=93 TOS=0x00 PREC=0x00 TTL=64 ID=14446 DF PROTO=TCP SPT=8025 DPT=36920 WINDOW=384 RES=0x00 ACK PSH URGP=0 </div><div class="line">Mar 23 18:30:36 data-test03 kernel: IN= OUT=lo SRC=10.1.5.81 DST=10.1.5.81 LEN=52 TOS=0x00 PREC=0x00 TTL=64 ID=42803 DF PROTO=TCP SPT=36920 DPT=8025 WINDOW=265 RES=0x00 ACK URGP=0 </div><div class="line">Mar 23 18:30:36 data-test03 kernel: IN= OUT=eth0 SRC=10.1.5.81 DST=10.1.5.237 LEN=136 TOS=0x10 PREC=0x00 TTL=64 ID=32155 DF PROTO=TCP SPT=22 DPT=60206 WINDOW=2233 RES=0x00 ACK PSH URGP=0 </div><div class="line">Mar 23 18:30:36 data-test03 kernel: IN= OUT=eth0 SRC=10.1.5.81 DST=10.1.5.80 LEN=93 TOS=0x00 PREC=0x00 TTL=64 ID=13946 DF PROTO=TCP SPT=8025 DPT=38421 WINDOW=499 RES=0x00 ACK PSH URGP=0 </div><div class="line">Mar 23 18:30:36 data-test03 kernel: IN= OUT=eth0 SRC=10.1.5.81 DST=10.1.5.79 LEN=93 TOS=0x00 PREC=0x00 TTL=64 ID=15862 DF PROTO=TCP SPT=8025 DPT=37458 WINDOW=499 RES=0x00 ACK PSH URGP=0 </div><div class="line">Mar 23 18:30:36 data-test03 kernel: IN= OUT=eth0 SRC=10.1.5.81 DST=10.1.5.237 LEN=104 TOS=0x10 PREC=0x00 TTL=64 ID=32156 DF PROTO=TCP SPT=22 DPT=60206 WINDOW=2233 RES=0x00 ACK PSH URGP=0</div></pre></td></tr></table></figure></p>
<p>为日志添加前缀<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">iptables -t filter -A OUTPUT -p tcp -j LOG --log-prefix will</div></pre></td></tr></table></figure></p>
<p>再看log<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[root@data-test03 hadoop-client]# tail -n 5 /var/log/messages</div><div class="line">Mar 23 18:33:58 data-test03 kernel: willIN= OUT=eth0 SRC=10.1.5.81 DST=10.1.5.80 LEN=72 TOS=0x00 PREC=0x00 TTL=64 ID=39849 DF PROTO=TCP SPT=56998 DPT=2888 WINDOW=501 RES=0x00 ACK PSH URGP=0 </div><div class="line">Mar 23 18:33:58 data-test03 kernel: willIN= OUT=lo SRC=10.1.5.81 DST=10.1.5.81 LEN=228 TOS=0x00 PREC=0x00 TTL=64 ID=43206 DF PROTO=TCP SPT=36920 DPT=8025 WINDOW=265 RES=0x00 ACK PSH URGP=0 </div><div class="line">Mar 23 18:33:58 data-test03 kernel: willIN= OUT=lo SRC=10.1.5.81 DST=10.1.5.81 LEN=93 TOS=0x00 PREC=0x00 TTL=64 ID=14648 DF PROTO=TCP SPT=8025 DPT=36920 WINDOW=384 RES=0x00 ACK PSH URGP=0 </div><div class="line">Mar 23 18:33:58 data-test03 kernel: willIN= OUT=lo SRC=10.1.5.81 DST=10.1.5.81 LEN=52 TOS=0x00 PREC=0x00 TTL=64 ID=43207 DF PROTO=TCP SPT=36920 DPT=8025 WINDOW=265 RES=0x00 ACK URGP=0 </div><div class="line">Mar 23 18:33:58 data-test03 kernel: willIN= OUT=eth0 SRC=10.1.5.81 DST=10.1.5.237 LEN=136 TOS=0x10 PREC=0x00 TTL=64 ID=34907 DF PROTO=TCP SPT=22 DPT=60206 WINDOW=2233 RES=0x00 ACK PSH URGP=0</div></pre></td></tr></table></figure></p>
<p>命令规范：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">iptables -t 表 操作 5个控制点之一 匹配规则 -j 动作 动作的选项</div></pre></td></tr></table></figure></p>
<p>拒绝79对于8020端口的请求<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">iptables -t filter -A INPUT -p tcp --dport 8020 -s 10.1.5.79 -j REJECT</div></pre></td></tr></table></figure></p>
<p>匹配包含：基本匹配、隐世匹配、等。</p>
<p>拒绝79所有请求, 第二条是给一个拒绝原因，顺序执行，如果一起都有的话，只执行第一条动作<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">iptables -t filter -A INPUT -s 10.1.5.79 -j REJECT</div><div class="line">iptables -t filter -A INPUT -s 10.1.5.79 -j REJECT --reject-with tcp-reset</div></pre></td></tr></table></figure></p>
<p>这样就连ping都ping不通了。</p>
<p><a href="http://blog.csdn.net/czhphp/article/details/19123673" target="_blank" rel="external">网段知识补充</a></p>
<p>参考：</p>
<ul>
<li><a href="http://www.cnblogs.com/yi-meng/p/3213925.html" target="_blank" rel="external">http://www.cnblogs.com/yi-meng/p/3213925.html</a></li>
<li><a href="http://www.dabu.info/iptables-based-tutorial-grammar-rules.html" target="_blank" rel="external">http://www.dabu.info/iptables-based-tutorial-grammar-rules.html</a></li>
<li><a href="http://v.youku.com/v_show/id_XNzIxOTAxODky.html?from=s1.8-1-1.2&amp;spm=a2h0k.8191407.0.0" target="_blank" rel="external">http://v.youku.com/v_show/id_XNzIxOTAxODky.html?from=s1.8-1-1.2&amp;spm=a2h0k.8191407.0.0</a></li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    

    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/iptables/">iptables</a><a href="/tags/linux/">linux</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>





   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2017/03/23/iptables/" title="iptables" itemprop="url">iptables</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Will Chen" target="_blank" itemprop="author">Will Chen</a>
		
  <p class="article-time">
    <time datetime="2017-03-23T09:26:37.000Z" itemprop="datePublished"> 发表于 2017-03-23</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>查看filter表里的数据<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">[root@schedule ~]#iptables -t filter -L</div><div class="line">Chain INPUT (policy ACCEPT)</div><div class="line">target     prot opt source               destination         </div><div class="line"></div><div class="line">Chain FORWARD (policy ACCEPT)</div><div class="line">target     prot opt source               destination         </div><div class="line"></div><div class="line">Chain OUTPUT (policy ACCEPT)</div><div class="line">target     prot opt source               destination</div></pre></td></tr></table></figure></p>
<p>添加一条规则， 在OUTPUT上记录所有tcp的日志，默认是添加在syslog里的。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">[root@data-test03 hadoop-client]# iptables -t filter -A OUTPUT -p tcp -j LOG</div><div class="line">[root@data-test03 hadoop-client]# iptables -t filter -L</div><div class="line">Chain INPUT (policy ACCEPT)</div><div class="line">target     prot opt source               destination         </div><div class="line"></div><div class="line">Chain FORWARD (policy ACCEPT)</div><div class="line">target     prot opt source               destination         </div><div class="line"></div><div class="line">Chain OUTPUT (policy ACCEPT)</div><div class="line">target     prot opt source               destination         </div><div class="line">LOG        tcp  --  anywhere             anywhere            LOG level warning</div></pre></td></tr></table></figure></p>
<p>找一下syslog里是否生效：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">[root@data-test03 hadoop-client]# tail -n 10 /var/log/messages</div><div class="line">Mar 23 18:30:35 data-test03 kernel: IN= OUT=eth0 SRC=10.1.5.81 DST=10.1.5.237 LEN=136 TOS=0x10 PREC=0x00 TTL=64 ID=32153 DF PROTO=TCP SPT=22 DPT=60206 WINDOW=2233 RES=0x00 ACK PSH URGP=0 </div><div class="line">Mar 23 18:30:36 data-test03 kernel: IN= OUT=eth0 SRC=10.1.5.81 DST=10.1.5.237 LEN=136 TOS=0x10 PREC=0x00 TTL=64 ID=32154 DF PROTO=TCP SPT=22 DPT=60206 WINDOW=2233 RES=0x00 ACK PSH URGP=0 </div><div class="line">Mar 23 18:30:36 data-test03 kernel: IN= OUT=eth0 SRC=10.1.5.81 DST=10.1.5.80 LEN=72 TOS=0x00 PREC=0x00 TTL=64 ID=39647 DF PROTO=TCP SPT=56998 DPT=2888 WINDOW=501 RES=0x00 ACK PSH URGP=0 </div><div class="line">Mar 23 18:30:36 data-test03 kernel: IN= OUT=lo SRC=10.1.5.81 DST=10.1.5.81 LEN=228 TOS=0x00 PREC=0x00 TTL=64 ID=42802 DF PROTO=TCP SPT=36920 DPT=8025 WINDOW=265 RES=0x00 ACK PSH URGP=0 </div><div class="line">Mar 23 18:30:36 data-test03 kernel: IN= OUT=lo SRC=10.1.5.81 DST=10.1.5.81 LEN=93 TOS=0x00 PREC=0x00 TTL=64 ID=14446 DF PROTO=TCP SPT=8025 DPT=36920 WINDOW=384 RES=0x00 ACK PSH URGP=0 </div><div class="line">Mar 23 18:30:36 data-test03 kernel: IN= OUT=lo SRC=10.1.5.81 DST=10.1.5.81 LEN=52 TOS=0x00 PREC=0x00 TTL=64 ID=42803 DF PROTO=TCP SPT=36920 DPT=8025 WINDOW=265 RES=0x00 ACK URGP=0 </div><div class="line">Mar 23 18:30:36 data-test03 kernel: IN= OUT=eth0 SRC=10.1.5.81 DST=10.1.5.237 LEN=136 TOS=0x10 PREC=0x00 TTL=64 ID=32155 DF PROTO=TCP SPT=22 DPT=60206 WINDOW=2233 RES=0x00 ACK PSH URGP=0 </div><div class="line">Mar 23 18:30:36 data-test03 kernel: IN= OUT=eth0 SRC=10.1.5.81 DST=10.1.5.80 LEN=93 TOS=0x00 PREC=0x00 TTL=64 ID=13946 DF PROTO=TCP SPT=8025 DPT=38421 WINDOW=499 RES=0x00 ACK PSH URGP=0 </div><div class="line">Mar 23 18:30:36 data-test03 kernel: IN= OUT=eth0 SRC=10.1.5.81 DST=10.1.5.79 LEN=93 TOS=0x00 PREC=0x00 TTL=64 ID=15862 DF PROTO=TCP SPT=8025 DPT=37458 WINDOW=499 RES=0x00 ACK PSH URGP=0 </div><div class="line">Mar 23 18:30:36 data-test03 kernel: IN= OUT=eth0 SRC=10.1.5.81 DST=10.1.5.237 LEN=104 TOS=0x10 PREC=0x00 TTL=64 ID=32156 DF PROTO=TCP SPT=22 DPT=60206 WINDOW=2233 RES=0x00 ACK PSH URGP=0</div></pre></td></tr></table></figure></p>
<p>为日志添加前缀<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">iptables -t filter -A OUTPUT -p tcp -j LOG --log-prefix will</div></pre></td></tr></table></figure></p>
<p>再看log<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[root@data-test03 hadoop-client]# tail -n 5 /var/log/messages</div><div class="line">Mar 23 18:33:58 data-test03 kernel: willIN= OUT=eth0 SRC=10.1.5.81 DST=10.1.5.80 LEN=72 TOS=0x00 PREC=0x00 TTL=64 ID=39849 DF PROTO=TCP SPT=56998 DPT=2888 WINDOW=501 RES=0x00 ACK PSH URGP=0 </div><div class="line">Mar 23 18:33:58 data-test03 kernel: willIN= OUT=lo SRC=10.1.5.81 DST=10.1.5.81 LEN=228 TOS=0x00 PREC=0x00 TTL=64 ID=43206 DF PROTO=TCP SPT=36920 DPT=8025 WINDOW=265 RES=0x00 ACK PSH URGP=0 </div><div class="line">Mar 23 18:33:58 data-test03 kernel: willIN= OUT=lo SRC=10.1.5.81 DST=10.1.5.81 LEN=93 TOS=0x00 PREC=0x00 TTL=64 ID=14648 DF PROTO=TCP SPT=8025 DPT=36920 WINDOW=384 RES=0x00 ACK PSH URGP=0 </div><div class="line">Mar 23 18:33:58 data-test03 kernel: willIN= OUT=lo SRC=10.1.5.81 DST=10.1.5.81 LEN=52 TOS=0x00 PREC=0x00 TTL=64 ID=43207 DF PROTO=TCP SPT=36920 DPT=8025 WINDOW=265 RES=0x00 ACK URGP=0 </div><div class="line">Mar 23 18:33:58 data-test03 kernel: willIN= OUT=eth0 SRC=10.1.5.81 DST=10.1.5.237 LEN=136 TOS=0x10 PREC=0x00 TTL=64 ID=34907 DF PROTO=TCP SPT=22 DPT=60206 WINDOW=2233 RES=0x00 ACK PSH URGP=0</div></pre></td></tr></table></figure></p>
<p>命令规范：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">iptables -t 表 操作 5个控制点之一 匹配规则 -j 动作 动作的选项</div></pre></td></tr></table></figure></p>
<p>拒绝79对于8020端口的请求<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">iptables -t filter -A INPUT -p tcp --dport 8020 -s 10.1.5.79 -j REJECT</div></pre></td></tr></table></figure></p>
<p>匹配包含：基本匹配、隐世匹配、等。</p>
<p>拒绝79所有请求, 第二条是给一个拒绝原因，顺序执行，如果一起都有的话，优先执行第一条动作<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">iptables -t filter -A INPUT -s 10.1.5.79 -j REJECT</div><div class="line">iptables -t filter -A INPUT -s 10.1.5.79 -j REJECT --reject-with tcp-reset</div></pre></td></tr></table></figure></p>
<p>这样就连ping都ping不通了。</p>
<p>插入到第三行：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">iptables -t filter -I INPUT 3 -p tcp -s 10.1.5.237 -j ACCEPT</div></pre></td></tr></table></figure></p>
<p>删除第3行的规则：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">iptables -t filter -D INPUT 3</div></pre></td></tr></table></figure></p>
<p><a href="http://blog.csdn.net/czhphp/article/details/19123673" target="_blank" rel="external">网段知识补充</a></p>
<p>参考：</p>
<ul>
<li><a href="http://www.cnblogs.com/yi-meng/p/3213925.html" target="_blank" rel="external">http://www.cnblogs.com/yi-meng/p/3213925.html</a></li>
<li><a href="http://www.dabu.info/iptables-based-tutorial-grammar-rules.html" target="_blank" rel="external">http://www.dabu.info/iptables-based-tutorial-grammar-rules.html</a></li>
<li><a href="http://v.youku.com/v_show/id_XNzIxOTAxODky.html?from=s1.8-1-1.2&amp;spm=a2h0k.8191407.0.0" target="_blank" rel="external">http://v.youku.com/v_show/id_XNzIxOTAxODky.html?from=s1.8-1-1.2&amp;spm=a2h0k.8191407.0.0</a></li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    

    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/youdaonote/">youdaonote</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






  <nav id="page-nav" class="clearfix">
    <a class="extend prev" rel="prev" href="/page/13/"><span></span>Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/12/">12</a><a class="page-number" href="/page/13/">13</a><span class="page-number current">14</span><a class="page-number" href="/page/15/">15</a><a class="page-number" href="/page/16/">16</a><span class="space">&hellip;</span><a class="page-number" href="/page/27/">27</a><a class="extend next" rel="next" href="/page/15/">Next<span></span></a>
  </nav>

</div>
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  


  

  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/youdaonote/" title="youdaonote">youdaonote<sup>209</sup></a></li>
			
		
			
				<li><a href="/tags/源码/" title="源码">源码<sup>10</sup></a></li>
			
		
			
				<li><a href="/tags/akka/" title="akka">akka<sup>9</sup></a></li>
			
		
			
				<li><a href="/tags/flume/" title="flume">flume<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/ETL/" title="ETL">ETL<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/solr/" title="solr">solr<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/spring/" title="spring">spring<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/调度平台/" title="调度平台">调度平台<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/azkaban/" title="azkaban">azkaban<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/mysql/" title="mysql">mysql<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/scala/" title="scala">scala<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/ambari/" title="ambari">ambari<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/quartz/" title="quartz">quartz<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/python/" title="python">python<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/ember/" title="ember">ember<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/nodejs/" title="nodejs">nodejs<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/R/" title="R">R<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/guava/" title="guava">guava<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/heroku/" title="heroku">heroku<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/hdfs/" title="hdfs">hdfs<sup>1</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
          <li>
            
            	<a href="https://github.com/willcup" target="_blank" title=" 我自己的github">github</a>
            
          </li>
        
          <li>
            
            	<a href="http://thisding.com" target="_blank" title="朋友的主页">Steven&#39;s Blog</a>
            
          </li>
        
    </ul>
</div>

  


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

  <div class="weiboshow">
  <p class="asidetitle">新浪微博</p>
    <iframe width="100%" height="119" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=119&fansRow=2&ptype=1&speed=0&skin=9&isTitle=1&noborder=1&isWeibo=0&isFans=0&uid=null&verifier=&dpc=1"></iframe>
</div>


</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello ,I&#39;m Will Chen in MeiTuan. <br/>
			元 亨 利 贞.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		
		
		
		
		
		
		
		
		
		<a href="mailto:chenxin15@meituan.com" target="_blank" class="icon-email" title="Email Me"></a>
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2017 
		
		<a href="/about" target="_blank" title="Will Chen">Will Chen</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
        
    }
  });
});
</script>










<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3Fe6d1f421bbc9962127a50488f9ed37d1' type='text/javascript'%3E%3C/script%3E"));
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
 </html>
