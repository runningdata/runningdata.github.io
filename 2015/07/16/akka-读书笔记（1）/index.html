
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <script type="text/javascript">
    (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
    (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
    e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
    })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');
    
    _st('install','yNiKTKaAnwd1uuxVMfiE','2.0.0');
  </script>
  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?5b99dfd487346155d274c0c49c3fb869";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
  </script>

  
    <title>akka in action 读书笔记（1） | Will&#39;s Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="Will Chen">
    

    
    <meta name="description" content="什么是AKKAakka：

并行处理请求
和service与client进行并发交互
异步响应
事件驱动编程模型

akka是被设计为一个工具而不是一个框架。框架是一个栈的某个独立的元素【比如UI层、web层等】，而akka可以用于这个栈中的任何部分，也可以为这些部分之间提供连接。akka的每个module是由jar包组成的，已经尽量较少了各个jar之间的耦合，甚至akka-actor除了scal">
<meta property="og:type" content="article">
<meta property="og:title" content="akka in action 读书笔记（1）">
<meta property="og:url" content="https://runningdata.github.io/2015/07/16/akka-读书笔记（1）/index.html">
<meta property="og:site_name" content="Will's Blog">
<meta property="og:description" content="什么是AKKAakka：

并行处理请求
和service与client进行并发交互
异步响应
事件驱动编程模型

akka是被设计为一个工具而不是一个框架。框架是一个栈的某个独立的元素【比如UI层、web层等】，而akka可以用于这个栈中的任何部分，也可以为这些部分之间提供连接。akka的每个module是由jar包组成的，已经尽量较少了各个jar之间的耦合，甚至akka-actor除了scal">
<meta property="og:image" content="https://runningdata.github.io/imgs/akka/akka1.1.png">
<meta property="og:image" content="https://runningdata.github.io/imgs/akka/akka1.2.png">
<meta property="og:image" content="https://runningdata.github.io/imgs/akka/akka1.3.png">
<meta property="og:image" content="https://runningdata.github.io/imgs/akka/akka1.4.png">
<meta property="og:image" content="https://runningdata.github.io/imgs/akka/akka1.5.png">
<meta property="og:image" content="https://runningdata.github.io/imgs/akka/akka1.6.png">
<meta property="og:image" content="https://runningdata.github.io/imgs/akka/akka1.7.png">
<meta property="og:image" content="https://runningdata.github.io/imgs/akka/akka1.8.png">
<meta property="og:image" content="https://runningdata.github.io/imgs/akka/akka1.9.png">
<meta property="og:image" content="https://runningdata.github.io/imgs/akka/akka1.10.png">
<meta property="og:image" content="https://runningdata.github.io/imgs/akka/akka1.11.png">
<meta property="og:updated_time" content="2017-12-27T13:39:20.401Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="akka in action 读书笔记（1）">
<meta name="twitter:description" content="什么是AKKAakka：

并行处理请求
和service与client进行并发交互
异步响应
事件驱动编程模型

akka是被设计为一个工具而不是一个框架。框架是一个栈的某个独立的元素【比如UI层、web层等】，而akka可以用于这个栈中的任何部分，也可以为这些部分之间提供连接。akka的每个module是由jar包组成的，已经尽量较少了各个jar之间的耦合，甚至akka-actor除了scal">
<meta name="twitter:image" content="https://runningdata.github.io/imgs/akka/akka1.1.png">

    
    <link rel="alternative" href="/atom.xml" title="Will&#39;s Blog" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="Will&#39;s Blog" title="Will&#39;s Blog"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Will&#39;s Blog">Will&#39;s Blog</a></h1>
				<h2 class="blog-motto">简易 变易 不易</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">首页</a></li>
					
						<li><a href="/archives">归档</a></li>
					
						<li><a href="/about">关于</a></li>
					
					<li>
 					
                                                <form class="search" action="/search/index.html" method="get" accept-charset="utf-8" target="_blank">
                                                        <label>搜索</label>
                                                <input name="s" type="hidden" value= null ><input type="text" name="q" size="30" placeholder="搜索"><br>
                                                </form>
					
					</li>
				</ul>
			</nav>			
</div>

    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/07/16/akka-读书笔记（1）/" title="akka in action 读书笔记（1）" itemprop="url">akka in action 读书笔记（1）</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Will Chen" target="_blank" itemprop="author">Will Chen</a>
		
  <p class="article-time">
    <time datetime="2015-07-15T18:45:52.000Z" itemprop="datePublished"> 发表于 2015-07-16</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		
			<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#什么是AKKA"><span class="toc-text">什么是AKKA</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#并发"><span class="toc-text">并发</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#方案1：共享状态"><span class="toc-text">方案1：共享状态</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#方案2：消息驱动"><span class="toc-text">方案2：消息驱动</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#容灾"><span class="toc-text">容灾</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#scale-up-and-out"><span class="toc-text">scale up and out</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#scale-out"><span class="toc-text">scale out</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#scale-up"><span class="toc-text">scale up</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Akka-Actor-和-AkkaSystem"><span class="toc-text">Akka Actor 和 AkkaSystem</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#总结"><span class="toc-text">总结</span></a></li></ol>
		
		</div>
		
		<h2 id="什么是AKKA"><a href="#什么是AKKA" class="headerlink" title="什么是AKKA"></a>什么是AKKA</h2><p>akka：</p>
<ul>
<li>并行处理请求</li>
<li>和service与client进行并发交互</li>
<li>异步响应</li>
<li>事件驱动编程模型</li>
</ul>
<p>akka是被设计为一个工具而不是一个框架。框架是一个栈的某个独立的元素【比如UI层、web层等】，而akka可以用于这个栈中的任何部分，也可以为这些部分之间提供连接。<br>akka的每个module是由jar包组成的，已经尽量较少了各个jar之间的耦合，甚至akka-actor除了scala标准包没有任何其他依赖。另外akka还提供了一些集成其他组件(例如camel, zeromq等)的module。下图是akka技术栈的主要组件，也解释了client如果省去一些细节麻烦：<br><img src="/imgs/akka/akka1.1.png" alt="Figure 1.1 The Akka Stack"></p>
<p>akka自身提供运行时环境，有一个很小的叫做play mini的内核，可以做的事情简直让你叹为观止。akka应用主要是由actor组成，基于actor编程模型，借鉴自函数式编程语言ERLANG和Fanton。</p>
<hr>
<h3 id="并发"><a href="#并发" class="headerlink" title="并发"></a>并发</h3><p>问题：<br>考虑一个卖票的程序，如果一百万人同时向100个售票处买票，但是只有一个地方打印票。<br><img src="/imgs/akka/akka1.2.png" alt="Figure 1.2 Buying Tickets"></p>
<p><img src="/imgs/akka/akka1.3.png" alt="Figure 1.3 买票人、售票处、打印中心的关系"></p>
<p>面对以上问题，好多TicketingAgents都互相竞争，抢用打印机资源。解决方案有两个。对于一个基于线程的程序来说，最简单的实现就是为每个request直接fork一个线程，这简直就是灾难性的。就算是线程池的话，也可能每个请求都花比较长的时间而造成timeout，客户端还是会失败。另外，如果几个线程互相争抢并修改公用的资源同样会造成不良后果。</p>
<h5 id="方案1：共享状态"><a href="#方案1：共享状态" class="headerlink" title="方案1：共享状态"></a>方案1：共享状态</h5><p>看下图：</p>
<p><img src="/imgs/akka/akka1.4.png" alt="Figure 1.4 Buying sequence 买票人排队等待"><br>TicketingAgent取走一张票，然后告诉printing office打印。如果不能打印的话，就到3c，也就是卖完了。</p>
<p>这样，我们不必费力地控制Agent之间对Ticket的竞争。You can see, we didn’t have to go to great lengths to keep the Agents from blocking each other’s access to Tickets, and the result is also a bit clearer than what we would probably end up with if someone came in later and rewrote the selling sequence to make it concurrent.</p>
<p>使用线程的话有三个原因可能导致灾难性失败：</p>
<ul>
<li>thread starvation 当所有的线程都很忙或者都死锁了，无暇顾及新request的时候，都可能导致server关闭</li>
<li>race conditions 当某个共享资源被多个线程同时修改，可能会产生混乱，产生意想不到的结果</li>
<li>deadlock</li>
</ul>
<p>即便你避免了以上所有问题，就这些避免的措施也够让人头疼的。锁控制的边界不是太大就是太小。使用过多的锁，其实实际上的并发就会少了特别特别多。使用的锁不够多，就可能遇到各种各样的bug。掌握一个好的平衡点是很困难的事情。</p>
<p>TicketAgent们都得互相等待，这些TicketAgent的客户就也得等待。TicketAgent A的客户需要等着TicketAgent B的某个客户，听上去有点儿奇怪，有些等待的时间并没有那么必要。</p>
<h5 id="方案2：消息驱动"><a href="#方案2：消息驱动" class="headerlink" title="方案2：消息驱动"></a>方案2：消息驱动</h5><p>我们使用AKKA使得事情变简单的根源在于我们<code>避免使用共享状态</code>。我们必须改变以下三个方面：</p>
<ul>
<li>event和ticket在售票处和打印室中间以不可变的消息状态传递</li>
<li>售票处的打印请求被打印室异步放入队列，不用等待打印方法完成或者接受确认</li>
<li><p>售票处和打印室相互之间不是直接使用相互的引用，而是记录联系对方的地址，他们之间通过相互传递message来进行通讯，这些message暂时被放置于一个mailbox中，后面会被按照放入的次序被处理掉。</p>
<p>当然，有些新的问题也会出现：TicketAgents在卖光自己的票以后需要有一种方式获取更多的票供给。这很重要，我们使用传递不可变message的方式完成了这项工作，我们不必担心app是否能够承担住激增的请求。下图是修改后的顺序图：</p>
<p><img src="/imgs/akka/akka1.5.png" alt="Figure 1.5 TicketingAgent sequence 售票处排队等待"> </p>
</li>
</ul>
<p>那么售票处具体怎么拿到票呢？打印室会给每个售票处发送取票信息，每个Event都会包含N多票和这个Event的状态信息。有很多种方式发送message给所有的售票处，这里我们使用的是让售票处之间相互传递的方式。售票处们也都知道各自的位置，会传达给目标(我们会在akka中常常见到chain的形式，从简单的传递工作状态到分布式的基于actor的责任链设计模式)<br><img src="/imgs/akka/akka1.6.png" alt="Figure 1.6 Distributing tickets"><br>如果一个售票处取了event中的属于自己的票后还有剩余的，就继续传递下去，代表还有其他售票处没有拿到应得的票。如果所有的售票处都看过这个event了，一段时间后仍然没人认领，那就让这些票过期。</p>
<p>基于消息传递的模式有两个好处，一个是不用管任何锁，另外售票处也不用干等着response，也就是打印的票完成，再去处理下一个，现在打印室打印完了会通知售票处取票。即便打印室器材坏了，售票处仍然可以继续卖票，只要把新的打印室的地址标成原来打印室的地址即可。</p>
<p>这种方式其实就是典型的AKKA实现。TicketingAgent和打印室都可以通过AKKA Actor实现。Actor之间不共享状态，只能通过不可变的message进行通信，通过actorRef来进行交流，就像上面提到的地址。这种模型满足了我们上面提到的三处改变。那么它简单到了哪里呢？</p>
<ul>
<li>不用管理锁，不用为保护共享状态殚精竭虑</li>
<li><p>不用担心死锁、race condition、或者thread starvation。</p>
<p> 那么akka中就永远不会面临锁了么？当然不是的，只是你不用直接面对它而已。归根到底所有东西都是运行在线程和低级并发原始变量上的。Akka使用java的concurrent库来协调处理message，尽少地使用锁。</p>
</li>
</ul>
<hr>
<h3 id="容灾"><a href="#容灾" class="headerlink" title="容灾"></a>容灾</h3><p>基于message的方式可以允许在系统部分失灵的情况下保证系统继续有效运行。原因之一就是独立性，<strong>每个actor并不直接进行相互之间的交互</strong>。message是被发送到mailbox里的，爱谁处理谁处理，爱咋处理咋处理，sender发完就完事儿了。同样的事儿对于调用对象方法就行不通了。</p>
<p><img src="/imgs/akka/akka1.7.png" alt="Figure 1.7 Message Passing vs. Function Calling 消息传递与方法调用流程对比"></p>
<p>独立性还带来了另外的好处。如果某个actor挂了，他的地址被另一个actor所替代，会怎样呢？只要原来的actor被新的actor正确替换了，那么所有这个地址上的message都会被归到新actor名下。错误会被包含在处理不恰当的老的actor中，而新actor只要处理之后产生的message就可以了。（在这种方式下，出错的老actor在抛出异常后就不能继续处理message了，它要<strong>自杀然后魂飞魄散</strong>）。类似Sping的这些框架在container/bean级别做了这些处理，而akka是在运行时提供的可替代性(这就是actor的let it crash思想):<strong>我们事先就做好了准备，一旦某个handler会因为某些莫须有的理由处理不好他们的任务，这时就把它的任务交给别人来避免灾难性的失败</strong>。</p>
<p>需要注意的是：这是双向的。即便是上层失败了，那么下层可以继续工作直到新的领导人来接替工作。<strong>不会有断裂的chain</strong>，开发者不用关心任何chain可能会断裂的可能性，当然也不用针对每个可能性采取相应措施。一个失败的actor被替换的过程不会影响到任何其他的合作者，见下图</p>
<p><img src="/imgs/akka/akka1.8.png" alt="Figure 1.8 Replacing a crashed printing office"><br>以上这种方案是akka中对于容错的一种方案<strong>Restart</strong> strategies,其他方案包括：<strong>Resume</strong>, <strong>Stop</strong>以及<strong>Escalate</strong>.Akka提供了选择容错方案的方法。akka控制所有的actors处理message的方式，它知道所有actor的地址，如果有异常发生，就检查一下针对这种异常应该采取怎样的容错策略并执行之。</p>
<p>容错并不意味着对所有的错误全部都完全恢复。<strong>容错系统只是保证系统在部分失灵的情况下能够依然运行</strong>。不同的错误有不同的处理策略，有的错误需要重启部分系统，有的错误或许在检查点不能处理需要上级帮忙….后面我们可以关注一下Akka怎样通过Supervision来处理这些案例。</p>
<p>拿个简单的异常处理来说，一般的程序遇到异常肯定要停下正在处理的工作，处理这个异常或者抛给上级。对于线程组之间肯定是不能共享某个异常的，除非你自己写一个这样的底层机制。异常不会被传 到产生它的线程的线程组之外，也就是说我们必须找到在不同线程组之间交流异常的其他方式。一般来说如果一个线程遇到异常基本都是忽视继续执行或者直接停止。或许你可以在log里找到一些证据证明某个thread挂掉或者停止了，但是让系统的其他部分知道这些却是比较难了。当这些线程再分不到不同的机器上的时候，事情变得更加棘手。Akka提供了一种模型来处理错误，不管actor分布在多少机器。<strong>Akka不仅仅可以很好的处理并发，对于容错同样也很在行!</strong></p>
<hr>
<h3 id="scale-up-and-out"><a href="#scale-up-and-out" class="headerlink" title="scale up and out"></a>scale up and out</h3><p>scale up :在一个server上运行更多的TicketingAgent<br>scale out : 在更多的server上运行TicketingAgent</p>
<h4 id="scale-out"><a href="#scale-out" class="headerlink" title="scale out"></a>scale out</h4><p>我们前面都是在一个JVM上运行的agent的例子。我们这次来看看怎样在多台机器上运行。<br>message的传递是通过地址来进行的，我们只需要改变地址链接actor的方式就可以了。</p>
<p><img src="/imgs/akka/akka1.9.png" alt="Figure 1.9 Transparent Remote Actors (through Proxies)"></p>
<p>akka可以给一个位于remote server上的remote actor发送message，然后再通过网络把处理结果传递回来。TicketingAgent并不知道它在命令一个远程的打印室。其实在同一个jvm运行的内存实例也是基本一致的。唯一不一样的地方就是怎样找到remote actor reference，这<strong>只要通过配置文件</strong>就可以了。也就是说，<strong>不用改变任何代码</strong>我们就可以吧scale out切换为scale up。在akka中灵活改变actor地址是非常常见的。remote actor, 集群化甚至测试工具，都会用到。</p>
<p>同样的情况，对于共享可变状态的情形可就惨了，最常见的方案就是把JVM里的状态都push到一个db里去。最大的威胁是在不得不更多地联系控制的需求下，这个db会变得越来越牛逼，而中间层就鸡肋了：所有的class都是DTO或者无状态无实际操作的东西。最让人头痛的就是当需要更多复杂的处理的时候，db同样也要面临这些改变，这将是灾难性的。还有，系统的透明度也很重要。我们希望能够很容易地追踪flow的执行进度，而不是使用精心制作的控制机制处理一片片交织在一起的复杂行为。</p>
<p>好了，贬低完了共享可变状态的不好，来看看我们牛逼的akka，你可以使用精心制作的控制系统来将错综复杂的处理逻辑不定转化为操作流。在某些架构中，message queue和web service会组合起来防止这些，但其实就是一种类似akka的模型。Akka帮我们省去了很多共享可变资源的麻烦，基于message模式，而且还可以基于同一段代码同时实现scale up和scale out。</p>
<h4 id="scale-up"><a href="#scale-up" class="headerlink" title="scale up"></a>scale up</h4><p>如果我们只想在一个机器上提升性能并scale up呢？假设我为机器新增加了几个cpu核数。在共享可变资源的情况下就是添加线程数了。但是我们都知道，锁会导致资源争夺，就是说工作的线程数总是少于总数，因为有些线程不得不相互等待。尽量少共享就是说尽量少玩儿锁，这就是message机制的目的。使用message机制可以使用更少的线程，只要优化一下处理流程和message分发，性能还胜过使用锁。<strong>每个线程都有一个用来存储运行时数据的栈</strong>。不同的操作系统的栈的大小是不一样的，比如Linux 64位的一般是256K。<strong>栈的大小是影响同时运行在某个server上线程数量的因素之一</strong>。在Linux 64系统上大约4096个线程会用掉1G的内存。</p>
<p>actor运行在一个叫做dispatcher的抽象概念上，dispatcher关注使用哪个线程模型，还有处理mailbox里的message。跟线程池处理方式很像，只是线程池只管调度，而Akka的dispatcher/mailbox结合体处理并传递message。我们可以通过配置层指定dispatch策略，<strong>不用修改任何代码</strong>。</p>
<p>actor是轻量的，因为他们运行于dispatcher之上，actor的数量不一定要跟线程数量成正比。actor比thread占用的空间要小得多，1G内存大约可以有270万个actor。针对不用的需求，有多种类型的dispatcher可选。actor之间可以共享同一个dispatcher，也可以自己有自己的。在调整性能的时候，可以通过配置灵活进行。</p>
<p>既然我们已经了解了基于message实现的并发、容错、扩展。是时候看一下akka里的具体组件了，还要了解这些组件是如果协同工作的。</p>
<h2 id="Akka-Actor-和-AkkaSystem"><a href="#Akka-Actor-和-AkkaSystem" class="headerlink" title="Akka Actor 和 AkkaSystem"></a>Akka Actor 和 AkkaSystem</h2><p>前面已经讨论了几个akka的主要概念：</p>
<ul>
<li>actor的地址是提供一个方向</li>
<li>mailbox用来临时保存message和actor自身</li>
</ul>
<p>我们下面讨论一下这些组件是怎样有机结合起来，解释一下akka底层的线程机制，并且解释一下akka怎样运行在这样的一套机制之下。Actor只是ActorSystem的一部分，ActorSystem负责提供一些组件，而且能够让actor之间相互能够找到彼此。</p>
<p>akka系统中需要保证：</p>
<ul>
<li>不存在可变共享资源</li>
<li>传递的message不可变</li>
<li>异步发送message</li>
</ul>
<p>当我们使用某个工具包或者框架的时候，这个东西肯定为我们提供了方便的直接可用的东西。像下图1.10中展示的一样，一个actor就是我们可以向他发送message的对象，我们并不关心message被怎样传递，谁来接收这些message。我们的代码只负责在接收到message之后进行对应的处理即可。还可以通过某个协议与其他人进行协作。</p>
<p>现在我们接触了actor，mailbox，address。akka是使用scala原生api构建的actor。scala API提供了actor trait给人继承来构建自己的actor。售票处就可以继承akka的Actor了，因为akka的Actor已经继承了scala的Actor trait，并且还有一些状态信息，还有一个内部队列用来存放票。address就是我们前面提到的ActorRef，也就是Actor reference的简写。这个售票处的ActorRef是给打印室发送message给售票处用的。在akka中，ActorRef有多种形式，只是不会显露出来而已。对于用户而言，只需要使用ActorRef的API就可以了。</p>
<p>下面我们通过图1.10走一个小小的例子，讲述一些我们的代码要做什么，ActorSystem会为我们做什么。<br><img src="/imgs/akka/akka1.10.png" alt="Figure 1.10 Actor Request Cycle in Action "><br>如你所见：我们向售票处actor要一个ActorRef，获取之后，就用它来发送请求，也就是买票(1至5步)。ActorSystem没有向我们暴露任何细节：怎样处理的这个request，mailbox在哪儿，message是否已经被传递了等等。</p>
<p>当然，前面我们提到的好处依然存在：我们并没有阻塞，干巴巴等待request被处理完毕；request中不包含任何共享的状态信息；实际的消息处理过程也没有对任何公共资源使用锁；我们不必搭理任何并发问题。</p>
<p>那么我们怎样从ActorSystem中获取一个ActorRef呢？ActorPath！<br><img src="/imgs/akka/akka1.11.png" alt="Figure 1.11 ActorPath URI syntax "><br>在上面的例子中，’poffice1’可以被换成’TicketingAgent2’。然后通过’TicketingAgent2’的ActorRef使用’../TicketingAgent3’还可以拿到它的兄弟节点actor的ActorRef。但是守卫actor只能是’user’。</p>
<p>akka中的<strong>监督机制</strong>就来源于这种层级制度。每个actor都自动是它的子节点的supervisor。当一个child挂了，parent就需要操心使用什么样的策略进行弥补。错误也可以被逐级向上抛出，直到上面的某个supervisor对这类错误感兴趣，处理掉。</p>
<p>akka<strong>不推荐直接通过constructor来创建actor</strong>，因为这样会破坏actor的层级。直接通过constructor创建的actor可以被直接访问并调用其方法，这也破坏了message传递过程中的并发保护。ActorSystem可以创建ActorRef，提供通用的方式来获取某个ActorRef，提供root actor来创建actor层级，并且把运行时其他组件与actor整合起来。</p>
<p>Actor的操作：</p>
<ul>
<li>CREATE<br>每个actor都可以创建自己的子actor，actor的拓扑结构是动态的。</li>
<li>SEND<br>actor之间可以异步相互发送message到彼此的mailbox里。</li>
<li>BECOME<br>actor的行为是可以动态改变的。每收到一条message，actor都可以以不同的方式处理下一条message，也就是切换它的行为，后面章节我们会遇到。</li>
<li>SUPERVISE<br>actor监控自己的子actor，并且为这些孩子擦屁股。在第三章中，我们会见识到处理message和处理error的明确不同。</li>
</ul>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>我们接触了ActorSystem和Actor实现的理论与实践，见识到了akka强大的能力。下一章你会发现这么厉害的能力竟然只需消耗一点点儿能量：你可以很快的运行akka。消息管理及并发的复杂性交给akka来搞定。<br>综上：</p>
<ul>
<li>基于消息传递让并发更加简单</li>
<li>并发的同时，我们还可以很简单地scale up 和scale out</li>
<li>我们可以任意扩展应用里的request和消息处理的组件</li>
<li>基于消息传递同样解决了容错</li>
<li>监管机制提供了一个并发并且容错的模型</li>
<li>akka让我们的代码不用特别复杂，但是拥有强大的力量</li>
</ul>
<p>下一章我们会启动运行我们的第一个akka应用。</p>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/akka/">akka</a>
  </div>

</div>



	<div class="article-share" id="share">
	
	  <div data-url="https://runningdata.github.io/2015/07/16/akka-读书笔记（1）/" data-title="akka in action 读书笔记（1） | Will&#39;s Blog" data-tsina="null" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2015/08/03/matlib-安装与卸载/" title="matlib 安装与卸载">
  <strong>上一篇：</strong><br/>
  <span>
  matlib 安装与卸载</span>
</a>
</div>


<div class="next">
<a href="/2015/07/16/heroku上部署自己的akka项目/"  title="heroku上部署自己的akka项目">
 <strong>下一篇：</strong><br/> 
 <span>heroku上部署自己的akka项目
</span>
</a>
</div>

</nav>

	
<!-- 多说评论框 start -->
  <div class="ds-thread" data-thread-key="2015/07/16/akka-读书笔记（1）/" data-title="akka in action 读书笔记（1）" data-url="https://runningdata.github.io/2015/07/16/akka-读书笔记（1）/"></div>
<!-- 多说评论框 end -->
<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"ruoyuchen"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
     || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
  </script>
<!-- 多说公共JS代码 end -->

</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
 
 <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#什么是AKKA"><span class="toc-number">1.</span> <span class="toc-text">什么是AKKA</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#并发"><span class="toc-number">1.1.</span> <span class="toc-text">并发</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#方案1：共享状态"><span class="toc-number">1.1.0.1.</span> <span class="toc-text">方案1：共享状态</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#方案2：消息驱动"><span class="toc-number">1.1.0.2.</span> <span class="toc-text">方案2：消息驱动</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#容灾"><span class="toc-number">1.2.</span> <span class="toc-text">容灾</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#scale-up-and-out"><span class="toc-number">1.3.</span> <span class="toc-text">scale up and out</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#scale-out"><span class="toc-number">1.3.1.</span> <span class="toc-text">scale out</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#scale-up"><span class="toc-number">1.3.2.</span> <span class="toc-text">scale up</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Akka-Actor-和-AkkaSystem"><span class="toc-number">2.</span> <span class="toc-text">Akka Actor 和 AkkaSystem</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#总结"><span class="toc-number">3.</span> <span class="toc-text">总结</span></a></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  


  

  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/youdaonote/" title="youdaonote">youdaonote<sup>187</sup></a></li>
			
		
			
				<li><a href="/tags/源码/" title="源码">源码<sup>10</sup></a></li>
			
		
			
				<li><a href="/tags/akka/" title="akka">akka<sup>9</sup></a></li>
			
		
			
				<li><a href="/tags/flume/" title="flume">flume<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/ETL/" title="ETL">ETL<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/solr/" title="solr">solr<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/spring/" title="spring">spring<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/调度平台/" title="调度平台">调度平台<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/azkaban/" title="azkaban">azkaban<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/mysql/" title="mysql">mysql<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/scala/" title="scala">scala<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/ambari/" title="ambari">ambari<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/quartz/" title="quartz">quartz<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/nodejs/" title="nodejs">nodejs<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Solr/" title="Solr">Solr<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/guava/" title="guava">guava<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/heroku/" title="heroku">heroku<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/hdfs/" title="hdfs">hdfs<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/hue/" title="hue">hue<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/ElasticSearch/" title="ElasticSearch">ElasticSearch<sup>1</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
          <li>
            
            	<a href="https://github.com/willcup" target="_blank" title=" 我自己的github">github</a>
            
          </li>
        
          <li>
            
            	<a href="http://thisding.com" target="_blank" title="朋友的主页">Steven&#39;s Blog</a>
            
          </li>
        
    </ul>
</div>

  


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

  <div class="weiboshow">
  <p class="asidetitle">新浪微博</p>
    <iframe width="100%" height="119" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=119&fansRow=2&ptype=1&speed=0&skin=9&isTitle=1&noborder=1&isWeibo=0&isFans=0&uid=null&verifier=&dpc=1"></iframe>
</div>


</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello ,I&#39;m Will Chen in MeiTuan. <br/>
			元 亨 利 贞.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		
		
		
		
		
		
		
		
		
		<a href="mailto:chenxin15@meituan.com" target="_blank" class="icon-email" title="Email Me"></a>
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2017 
		
		<a href="/about" target="_blank" title="Will Chen">Will Chen</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>









<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3Fe6d1f421bbc9962127a50488f9ed37d1' type='text/javascript'%3E%3C/script%3E"));
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
