
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>akka in action 读书笔记（7） | Will&#39;s Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="Will Chen">
    

    
    <meta name="description" content="配置
日志
单点app
web app
发布

只是了解actor和ActorSysten显然是不够的，一个完成的app在发布之前应该要包含其他必备功能。
7.1 配置akka使用了Typesafe的配置库。可以定义一些属性，然后直接在代码里引用。还有优雅的方式自动按照时间merge并override多个文件中的多个属性。对于配置还有一个比较重要的就是能够分test, dev, prod环境。">
<meta property="og:type" content="article">
<meta property="og:title" content="akka in action 读书笔记（7）">
<meta property="og:url" content="http://willcup.com/2016/08/17/akka-in-action-读书笔记（7）/index.html">
<meta property="og:site_name" content="Will's Blog">
<meta property="og:description" content="配置
日志
单点app
web app
发布

只是了解actor和ActorSysten显然是不够的，一个完成的app在发布之前应该要包含其他必备功能。
7.1 配置akka使用了Typesafe的配置库。可以定义一些属性，然后直接在代码里引用。还有优雅的方式自动按照时间merge并override多个文件中的多个属性。对于配置还有一个比较重要的就是能够分test, dev, prod环境。">
<meta property="og:image" content="http://willcup.com/imgs/akka/akka_7_config_example.png">
<meta property="og:image" content="http://willcup.com/imgs/akka/akka_7_config_fallback.png">
<meta property="og:image" content="http://willcup.com/imgs/akka/akka_7_priority_fallback.png">
<meta property="og:image" content="http://willcup.com/imgs/akka/akka_7_lift_config_part.png">
<meta property="og:updated_time" content="2016-10-28T02:54:06.773Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="akka in action 读书笔记（7）">
<meta name="twitter:description" content="配置
日志
单点app
web app
发布

只是了解actor和ActorSysten显然是不够的，一个完成的app在发布之前应该要包含其他必备功能。
7.1 配置akka使用了Typesafe的配置库。可以定义一些属性，然后直接在代码里引用。还有优雅的方式自动按照时间merge并override多个文件中的多个属性。对于配置还有一个比较重要的就是能够分test, dev, prod环境。">
<meta name="twitter:image" content="http://willcup.com/imgs/akka/akka_7_config_example.png">

    
    <link rel="alternative" href="/atom.xml" title="Will&#39;s Blog" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="Will&#39;s Blog" title="Will&#39;s Blog"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Will&#39;s Blog">Will&#39;s Blog</a></h1>
				<h2 class="blog-motto">简易 变易 不易</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">首页</a></li>
					
						<li><a href="/archives">归档</a></li>
					
						<li><a href="/node_modules">测试</a></li>
					
						<li><a href="/about">关于</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:willcup.com">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/08/17/akka-in-action-读书笔记（7）/" title="akka in action 读书笔记（7）" itemprop="url">akka in action 读书笔记（7）</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Will Chen" target="_blank" itemprop="author">Will Chen</a>
		
  <p class="article-time">
    <time datetime="2016-08-17T03:02:12.000Z" itemprop="datePublished"> 发表于 2016-08-17</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		
			<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#7-1-配置"><span class="toc-text">7.1 配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-1-1-牛刀小试"><span class="toc-text">7.1.1 牛刀小试</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-1-2-使用默认值"><span class="toc-text">7.1.2 使用默认值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-1-3-akka配置"><span class="toc-text">7.1.3 akka配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-1-4-多系统"><span class="toc-text">7.1.4 多系统</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-2-日志"><span class="toc-text">7.2 日志</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-1-Akka-app中记录日志"><span class="toc-text">7.2.1 Akka app中记录日志</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-2-使用日志功能"><span class="toc-text">7.2.2 使用日志功能</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-3-控制日志功能"><span class="toc-text">7.2.3 控制日志功能</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-3-发布基于Akka的app"><span class="toc-text">7.3 发布基于Akka的app</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-3-1-独立app"><span class="toc-text">7.3.1 独立app</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-3-2-创建web-app"><span class="toc-text">7.3.2 创建web app</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-4-总结"><span class="toc-text">7.4 总结</span></a></li></ol>
		
		</div>
		
		<ul>
<li>配置</li>
<li>日志</li>
<li>单点app</li>
<li>web app</li>
<li>发布</li>
</ul>
<p>只是了解actor和ActorSysten显然是不够的，一个完成的app在发布之前应该要包含其他必备功能。</p>
<h2 id="7-1-配置"><a href="#7-1-配置" class="headerlink" title="7.1 配置"></a>7.1 配置</h2><p>akka使用了Typesafe的配置库。可以定义一些属性，然后直接在代码里引用。还有优雅的方式自动按照时间merge并override多个文件中的多个属性。对于配置还有一个比较重要的就是能够分test, dev, prod环境。</p>
<h4 id="7-1-1-牛刀小试"><a href="#7-1-1-牛刀小试" class="headerlink" title="7.1.1 牛刀小试"></a>7.1.1 牛刀小试</h4><p>首先看一下Typesafe定义配置文件的实例：<br><img src="/imgs/akka/akka_7_config_example.png" alt="配置内容示例"></p>
<p>我们使用ConfigurationFactory来加载配置文件；<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">val</span> config = <span class="type">ConfigFactory</span>.load()</div></pre></td></tr></table></figure></p>
<p>它会按照以下顺序找默认的配置文件：</p>
<ul>
<li>application.properties</li>
<li>application.json</li>
<li>application.conf. 这种说明一下是HOCON格式的，基于json，但是可读性更强</li>
</ul>
<p>也可以同时支持以上所有的文件类型：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">hostname=&quot;localhost&quot; </div><div class="line">MyAppl &#123;</div><div class="line">   version = 10</div><div class="line">   description = &quot;My application&quot;</div><div class="line">   database &#123;</div><div class="line">     connect=&quot;jdbc:mysql://localhost/mydata&quot;</div><div class="line">     user=&quot;me&quot;</div><div class="line">   &#125;</div><div class="line"> &#125;</div></pre></td></tr></table></figure></p>
<p>对于大多数app来说，这些配置就已经足够使用了。这种配置可读性强，易于分组管理属性，JDBC就是一个绝佳的例子。对于依赖注入的框架，需要把item写进控制他们的对象中去，这里有一个更简单的方法。</p>
<p>下面看一下怎样使用上面定义的属性：<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">val</span> applicationVersion = config.getInt(<span class="string">"MyAppl.version"</span>)</div><div class="line"><span class="keyword">val</span> databaseConnectSting = config.getString(<span class="string">"MyAppl.database.connect"</span>)</div></pre></td></tr></table></figure></p>
<p>也可以分开获取连接串<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">val</span> databaseCfg = configuration.getConfig(<span class="string">"MyAppl.database"</span>)</div><div class="line"><span class="keyword">val</span> databaseConnectSting = databaseCfg.getString(<span class="string">"connect"</span>)</div></pre></td></tr></table></figure></p>
<p>配置文件中包含的属性一般都是app名称、版本号等，一般会在程序中多次使用它们。</p>
<p>我们还可以使用环境变量来设置变量：<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">hostname=$&#123;?<span class="type">HOST_NAME</span>&#125;</div></pre></td></tr></table></figure></p>
<p>？代表我们会在系统环境变量中获取该变量的值。因为我们并不能保证有这个环境变量，所以还是先定义一个默认值：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">hostname=&quot;localhost&quot;</div><div class="line">hostname=$&#123;?HOST_NAME&#125;</div></pre></td></tr></table></figure></p>
<h4 id="7-1-2-使用默认值"><a href="#7-1-2-使用默认值" class="headerlink" title="7.1.2 使用默认值"></a>7.1.2 使用默认值</h4><p>还是看JDBC配置。开发环境我们可能配置地址为localhost，但是有人要看demo的话，肯定要改成别的地址。最简单的方法就是复制配置文件，重新命名这个文件，然后让代码读取这个文件的配置内容。问题是这样我们就在两个位置分别有了两个可以相互替代的配置文件。如果还要切换新环境的话，就成了3个了。</p>
<p>配置库包含一个fall-back机制，默认配置会被放进一个对象中，然后这个对象被作为fall-back机制的配置source。见下图：<br><img src="/imgs/akka/akka_7_config_fallback.png" alt="fall-back配置"></p>
<p>注意：这个机制里使用到的属性必须在配置文件中存在默认值，如果找不到的话，就会报错了。</p>
<p>fall-back机制为我们提供默认的配置，那么我们怎样配置默认值呢？应该在jar文件的根目录下的reference.conf配置，每个库都应该包含自己的默认配置。配置库会找到所有的reference.conf文件，整个这些配置到fall-back结构中。这样，某个库所需要的所有的属性都有了默认值。</p>
<p>前面说到配置库是支持多种配置文件的，你可以在一个app中使用多个不同类型的配置文件。每个文件都可以作为下一个文件的fall-back。</p>
<p>下图展示了配置库使用多个文件构建配置tree的优先级：<br><img src="/imgs/akka/akka_7_priority_fallback.png" alt="配置fall-back结构的优先级"></p>
<p>多数app只需要一种配置文件就可以了。但是如果你定了多个，那么默认值之间的覆盖关系就是上图中，上面的覆盖下面的配置。</p>
<p>默认读取文件是 application.{conf,json,properties}。有两种方式自定义配置文件，一种是load的时候指定<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">val</span> config = <span class="type">ConfigFactory</span>.load(<span class="string">"myapp"</span>)</div></pre></td></tr></table></figure></p>
<p>这样它就会去找myapp.{conf,json,properties}。</p>
<p>另一种方式是使用系统变量。有时这种使用起来比较方便，我们可以构建bash脚本的时候给app指定(比去jar和war里面找要好一些)。</p>
<ul>
<li>config.resource 此变量指定项目resource中配置文件完整名称，例如： application.conf</li>
<li>config.file  文件系统中配置文件的全名</li>
<li>config.url   </li>
</ul>
<p>当使用load不传参的时候，就会使用系统属性了，使用系统属性指定的配置文件的时候，就不会再去搜索各种文件类型了：conf, json and properties。</p>
<h4 id="7-1-3-akka配置"><a href="#7-1-3-akka配置" class="headerlink" title="7.1.3 akka配置"></a>7.1.3 akka配置</h4><p>上面介绍了怎样配置app的属性，但是如果我们想修改akka本身的一些配置怎么办呢？akka是怎样使用配置库的呢？有可能是有多个ActorSystem，每个Actorsystem都有自己对应的配置。当创建ActorSystem的时候没有指定配置的话，ActorSystem会使用默认值自己创建。</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">val</span> system = <span class="type">ActorSystem</span>(<span class="string">"mySystem"</span>)</div></pre></td></tr></table></figure>
<p>这里内部调用了<code>ConfigFactory.load()</code>。</p>
<p>我们也可以指定配置文件位置：<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">val</span> configuration = <span class="type">ConfigFactory</span>.load(<span class="string">"mysystem"</span>)</div><div class="line"><span class="keyword">val</span> systemA = <span class="type">ActorSystem</span>(<span class="string">"mysystem"</span>,configuration)</div></pre></td></tr></table></figure></p>
<p>这个配置就已经存在于这个app了，可以通过如下方式访问；<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">val</span> mySystem = <span class="type">ActorSystem</span>(<span class="string">"myAppl"</span>)</div><div class="line"><span class="keyword">val</span> config = mySystem.settings.config</div><div class="line"><span class="keyword">val</span> applicationDescription = config.getString(<span class="string">"myAppl.name"</span>)</div></pre></td></tr></table></figure></p>
<h4 id="7-1-4-多系统"><a href="#7-1-4-多系统" class="headerlink" title="7.1.4 多系统"></a>7.1.4 多系统</h4><p>有时候，在单个实例上我们需要启动多个子系统，每个子系统应该有自己的配置。</p>
<p>假如我们使用了多个JVM，他们基于同一个jar文件。我们就是用系统变量来解决这个问题。每启动一个新的进程，就是用一个不同的配置文件。但是配置里多数都是相同的，只有少数几个配置需要修改。我们使用include来解决这个问题</p>
<p>下面是baseConfig.conf<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">MyAppl &#123;</div><div class="line"> version = 10</div><div class="line"> description = &quot;My application&quot;</div><div class="line"> &#125;</div></pre></td></tr></table></figure></p>
<p>我们使用一个共享变量version，还有不同的变量description。下面是子系统的配置文件subAppl.conf<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">include &quot;baseConfig&quot;</div><div class="line">MyAppl &#123;</div><div class="line"> description = &quot;Sub Application&quot;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>注意include的位置。</p>
<p>如果子系统运行在同一个jvm里呢？那样我们就不能使用系统变量来读取其他的配置文件了。那我们就把两个系统的配置文件合二为一，指定app名称，下面是combined.conf<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">MyAppl &#123;</div><div class="line">   version = 10</div><div class="line">   description = &quot;My application&quot;</div><div class="line">&#125;</div><div class="line">subApplA &#123;</div><div class="line">   MyAppl &#123;</div><div class="line">   description = &quot;Sub application&quot;</div><div class="line">   &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这里我们使用了subApplA的子树，然后把它放在了configuration chain的上端。This is called lifting a configuration, because the configuration path is shortened.。见下图；<br><img src="/imgs/akka/akka_7_lift_config_part.png" alt="Lifting configuration part"></p>
<p>当我们请求MyAppl.description的时候，返回”Sub application”因为它被设置在配置中的最高层级上，请求MyAppl.version获得10，因为配置的高层级上没有它的定义，所以它使用fall-back机制获取到了10.</p>
<p>下面代码展示了怎样同时使用lift和callback，注意fallback被chain了起来：<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">val</span> configuration = <span class="type">ConfigFactory</span>.load(<span class="string">"combined"</span>)</div><div class="line"> <span class="keyword">val</span> subApplACfg = configuration.getConfig(<span class="string">"subApplA"</span>)</div><div class="line"> <span class="comment">// 把configuration作为fall-back</span></div><div class="line"> <span class="keyword">val</span> config = subApplACfg.withFallback(configuration)</div></pre></td></tr></table></figure></p>
<p>说的不多，但是这些配置就已经够用了。</p>
<h2 id="7-2-日志"><a href="#7-2-日志" class="headerlink" title="7.2 日志"></a>7.2 日志</h2><p>下一个app必备的功能就是写日志。日志库这个东西众口难调，akka实现了一个日志adapter支持多种日志框架。日志关心两个东西，定义log级别以及定义log内容。</p>
<h4 id="7-2-1-Akka-app中记录日志"><a href="#7-2-1-Akka-app中记录日志" class="headerlink" title="7.2.1 Akka app中记录日志"></a>7.2.1 Akka app中记录日志</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyActor</span> <span class="keyword">extends</span> <span class="title">Actor</span> </span>&#123;</div><div class="line"> <span class="keyword">val</span> log = <span class="type">Logging</span>(context.system, <span class="keyword">this</span>)</div><div class="line"> ...</div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<p>需要注意的是，创建logger的时候需要使用ActorSystem。 logging adapter使用ActorSystem的eventStream发送日志信息给eventhandler。eventStream是Akka中的订阅系统。eventhandler收到日志信息后，使用定义的日志框架记录下来。这样，每个actor都能记录日志，而只有一个eventHandler actor依赖指定的日志框架。另一个好处就是IO，IO在并发环境下会特别慢。在高性能的app里，我们不希望等待打日志的过程。使用eventHandler就不用任何等待。下面列出了默认创建event-handler需要的配置信息：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">akka &#123;</div><div class="line"> # Event handlers to register at boot time</div><div class="line"> # (Logging$DefaultLogger logs to STDOUT)</div><div class="line"> event-handlers = [&quot;akka.event.Logging$DefaultLogger&quot;]</div><div class="line"> # Options: ERROR, WARNING, INFO, DEBUG</div><div class="line"> loglevel = &quot;DEBUG&quot;</div><div class="line"> &#125;</div></pre></td></tr></table></figure></p>
<p>eventHandler并没有使用任何log框架，而是把log到了标准输出。下面是一个自定义的eventHandler代码：<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> akka.event.<span class="type">Logging</span>.<span class="type">InitializeLogger</span></div><div class="line"><span class="keyword">import</span> akka.event.<span class="type">Logging</span>.<span class="type">LoggerInitialized</span></div><div class="line"><span class="keyword">import</span> akka.event.<span class="type">Logging</span>.<span class="type">Error</span></div><div class="line"><span class="keyword">import</span> akka.event.<span class="type">Logging</span>.<span class="type">Warning</span></div><div class="line"><span class="keyword">import</span> akka.event.<span class="type">Logging</span>.<span class="type">Info</span></div><div class="line"><span class="keyword">import</span> akka.event.<span class="type">Logging</span>.<span class="type">Debug</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyEventListener</span> <span class="keyword">extends</span> <span class="title">Actor</span></span></div><div class="line">&#123;</div><div class="line">   <span class="function"><span class="keyword">def</span> <span class="title">receive</span> </span>= &#123;</div><div class="line">     <span class="keyword">case</span> <span class="type">InitializeLogger</span>(_) =&gt;</div><div class="line">        sender ! <span class="type">LoggerInitialized</span></div><div class="line">     <span class="keyword">case</span> <span class="type">Error</span>(cause, logSource, logClass, message) =&gt;</div><div class="line">        println( <span class="string">"ERROR "</span> + message)</div><div class="line">     <span class="keyword">case</span> <span class="type">Warning</span>(logSource, logClass, message) =&gt;</div><div class="line">        println( <span class="string">"WARN "</span> + message)</div><div class="line">     <span class="keyword">case</span> <span class="type">Info</span>(logSource, logClass, message) =&gt;</div><div class="line">        println( <span class="string">"INFO "</span> + message)</div><div class="line">     <span class="keyword">case</span> <span class="type">Debug</span>(logSource, logClass, message) =&gt;</div><div class="line">        println( <span class="string">"DEBUG "</span> + message)</div><div class="line">   &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这只是一个简单的示例。Akka内置了两个eventHandler的实现，一个是上面的输出到STDOUT的，还有一个就是SLF4J。需要在配置文件中添加：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">akka &#123;</div><div class="line"> event-handlers =</div><div class="line"> [&quot;akka.event.slf4j.Slf4jEventHandler&quot;]</div><div class="line"> # Options: ERROR,</div><div class="line"> WARNING,</div><div class="line"> INFO, DEBUG</div><div class="line"> loglevel = &quot;DEBUG&quot;</div><div class="line"> &#125;</div></pre></td></tr></table></figure></p>
<h4 id="7-2-2-使用日志功能"><a href="#7-2-2-使用日志功能" class="headerlink" title="7.2.2 使用日志功能"></a>7.2.2 使用日志功能</h4><p>重新定义logger：<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyActor</span> <span class="keyword">extends</span> <span class="title">Actor</span> </span>&#123;</div><div class="line"> <span class="keyword">val</span> log = <span class="type">Logging</span>(context.system, <span class="keyword">this</span>)</div><div class="line"> ...</div><div class="line"> &#125;</div></pre></td></tr></table></figure></p>
<p>第二个参数就是日志的source。这里就是这个类的实例。可以mixin ActorLogging trait来简化代码。</p>
<p>打日志过程中还可以使用placeholder<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">log.debug(<span class="string">"two parameters: &#123;&#125;, &#123;&#125;"</span>, <span class="string">"one"</span>,<span class="string">"two"</span>)</div></pre></td></tr></table></figure></p>
<h4 id="7-2-3-控制日志功能"><a href="#7-2-3-控制日志功能" class="headerlink" title="7.2.3 控制日志功能"></a>7.2.3 控制日志功能</h4><p>有时我们想自由控制日志的输出内容，比如查看生产环境的某些信息。看一下这个配置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">akka &#123;</div><div class="line">   # logging must be set to DEBUG to use any of the options below</div><div class="line">   loglevel = DEBUG</div><div class="line">   # Log the complete configuration at INFO level when the actor</div><div class="line">   # system is started. This is useful when you are uncertain of</div><div class="line">   # what configuration is used.</div><div class="line">   log-config-on-start = on</div><div class="line">   debug &#123;</div><div class="line">   # logging of all user-level messages that are processed by</div><div class="line">   # Actors that use akka.event.LoggingReceive enable function of</div><div class="line">   # LoggingReceive, which is to log any received message at</div><div class="line">   # DEBUG level</div><div class="line">   # 把所有启用了akka.event.LoggingReceive的收到的user-leve的debug level的日志信息都打印出来</div><div class="line">   receive = on</div><div class="line"></div><div class="line">   # enable DEBUG logging of all AutoReceiveMessages</div><div class="line">   # (Kill, PoisonPill and the like)</div><div class="line">   autoreceive = on</div><div class="line">   # enable DEBUG logging of actor lifecycle changes</div><div class="line">   # (restarts, deaths etc)</div><div class="line">   lifecycle = on</div><div class="line">   # enable DEBUG logging of all LoggingFSMs for events,</div><div class="line">   # transitions and timers</div><div class="line">   fsm = on</div><div class="line">   # enable DEBUG logging of subscription (subscribe/unsubscribe)</div><div class="line">   # changes on the eventStream</div><div class="line">   event-stream = on</div><div class="line">   &#125;</div><div class="line">   remote &#123;</div><div class="line">   # If this is &quot;on&quot;, Akka will log all outbound messages at</div><div class="line">   # DEBUG level, if off then they are not logged</div><div class="line">   log-sent-messages = on</div><div class="line">   # If this is &quot;on,&quot; Akka will log all inbound messages at</div><div class="line">   # DEBUG level, if off then they are not logged</div><div class="line">   log-received-messages = on</div><div class="line">   &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>对应使用logger的代码是：<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyActor</span> <span class="keyword">extends</span> <span class="title">Actor</span> <span class="keyword">with</span> <span class="title">ActorLogging</span> </span>&#123;</div><div class="line"> <span class="function"><span class="keyword">def</span> <span class="title">receive</span> </span>= <span class="type">LoggingReceive</span> &#123;</div><div class="line"> <span class="keyword">case</span> ... =&gt; ...</div><div class="line"> &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>现在，只要我们设置属性akka.debug.receive 为on，我们actor收到的所有message就都可以被log出来了。</p>
<p>好了。日志就介绍到这里。</p>
<h2 id="7-3-发布基于Akka的app"><a href="#7-3-发布基于Akka的app" class="headerlink" title="7.3 发布基于Akka的app"></a>7.3 发布基于Akka的app</h2><p>这一节介绍发布应用的两种方式，一种是独立app，另一种是基于play-min的web app。</p>
<h4 id="7-3-1-独立app"><a href="#7-3-1-独立app" class="headerlink" title="7.3.1 独立app"></a>7.3.1 独立app</h4><p>我们使用akka的插件MicroKernel创建独立app。先弄一个HelloWorld Actor，只接收message，恢复hello。<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloWorld</span> <span class="keyword">extends</span> <span class="title">Actor</span></span></div><div class="line">   <span class="keyword">with</span> <span class="type">ActorLogging</span> &#123;</div><div class="line">     <span class="function"><span class="keyword">def</span> <span class="title">receive</span> </span>= &#123;</div><div class="line">         <span class="keyword">case</span> msg:<span class="type">String</span> =&gt;</div><div class="line">         <span class="keyword">val</span> hello = <span class="string">"Hello %s"</span>.format(msg)</div><div class="line">         sender ! hello</div><div class="line">         log.info(<span class="string">"Sent response &#123;&#125;"</span>,hello)</div><div class="line">     &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>下面我们创建HelloWorldCaller，它负责调用上面的 HelloWorld actor。<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloWorldCaller</span>(<span class="params">timer:<span class="type">Duration</span>, actor:<span class="type">ActorRef</span></span>)</span></div><div class="line"> <span class="keyword">extends</span> <span class="type">Actor</span> <span class="keyword">with</span> <span class="type">ActorLogging</span> &#123;</div><div class="line"> </div><div class="line">   <span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">TimerTick</span>(<span class="params">msg:<span class="type">String</span></span>)</span></div><div class="line"></div><div class="line">   <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">preStart</span></span>() &#123;</div><div class="line">       <span class="keyword">super</span>.preStart()</div><div class="line">       <span class="comment">// 使用akka scheduler给自己发送message</span></div><div class="line">       context.system.scheduler.schedule(</div><div class="line">         timer, 	<span class="comment">// 首次触发之前的时长</span></div><div class="line">         timer,		<span class="comment">// 周期 </span></div><div class="line">         self,		<span class="comment">// 发往的actor，这里是自己</span></div><div class="line">         <span class="keyword">new</span> <span class="type">TimerTick</span>(<span class="string">"everybody"</span>))	<span class="comment">// 发出的message</span></div><div class="line">   &#125;</div><div class="line">   <span class="function"><span class="keyword">def</span> <span class="title">receive</span> </span>= &#123;</div><div class="line">       <span class="keyword">case</span> msg: <span class="type">String</span> =&gt; log.info(<span class="string">"received &#123;&#125;"</span>,msg)</div><div class="line">       <span class="keyword">case</span> tick: <span class="type">TimerTick</span> =&gt; actor ! tick.msg</div><div class="line">   &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这个actor使用内置的schuduler周期性的生成message。每次收到TimerTick，我们都给构造方法中传进来的actor发送一个这个tick的message。当接收到一个String的message的时候，就用日志记录下来。</p>
<p>下面使用akka内核来差un构建系统，这个内核包含了一个启动接口，我们就是要实现这个接口。<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> akka.actor.&#123; <span class="type">Props</span>, <span class="type">ActorSystem</span> &#125;</div><div class="line"><span class="keyword">import</span> akka.kernel.<span class="type">Bootable</span></div><div class="line"><span class="keyword">import</span> scala.concurrent.duration._</div><div class="line"><span class="comment">// 继承Bootable trait，启动app的时候就会被调用</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">BootHello</span> <span class="keyword">extends</span> <span class="title">Bootable</span> </span>&#123;</div><div class="line">     </div><div class="line">     <span class="keyword">val</span> system = <span class="type">ActorSystem</span>(<span class="string">"hellokernel"</span>)</div><div class="line"></div><div class="line">     <span class="comment">// 当app启动的时候，会调用这个接口方法</span></div><div class="line">     <span class="function"><span class="keyword">def</span> <span class="title">startup</span> </span>= &#123;</div><div class="line">         <span class="keyword">val</span> actor = system.actorOf(<span class="type">Props</span>[<span class="type">HelloWorld</span>])</div><div class="line">         <span class="keyword">val</span> config = system.settings.config</div><div class="line">         <span class="keyword">val</span> timer = config.getInt(<span class="string">"helloWorld.timer"</span>)</div><div class="line">         system.actorOf(<span class="type">Props</span>(<span class="keyword">new</span> <span class="type">HelloWorldCaller</span>(timer millis, actor)))</div><div class="line">     &#125;</div><div class="line">     </div><div class="line">     <span class="function"><span class="keyword">def</span> <span class="title">shutdown</span> </span>= &#123;</div><div class="line">         system.shutdown()</div><div class="line">     &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>现在我们已构建好了系统，还需要一些资源让我们的app运行起来。我们先写一下配置文件reference.conf<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">helloWorld &#123;</div><div class="line"> timer=5000</div><div class="line"> &#125;</div></pre></td></tr></table></figure></p>
<p>我们的默认timer值是5000毫秒。注意reference.conf文件需要放在jar文件的根目录下。下面我们在application.conf里配置logger相关<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">akka &#123;</div><div class="line"> event-handlers =</div><div class="line"> [&quot;akka.event.slf4j.Slf4jEventHandler&quot;]</div><div class="line"> # Options: ERROR,</div><div class="line"> WARNING,</div><div class="line"> INFO, DEBUG</div><div class="line"> loglevel = &quot;DEBUG&quot;</div><div class="line"> &#125;</div></pre></td></tr></table></figure></p>
<p>万事俱备。下面使用 akka-sbt-plugin 来创建依赖配置文件, 编辑plugins.sbt<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">resolvers += &quot;Typesafe Repository&quot;</div><div class="line">  at &quot;http://repo.akka.io/releases/&quot; </div><div class="line"></div><div class="line">  addSbtPlugin(&quot;com.typesafe.akka&quot; % &quot;akka-sbt-plugin&quot; % &quot;2.0.1&quot;)</div></pre></td></tr></table></figure></p>
<p>为不熟悉sbt的同学解释一下。第一行添加了repository的地址。然后是一个空行，这个注意一下，它代表前一行完事儿了。下一行定义了我们需要的插件。</p>
<p>然后创建build文件， HelloKernelBuild.scala<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> sbt._</div><div class="line"> <span class="keyword">import</span> <span class="type">Keys</span>._</div><div class="line"> <span class="keyword">import</span> akka.sbt.<span class="type">AkkaKernelPlugin</span></div><div class="line"> <span class="keyword">import</span> akka.sbt.<span class="type">AkkaKernelPlugin</span>.&#123; <span class="type">Dist</span>,</div><div class="line">     outputDirectory,</div><div class="line">     distJvmOptions</div><div class="line"> &#125;</div><div class="line"> <span class="class"><span class="keyword">object</span> <span class="title">HelloKernelBuild</span> <span class="keyword">extends</span> <span class="title">Build</span> </span>&#123;</div><div class="line">     <span class="keyword">lazy</span> <span class="keyword">val</span> <span class="type">HelloKernel</span> = <span class="type">Project</span>(</div><div class="line">         id = <span class="string">"hello-kernel-book"</span>,</div><div class="line">         base = file(<span class="string">"."</span>),</div><div class="line">         settings = defaultSettings</div><div class="line">         	++ <span class="type">AkkaKernelPlugin</span>.distSettings <span class="comment">// 添加akka插件的功能</span></div><div class="line">         	++ <span class="type">Seq</span>(</div><div class="line">			<span class="comment">// 构建需要的依赖</span></div><div class="line">             		libraryDependencies ++= <span class="type">Dependencies</span>.helloKernel,</div><div class="line">             		distJvmOptions in <span class="type">Dist</span> := <span class="string">"-Xms256M -Xmx1024M"</span>,</div><div class="line">			<span class="comment">// dist输出目录</span></div><div class="line">             		outputDirectory in <span class="type">Dist</span> := file(<span class="string">"target/helloDist"</span>)</div><div class="line">         	)</div><div class="line">     )</div><div class="line">     <span class="keyword">lazy</span> <span class="keyword">val</span> buildSettings = <span class="type">Defaults</span>.defaultSettings</div><div class="line">     ++ <span class="type">Seq</span>(</div><div class="line">         organization := <span class="string">"com.manning"</span>,</div><div class="line">         version := <span class="string">"0.1-SNAPSHOT"</span>,</div><div class="line">         scalaVersion := <span class="string">"2.9.1"</span>,</div><div class="line">         crossPaths := <span class="literal">false</span>,</div><div class="line">         organizationName := <span class="string">"Mannings"</span>,</div><div class="line">         organizationHomepage := <span class="type">Some</span>(url(<span class="string">"http://www.mannings.com"</span>))</div><div class="line">     )</div><div class="line">     <span class="keyword">lazy</span> <span class="keyword">val</span> defaultSettings = buildSettings ++ <span class="type">Seq</span>(</div><div class="line">         resolvers += <span class="string">"Typesafe Repo"</span> at  <span class="string">"http://repo.typesafe.com/typesafe/releases/"</span>,</div><div class="line">         <span class="comment">// compile options</span></div><div class="line">         scalacOptions ++= <span class="type">Seq</span>(<span class="string">"-encoding"</span>, <span class="string">"UTF-8"</span>, <span class="string">"-deprecation"</span>,  <span class="string">"-unchecked"</span>),</div><div class="line">         javacOptions ++= <span class="type">Seq</span>(<span class="string">"-Xlint:unchecked"</span>, <span class="string">"-Xlint:deprecation"</span>)</div><div class="line">     )</div><div class="line">&#125;  </div><div class="line"></div><div class="line"> <span class="comment">// Dependencies</span></div><div class="line"> <span class="class"><span class="keyword">object</span> <span class="title">Dependencies</span> </span>&#123;</div><div class="line">   <span class="keyword">import</span> <span class="type">Dependency</span>._</div><div class="line">   <span class="keyword">val</span> helloKernel = <span class="type">Seq</span>(akkaActor, akkaKernel, akkaSlf4j, lf4jApi, slf4jLog4j, <span class="type">Test</span>.junit, <span class="type">Test</span>.scalatest, <span class="type">Test</span>.akkaTestKit)</div><div class="line"> &#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">object</span> <span class="title">Dependency</span> </span>&#123;</div><div class="line">     <span class="comment">// Versions</span></div><div class="line">     <span class="class"><span class="keyword">object</span> <span class="title">V</span> </span>&#123;</div><div class="line">       <span class="keyword">val</span> <span class="type">Scalatest</span> = <span class="string">"1.6.1"</span></div><div class="line">       <span class="keyword">val</span> <span class="type">Slf4j</span> = <span class="string">"1.6.4"</span></div><div class="line">       <span class="keyword">val</span> <span class="type">Akka</span> = <span class="string">"2.0"</span></div><div class="line">     &#125;</div><div class="line">     <span class="comment">// Compile</span></div><div class="line">     <span class="keyword">val</span> commonsCodec = <span class="string">"commons-codec"</span> % <span class="string">"commons-codec"</span>% <span class="string">"1.4"</span></div><div class="line">     <span class="keyword">val</span> commonsIo = <span class="string">"commons-io"</span>  % <span class="string">"commons-io"</span> % <span class="string">"2.0.1"</span></div><div class="line">     <span class="keyword">val</span> commonsNet = <span class="string">"commons-net"</span>  % <span class="string">"commons-net"</span> % <span class="string">"3.1"</span></div><div class="line">     <span class="keyword">val</span> slf4jApi = <span class="string">"org.slf4j"</span> % <span class="string">"slf4j-api"</span> % <span class="type">V</span>.<span class="type">Slf4j</span></div><div class="line">     <span class="keyword">val</span> slf4jLog4j = <span class="string">"org.slf4j"</span>  % <span class="string">"slf4j-log4j12"</span>% <span class="type">V</span>.<span class="type">Slf4j</span></div><div class="line">     <span class="keyword">val</span> akkaActor = <span class="string">"com.typesafe.akka"</span> % <span class="string">"akka-actor"</span> % <span class="type">V</span>.<span class="type">Akka</span></div><div class="line">     <span class="keyword">val</span> akkaKernel = <span class="string">"com.typesafe.akka"</span> % <span class="string">"akka-kernel"</span> % <span class="type">V</span>.<span class="type">Akka</span></div><div class="line">     <span class="keyword">val</span> akkaSlf4j = <span class="string">"com.typesafe.akka"</span>  % <span class="string">"akka-slf4j"</span> % <span class="type">V</span>.<span class="type">Akka</span></div><div class="line">     <span class="keyword">val</span> scalatest = <span class="string">"org.scalatest"</span> %% <span class="string">"scalatest"</span> % <span class="type">V</span>.<span class="type">Scalatest</span></div><div class="line">     <span class="class"><span class="keyword">object</span> <span class="title">Test</span> </span>&#123;</div><div class="line">         <span class="keyword">val</span> junit = <span class="string">"junit"</span> % <span class="string">"junit"</span> %  <span class="string">"4.5"</span> % <span class="string">"test"</span></div><div class="line">         <span class="keyword">val</span> scalatest = <span class="string">"org.scalatest"</span> %% <span class="string">"scalatest"</span> % <span class="type">V</span>.<span class="type">Scalatest</span> % <span class="string">"test"</span></div><div class="line">         <span class="keyword">val</span> akkaTestKit =<span class="string">"com.typesafe.akka"</span>  % <span class="string">"akka-testkit"</span> % <span class="type">V</span>.<span class="type">Akka</span> % <span class="string">"test"</span></div><div class="line">     &#125;</div><div class="line"> &#125;</div></pre></td></tr></table></figure></p>
<p>万事俱备了。进入项目根目录，启动sbt，执行dist命令<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">sbt</div><div class="line">[info] Loading project</div><div class="line">definition from J:\boek\manningAkka\</div><div class="line">listings\kernel\project</div><div class="line">[info]</div><div class="line">Set current project to hello-kernel-book (in build</div><div class="line"> file:/J:/boek/manningAkka/listings/kernel/)</div><div class="line">&gt; dist</div></pre></td></tr></table></figure></p>
<p>完事儿后，查看 /target/helloDist目录，可看到4个子目录：</p>
<ul>
<li>bin 启动脚本所在的地方，包含linux和window的</li>
<li>config 运行app所需的配置文件</li>
<li>deploy jar文件所在的地方</li>
<li>lib 依赖的jar文件所在的地方</li>
</ul>
<p>使用启动脚本，启动我们的app：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">./start BootHello</div></pre></td></tr></table></figure></p>
<p>观察log文件。</p>
<h4 id="7-3-2-创建web-app"><a href="#7-3-2-创建web-app" class="headerlink" title="7.3.2 创建web app"></a>7.3.2 创建web app</h4><p>相比上面独立app，这里并不多做什么。 Play-mini是基于Play的扩展。我们要做的app只是提供接口，并不提供界面。有其他的工具可以，我们只是觉得 Play-mini来做例子<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">object</span> <span class="title">PlayMiniHello</span> <span class="keyword">extends</span> <span class="title">Application</span> </span>&#123;</div><div class="line"> <span class="keyword">lazy</span> <span class="keyword">val</span> system = <span class="type">ActorSystem</span>(<span class="string">"webhello"</span>)</div><div class="line"> <span class="keyword">lazy</span> <span class="keyword">val</span> actor = system.actorOf(<span class="type">Props</span>[<span class="type">HelloWorld</span>])</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>只要继承Application, 就集成了好多的功能，就像前面的kernel一样。web app中需要创建路由。<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">object</span> <span class="title">PlayMiniHello</span> <span class="keyword">extends</span> <span class="title">Application</span> </span>&#123;</div><div class="line"> <span class="function"><span class="keyword">def</span> <span class="title">route</span> </span>= &#123;</div><div class="line"> 	<span class="keyword">case</span> <span class="type">GET</span>(<span class="type">Path</span>(<span class="string">"/test"</span>)) =&gt; <span class="type">Action</span> &#123;</div><div class="line"> 		<span class="type">Ok</span>(<span class="string">"TEST @ %s\n"</span>.format(<span class="type">System</span>.currentTimeMillis))</div><div class="line">	 &#125;</div><div class="line"> &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>在面向服务的架构里，整个app甚至就可以仅仅基于几个这样的服务映射。相比上面的kernel方式，这是唯一的区别。下面我们创建hello请求的路由，它接收一个name参数，当没有这个参数的时候就使用我们配置里的默认值。下面是从REST路径里获取参数的方式<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">val</span> writeForm = <span class="type">Form</span>(<span class="string">"name"</span> -&gt; text(<span class="number">1</span>,<span class="number">10</span>))</div></pre></td></tr></table></figure></p>
<p>这里使用了Play的From，约束长度只能在1到10之间。如果获取失败的话，就获取配置参数helloWorld.name。<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">case</span> <span class="type">GET</span>(<span class="type">Path</span>(<span class="string">"/hello"</span>)) =&gt; <span class="type">Action</span> &#123;</div><div class="line">  <span class="comment">// 把request定已成implicit类型，方便下面进行变量绑定 </span></div><div class="line">  <span class="keyword">implicit</span> request =&gt;</div><div class="line">       <span class="keyword">val</span> name = <span class="keyword">try</span> &#123;</div><div class="line">	  <span class="comment">// 将request和我们的form进行绑定匹配</span></div><div class="line">          writeForm.bindFromRequest.get</div><div class="line">       &#125; <span class="keyword">catch</span> &#123;</div><div class="line">           <span class="keyword">case</span> ex:<span class="type">Exception</span> =&gt; &#123;</div><div class="line">             log.warning(<span class="string">"no name specified"</span>)</div><div class="line">	     <span class="comment">// 获取默认的配置参数</span></div><div class="line">             system.settings.config.getString(<span class="string">"helloWorld.name"</span>)</div><div class="line">           &#125;</div><div class="line">       &#125;</div><div class="line">   ...</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>现在有了name，我们可以发送信息给指定的actor。但是在创建response之前我们必须等着结果，可我们不希望阻塞。所以我们返回AsyncResult，它需要一个promise。promise很像Futrue，只是Futrue是在client端使用的。有了promise，结果就一直等在producer那儿，完成处理后producer会提供这个结果。关于Futrue和Promise的更多细节会在下一章涉及。<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="type">AsyncResult</span> &#123;</div><div class="line">   <span class="comment">// 使用ask方法发送request</span></div><div class="line">   <span class="keyword">val</span> resultFuture = actor ? name </div><div class="line">   <span class="comment">// 使用futrue创建一个promise</span></div><div class="line">   <span class="keyword">val</span> promise = resultFuture.asPromise</div><div class="line">   <span class="comment">// 返回结果后，就创建response</span></div><div class="line">   promise.map &#123;</div><div class="line">       <span class="keyword">case</span> res:<span class="type">String</span> =&gt; &#123;</div><div class="line">          <span class="type">Ok</span>(res)</div><div class="line">       &#125;</div><div class="line">   &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>要使用 HelloWorld actor的response创建一个response，我们必须使用ask方法。ask方法返回一个Futrue，使用Future创建一个Promise。最后一步就是使用返回的结果填充进Promise。</p>
<p>如果超时没有收到response呢，这样map方法就不会被调用，promise里也不会被填充结果。要解决这个问题，我们继承Future，当失败的时候返回一个字符串。<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">val</span> resultFuture = actor ? name recover &#123;</div><div class="line">     <span class="keyword">case</span> ex:<span class="type">AskTimeoutException</span></div><div class="line">          =&gt; <span class="string">"Timeout"</span></div><div class="line"></div><div class="line">     <span class="keyword">case</span> ex:<span class="type">Exception</span> =&gt; &#123;</div><div class="line">         log.error(<span class="string">"recover from "</span>+ex.getMessage)</div><div class="line">         <span class="string">"Exception:"</span> + ex.getMessage</div><div class="line">     &#125;</div><div class="line"> &#125;</div></pre></td></tr></table></figure></p>
<p>总结一下变化：</p>
<ul>
<li>从resource文件中加载默认属性</li>
<li>抽取path中的参数</li>
<li>处理请求超时</li>
<li>并发地处理所有问题</li>
</ul>
<p>用下面这个例子来总结一下这一章的所学：<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 实现 Application trait</span></div><div class="line"><span class="class"><span class="keyword">object</span> <span class="title">PlayMiniHello</span> <span class="keyword">extends</span> <span class="title">Application</span> </span>&#123;</div><div class="line"></div><div class="line">     <span class="keyword">lazy</span> <span class="keyword">val</span> system = <span class="type">ActorSystem</span>(<span class="string">"webhello"</span>)</div><div class="line"></div><div class="line">     <span class="keyword">lazy</span> <span class="keyword">val</span> actor = system.actorOf(<span class="type">Props</span>[<span class="type">HelloWorld</span>])</div><div class="line"></div><div class="line">     <span class="keyword">implicit</span> <span class="keyword">val</span> timeout = <span class="type">Timeout</span>(<span class="number">1000</span> milliseconds)</div><div class="line"></div><div class="line">     <span class="keyword">val</span> log = <span class="type">Logging</span>(system,<span class="type">PlayMiniHello</span>.getClass)</div><div class="line"></div><div class="line">     <span class="function"><span class="keyword">def</span> <span class="title">route</span> </span>= &#123;</div><div class="line">         <span class="keyword">case</span> <span class="type">GET</span>(<span class="type">Path</span>(<span class="string">"/test"</span>)) =&gt; <span class="type">Action</span> &#123;</div><div class="line">             <span class="type">Ok</span>(<span class="string">"TEST @ %sn"</span>.format(<span class="type">System</span>.currentTimeMillis))</div><div class="line">         &#125;</div><div class="line"></div><div class="line">	 <span class="comment">// 使用 helloworld actor 创建一个request</span></div><div class="line">         <span class="keyword">case</span> <span class="type">GET</span>(<span class="type">Path</span>(<span class="string">"/hello"</span>)) =&gt; <span class="type">Action</span> &#123;</div><div class="line">	     <span class="comment">// 设置request为implicit</span></div><div class="line">             <span class="keyword">implicit</span> request =&gt;</div><div class="line">             <span class="keyword">val</span> name = <span class="keyword">try</span> &#123;</div><div class="line">		    <span class="comment">// 获取name参数，具体参考Play文档</span></div><div class="line">                    writeForm.bindFromRequest.get</div><div class="line">               &#125; <span class="keyword">catch</span> &#123;</div><div class="line">                     <span class="keyword">case</span> ex:<span class="type">Exception</span> =&gt; &#123;</div><div class="line">                         log.warning(<span class="string">"no name specified"</span>)</div><div class="line">                         system.settings.config.getString(<span class="string">"helloWorld.name"</span>)</div><div class="line">                     &#125;</div><div class="line">               &#125;</div><div class="line"></div><div class="line">	       <span class="comment">// 由于不想阻塞，我们返回AsyncResult</span></div><div class="line">               <span class="type">AsyncResult</span> &#123;</div><div class="line">		 <span class="comment">// 担心超时，创建一个recover回调函数</span></div><div class="line">                 <span class="keyword">val</span> resultFuture = actor ? name recover &#123;</div><div class="line">                     <span class="keyword">case</span> ex:<span class="type">AskTimeoutException</span> =&gt; <span class="string">"Timeout"</span></div><div class="line">                     <span class="keyword">case</span> ex:<span class="type">Exception</span> =&gt; &#123;</div><div class="line">                         log.error(<span class="string">"recover from "</span>+ex.getMessage)</div><div class="line">                         <span class="string">"Exception:"</span> + ex.getMessage</div><div class="line">                     &#125;</div><div class="line">                 &#125;</div><div class="line"></div><div class="line">                 <span class="keyword">val</span> promise = resultFuture.asPromise</div><div class="line"></div><div class="line">                 promise.map &#123;</div><div class="line">                     <span class="keyword">case</span> res:<span class="type">String</span> =&gt; &#123;</div><div class="line">                         log.info(<span class="string">"result "</span>+res)</div><div class="line">                         <span class="type">Ok</span>(res)</div><div class="line">                     &#125;</div><div class="line">                     <span class="keyword">case</span> ex:<span class="type">Exception</span> =&gt; &#123;</div><div class="line">                         log.error(<span class="string">"Exception "</span>+ex.getMessage)</div><div class="line">                         <span class="type">Ok</span>(ex.getMessage)</div><div class="line">                     &#125;</div><div class="line">                     <span class="keyword">case</span> _ =&gt; &#123;</div><div class="line">                     <span class="type">Ok</span>(<span class="string">"Unexpected message"</span>)</div><div class="line">                     &#125;</div><div class="line">                 &#125;</div><div class="line">             &#125;</div><div class="line">         &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">val</span> writeForm = <span class="type">Form</span>(<span class="string">"name"</span> -&gt; text(<span class="number">1</span>,<span class="number">10</span>))</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>此外我们还要处理一些小事情，指定启动app的类，这里是”PlayMiniHello.”。<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">object</span> <span class="title">Global</span> <span class="keyword">extends</span> <span class="title">com</span>.<span class="title">typesafe</span>.<span class="title">play</span>.<span class="title">mini</span>.<span class="title">Setup</span>(<span class="params">ch04.<span class="type">PlayMiniHello</span></span>)</span></div></pre></td></tr></table></figure></p>
<p>继承了 play.api.GlobalSettings trait，这样我们就可以使用ActorSystem的onStart和onStop方法了。</p>
<p>编辑配置文件reference.conf<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">helloWorld &#123;</div><div class="line"> name=world</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>编辑application.conf<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">helloWorld &#123;</div><div class="line">    name=&quot;world!!!&quot;</div><div class="line">&#125;</div><div class="line">akka &#123;</div><div class="line">   event-handlers = [&quot;akka.event.slf4j.Slf4jEventHandler&quot;]</div><div class="line">   # Options: ERROR, WARNING, INFO, DEBUG</div><div class="line">   loglevel = &quot;DEBUG&quot;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>编辑项目构建文件Build.scala<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> sbt._</div><div class="line"><span class="keyword">import</span> <span class="type">Keys</span>._</div><div class="line"><span class="keyword">import</span> <span class="type">PlayProject</span>._</div><div class="line"><span class="class"><span class="keyword">object</span> <span class="title">Build</span> <span class="keyword">extends</span> <span class="title">Build</span> </span>&#123;</div><div class="line">     <span class="keyword">lazy</span> <span class="keyword">val</span> root = <span class="type">Project</span>(id = <span class="string">"playminiHello"</span>,</div><div class="line">     base = file(<span class="string">"."</span>), settings = <span class="type">Project</span>.defaultSettings).settings(</div><div class="line">     resolvers += <span class="string">"Typesafe Repo"</span> at</div><div class="line">     <span class="string">"http://repo.typesafe.com/typesafe/releases/"</span>,</div><div class="line">     resolvers += <span class="string">"Typesafe Snapshot Repo"</span> at</div><div class="line">     <span class="string">"http://repo.typesafe.com/typesafe/snapshots/"</span>,</div><div class="line">     libraryDependencies ++= <span class="type">Dependencies</span>.hello,</div><div class="line">     <span class="comment">// 加上这一行，就可以支持sbt测试webapp了</span></div><div class="line">     mainClass in (<span class="type">Compile</span>, run) := <span class="type">Some</span>(<span class="string">"play.core.server.NettyServer"</span>))</div><div class="line">&#125;</div><div class="line"><span class="class"><span class="keyword">object</span> <span class="title">Dependencies</span> </span>&#123;</div><div class="line">     <span class="keyword">import</span> <span class="type">Dependency</span>._</div><div class="line">     <span class="keyword">val</span> hello = <span class="type">Seq</span>(akkaActor,</div><div class="line">         akkaSlf4j,</div><div class="line">         <span class="comment">// slf4jLog4j,</span></div><div class="line">         playmini</div><div class="line">     )</div><div class="line">&#125;</div><div class="line"><span class="class"><span class="keyword">object</span> <span class="title">Dependency</span> </span>&#123;</div><div class="line">     <span class="comment">// Versions</span></div><div class="line">     <span class="class"><span class="keyword">object</span> <span class="title">V</span> </span>&#123;</div><div class="line">         <span class="keyword">val</span> <span class="type">Slf4j</span> = <span class="string">"1.6.4"</span></div><div class="line">         <span class="keyword">val</span> <span class="type">Akka</span> = <span class="string">"2.0"</span></div><div class="line">     &#125;</div><div class="line">     <span class="comment">// Compile</span></div><div class="line">     <span class="keyword">val</span> slf4jLog4j = <span class="string">"org.slf4j"</span> % <span class="string">"slf4j-log4j12"</span>% <span class="type">V</span>.<span class="type">Slf4j</span></div><div class="line">     <span class="keyword">val</span> akkaActor = <span class="string">"com.typesafe.akka"</span> % <span class="string">"akka-actor"</span> % <span class="type">V</span>.<span class="type">Akka</span></div><div class="line">     <span class="keyword">val</span> playmini = <span class="string">"com.typesafe"</span> %% <span class="string">"play-mini"</span> % <span class="string">"2.0-RC3"</span></div><div class="line">     <span class="keyword">val</span> akkaSlf4j = <span class="string">"com.typesafe.akka"</span> % <span class="string">"akka-slf4j"</span> % <span class="type">V</span>.<span class="type">Akka</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>进入sbt，运行run。app会运行在9000端口上，可以使用curl进行测试了。</p>
<h2 id="7-4-总结"><a href="#7-4-总结" class="headerlink" title="7.4 总结"></a>7.4 总结</h2><p>写的太绕口了。。不翻译了。。。。。akka各种牛逼。。。</p>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/akka/">akka</a>
  </div>

</div>



	<div class="article-share" id="share">
	
	  <div data-url="http://willcup.com/2016/08/17/akka-in-action-读书笔记（7）/" data-title="akka in action 读书笔记（7） | Will&#39;s Blog" data-tsina="null" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2016/08/19/akka-in-action-读书笔记（8）/" title="akka in action 读书笔记（8）">
  <strong>上一篇：</strong><br/>
  <span>
  akka in action 读书笔记（8）</span>
</a>
</div>


<div class="next">
<a href="/2016/08/15/akka-in-action-读书笔记（6）/"  title="akka in action 读书笔记（6）">
 <strong>下一篇：</strong><br/> 
 <span>akka in action 读书笔记（6）
</span>
</a>
</div>

</nav>

	
<!-- 多说评论框 start -->
  <div class="ds-thread" data-thread-key="2016/08/17/akka-in-action-读书笔记（7）/" data-title="akka in action 读书笔记（7）" data-url="http://willcup.com/2016/08/17/akka-in-action-读书笔记（7）/"></div>
<!-- 多说评论框 end -->
<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"ruoyuchen"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
     || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
  </script>
<!-- 多说公共JS代码 end -->

</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
 
 <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#7-1-配置"><span class="toc-number">1.</span> <span class="toc-text">7.1 配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-1-1-牛刀小试"><span class="toc-number">1.0.1.</span> <span class="toc-text">7.1.1 牛刀小试</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-1-2-使用默认值"><span class="toc-number">1.0.2.</span> <span class="toc-text">7.1.2 使用默认值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-1-3-akka配置"><span class="toc-number">1.0.3.</span> <span class="toc-text">7.1.3 akka配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-1-4-多系统"><span class="toc-number">1.0.4.</span> <span class="toc-text">7.1.4 多系统</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-2-日志"><span class="toc-number">2.</span> <span class="toc-text">7.2 日志</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-1-Akka-app中记录日志"><span class="toc-number">2.0.1.</span> <span class="toc-text">7.2.1 Akka app中记录日志</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-2-使用日志功能"><span class="toc-number">2.0.2.</span> <span class="toc-text">7.2.2 使用日志功能</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-3-控制日志功能"><span class="toc-number">2.0.3.</span> <span class="toc-text">7.2.3 控制日志功能</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-3-发布基于Akka的app"><span class="toc-number">3.</span> <span class="toc-text">7.3 发布基于Akka的app</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-3-1-独立app"><span class="toc-number">3.0.1.</span> <span class="toc-text">7.3.1 独立app</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-3-2-创建web-app"><span class="toc-number">3.0.2.</span> <span class="toc-text">7.3.2 创建web app</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-4-总结"><span class="toc-number">4.</span> <span class="toc-text">7.4 总结</span></a></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  


  

  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/源码/" title="源码">源码<sup>10</sup></a></li>
			
		
			
				<li><a href="/tags/akka/" title="akka">akka<sup>9</sup></a></li>
			
		
			
				<li><a href="/tags/flume/" title="flume">flume<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/spring/" title="spring">spring<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/solr/" title="solr">solr<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/ETL/" title="ETL">ETL<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/azkaban/" title="azkaban">azkaban<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/调度平台/" title="调度平台">调度平台<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/python/" title="python">python<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/mysql/" title="mysql">mysql<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/scala/" title="scala">scala<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/ambari/" title="ambari">ambari<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/quartz/" title="quartz">quartz<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/2015a/" title="2015a">2015a<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/ElasticSearch/" title="ElasticSearch">ElasticSearch<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/heroku/" title="heroku">heroku<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/guava/" title="guava">guava<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/django/" title="django">django<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Flume/" title="Flume">Flume<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/mac/" title="mac">mac<sup>1</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
          <li>
            
            	<a href="https://github.com/willcup" target="_blank" title=" 我自己的github">github</a>
            
          </li>
        
          <li>
            
            	<a href="http://thisding.com" target="_blank" title="朋友的主页">Steven&#39;s Blog</a>
            
          </li>
        
    </ul>
</div>

  


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

  <div class="weiboshow">
  <p class="asidetitle">新浪微博</p>
    <iframe width="100%" height="119" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=119&fansRow=2&ptype=1&speed=0&skin=9&isTitle=1&noborder=1&isWeibo=0&isFans=0&uid=null&verifier=&dpc=1"></iframe>
</div>


</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello ,I&#39;m Will Chen in MeiTuan. <br/>
			元 亨 利 贞.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		
		
		
		
		
		
		
		
		
		<a href="mailto:chenxin15@meituan.com" target="_blank" class="icon-email" title="Email Me"></a>
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2017 
		
		<a href="/about" target="_blank" title="Will Chen">Will Chen</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>









<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3Fe6d1f421bbc9962127a50488f9ed37d1' type='text/javascript'%3E%3C/script%3E"));
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
